# 2022 年 Docker 最佳实践|线束|线束

> 原文：<https://www.harness.io/blog/best-practices-for-docker>

2022 年 Docker 最佳实践。本文将解释更多关于 Docker 的内容，以及如何编写最佳的 Docker 文件来构建和部署您的应用程序

多年来，软件开发已经有了很好的发展和变化。无论规模大小，组织都已经发现了现代软件开发实践的价值，云原生工具已经为数字化转型创造了新的惯例。这种发展包括容器的出现，作为采用微服务架构的组织打包软件的一种手段。

在容器成为现代应用程序堆栈的主要组件之前，开发人员找到了不同的方法来抽象和隔离代码。这些方法从简单的脚本开始，然后发展成更健壮的解决方案。现在，容器是大多数开发人员工具包的基础组件。Docker 目前是大规模打包和部署容器化应用的事实上的标准。

本文将详细介绍 Docker，以及如何编写最佳的 Docker 文件来构建和部署您的应用程序。

## 码头工人

既然慢慢深入比较好，我们就花点时间描述一下 Docker。随着虚拟化和容器技术的流行，软件开发人员开始寻找加速软件开发过程的方法。这就是 Docker 开始发光的地方。

Docker 是一种轻量级的虚拟化技术，允许您使用容器构建、发布和运行应用程序。每个应用程序被打包成一个单独的容器，这意味着它有自己的内核，可以独立于其他容器运行。因此，Docker 帮助开发人员打包他们的应用程序，并简化他们的软件开发过程。

本文将解释 Docker 是什么，为什么它对软件开发人员有用，如何为您的应用程序创建 Docker 文件，以及如何在不同的环境中有效地使用它。开发人员现在可以创建他们自己的定制环境，而不必担心或破坏过程中的任何东西。这种自由意味着我们可以以任何对我们的项目有意义的方式编写代码，打包并发布。

## Dockerfile

当使用容器部署应用程序时，您必须正确处理的最重要的事情之一是 docker 文件。Docker 文件是告诉 Docker 如何构建和部署容器的方式。如果它们没有根据您的需求进行很好的编写或优化，这将极大地影响您启动和运行新版本应用程序的速度和效率。

在本文中，我们将研究一些编写有效 docker 文件的最佳实践。这些技巧将帮助你简化 Docker 的[部署过程](https://harness.io/products/continuous-delivery),并确保未来的维护尽可能简单。由于使用 Docker(和其他类似的工具)有许多不同的方式，我们将不详细说明在什么情况下使用什么命令。相反，请将这些指针作为通用指南来阅读，这将有助于优化您的 docker 文件。

Dockerfile 是帮助您在 [Docker 容器](https://docs.harness.io/article/q6fr5bj63w-build-and-push-to-docker-hub-step-settings)中部署代码的主要文件。有了最佳实践指南，创建和使用 docker 文件将变得更加容易和简化。

### **Dockerfile 最佳实践**

Dockerfiles 看起来很简单，但从开发人员的角度来看却非常复杂。它们必须有足够详细的文档，以便任何人都可以运行它们，并最终获得一个工作容器。开发过程的全面文档化也是一个最佳实践，尤其是如果您的团队(或组织)有不止一个开发人员同时处理代码的话。

以下是一些需要记住的最佳实践:

‍ **不要将 Dockerfile 用作构建脚本**–docker file 是一组可用于创建自定义映像的指令。它不应该被用作构建脚本，因为它会使你的构建变得不必要的长。当您必须在 docker 文件中编译或捆绑软件时，您应该使用 ADD 指令。这将在映像开始运行命令之前，将编译所需的文件复制到映像中。这将让您保持 docker 文件的简短，并独立于 docker 文件管理编译所需的任何依赖关系。

‍ **使用 ENV 定义环境变量**–**设置环境变量是 Dockerfiles 的最佳实践。尽管这看起来像是一个小细节，但是定义环境变量将会使容器更易于移植。这是因为从一次执行到下一次执行，环境变量是唯一可以改变的东西。请注意，Docker 容器是软件应用程序的一个抽象，这意味着如果不改变主机系统的操作系统，就不能在容器中改变 Linux 操作系统的任何内容。如果您有一个在容器内部和外部都必须不同的变量，那么您必须使用 ENV 来定义它。**

**‍ **将您的 docker 文件提交到存储库–**docker 文件的最佳实践之一是将其提交到您的存储库。这使您以后可以轻松快速地引用它，而无需记住您使用的所有命令或它们的顺序。**

**‍ **注意你的基本映像及其大小**–**创建 docker 文件时，要考虑的最重要的事情之一就是你正在使用的基本映像。如果你有很多无关的代码，这会增加你的 Docker 图片的大小。这将使你的容器启动慢很多，或者更糟糕的是，阻止它启动。避免这种情况的最好方法是留意您使用的包和脚本。如果似乎没有必要将它包含在基本映像中，请尝试在容器启动时安装它。这将节省容器上的空间，从而使它运行得更快更有效。****

****‍ **不泄露秘密**–**切勿共享或复制 docker 文件中的应用凭证或任何敏感信息。相反，使用**。dockerignore** 文件，以防止复制可能包含敏感信息的文件。的。dockerignore 文件相当于。gitignore file，它允许您指定希望构建过程忽略的文件。******

****‍ **注意哪些端口是暴露的**–**在设计 docker 文件时，确保你知道哪些端口是暴露的。默认情况下，Docker 会将所有容器暴露给一系列随机的内部端口。这是有问题的，因为它会将关键服务暴露给外部世界，使它们容易受到攻击。如果您使用的服务必须向公共互联网公开，那么您必须在 Dockerfile 文件中创建一个条目。这可以通过在 done 文件中添加“EXPOSE”来实现。******

******`FROM node:14-alpine AS development
ENV NODE_ENV development
WORKDIR /app
COPY package.json .
RUN npm install
COPY . .
EXPOSE 3002
CMD [ "node", "app.js" ]` 

`FROM node:14-alpine AS development`:来自基本图像节点，带有版本 14-alpine 变体。我们实际上使用 Node:14-alpine 作为我们图像的模板。

`ENV NODE_ENV development` : NODE_ENV 是 NODE 暴露给运行脚本的系统环境变量。按照惯例，它用于确定开发与生产的行为。在这里，我们将它设置为发展。

`WORKDIR /app`:接下来，我们在容器 to /app 中设置工作目录。我们提到名为 app 的目录将保存我们的项目[文件和所有相关的东西]。

我们正在复制我们的 package.json 文件以了解依赖关系。

`RUN npm install`:这个命令安装我们的 package.json 文件中提到的所有依赖项。

`COPY . .`:我们从 Docker 镜像中的当前工作目录复制所有内容。

`EXPOSE 3002`:我们指定暴露端口 3002。

`CMD [“node”, “app.js”]`:我们指定用命令‘node app . js’运行应用程序。****** 

******要记住的最后一个最佳实践是让你的 docker 文件尽可能简单——就像它们本来应该的那样。因此，不要试图增加不必要的复杂性。你应该把它做得非常简单，这样其他开发者就可以在没有任何帮助的情况下很容易地理解和执行它。******

## ******结论******

******Docker 拥有一个庞大的社区，并将继续在云原生生态空间中蓬勃发展，为组织在云原生之旅中取得成功带来诸多好处。此外，Docker 是开发人员的福音，每个组织都希望采用 DevOps 最佳实践。我们都继续使用 Docker 通过容器来构建和运输我们的软件。因此，我们有必要知道 Dockerfile 文件是如何创建的。我希望这篇文章能让您充分理解如何用最佳实践创建 docker 文件。******

******下一步是什么？卷起袖子，用这个简单的[dockering 你的 Node.js 应用程序](https://harness.io/blog/devops/dockerizing-your-node-application/)教程来看看 Dockerfile 是如何真正工作的，并带上 Harness CD 进行一次测试。[下载免费试用](https://app.harness.io/auth/#/signup/?module=cd)。******

******也可以查看我们对 [CI/CD 最佳实践](https://harness.io/blog/ci-cd-best-practices)和[软件交付最佳实践](https://harness.io/blog/best-practices-software-delivery)的建议。******