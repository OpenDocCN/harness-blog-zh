# 驾驭 YAML 编辑器-代码远离你的 CI/CD 管道！装具

> 原文：<https://www.harness.io/blog/harness-yaml-editor>

为最终用户提供强大的 YAML 编辑器体验对我们来说非常重要，因为他们可以帮助他们以一种高效、无错误、开发友好的方式编写/编辑 CI/CD 管道。

随着现代 DevOps 的出现，将持续集成/持续部署(CI/CD) [管道配置为代码](https://harness.io/blog/pipeline-as-code/)变得相当流行。最值得注意的是，Kubernetes 在将 Kubernetes 对象定义为代码时，在将 YAML 作为首选语言的广泛采用中发挥了关键作用。这一点，加上 Kubernetes 是 Harness CI/CD 产品中第一个也是最重要的泳道之一，意味着我们必须为最终开发人员提供强大的 YAML 编辑器体验，以便以高效、无错误和开发人员友好的方式编写/编辑 CI/CD 管道。

但是我们真正面对的是什么？我们希望为开发人员创造出色的编辑体验，能够:

*   从头开始创建连接器、机密或管道。
*   提供实时模式验证。
*   提供智能感知和自动完成。
*   提供字段描述和丰富的内联文档。
*   最后，提供模板或样本 YAML 作为一个快速的起点。

这将解决以下客户使用案例:

*   开发人员必须从头开始创建一个 YAML，并需要帮助确定哪些字段应该放入其中。
*   开发人员必须修改现有的管道并验证其正确性。
*   此外，开发人员必须克隆和编辑现有管道，并快速将当前管道复制为代码。

## 在幕后

如果没有对开发人员的任何自动建议和自动完成支持，从构建/部署阶段开始创建 CI/CD 管道可能会非常困难。此外，它不是关于创建任何管道——它必须是一个在语义上验证 CI/CD 管道本身的“JSON 模式”的管道。JSON Schema 是一种语法语言，用于定义 JSON 对象或 YAML 文件的结构、内容和(在某种程度上)语义。这与我们的用例更相关。作为构建我们模式框架的一部分，我们还率先从不同的微服务中拼接出一个复杂的 YAML 模式。例如，用于线束 CI/CD 管道的组合 YAML 模式将具有 CI 和 CD 阶段，其中这些阶段的单独模式可以由各自的 CI 和 CD 微服务提供。

这些复杂的模式将有助于 YAML 自动完成 YAML 中某些真正深度嵌套的级别。例如，对于一个典型的多级 CI/CD 管道，我们已经实现了大约 50 个嵌套级别的 YAML 自动完成。应用服务器根据一个实体的 Swagger 定义、我们的定制注释和一个 Swagger-to-JSON 模式转换器，为该实体缝合这个 JSON 模式。

从语义上来说，在为一个实体(比如管道)定义 JSON 模式时，我们引入了“类型”及其相应“规范”字段的概念。例如，CI/CD 管道可能有一个阶段类型，可以是“构建”、“部署”或“批准”对应于开发人员选择的类型，必须指定一个 spec 对象，该对象将包含有关阶段本身的信息。例如，克隆什么代码库，使用什么部署策略，分配什么资源等等。这个设计原则帮助我们为所有的实体(比如连接器、秘密等等)建立了通用的模式模型。

## 用户体验是什么样的？

当开发人员为特定实体(如管道)编写/编辑 YAML 文件时，会根据其 JSON 模式对其进行语义验证。这将返回 YAML 中的所有语义验证错误，开发人员应该修复这些错误以获得有效且正确的 YAML 配置。例如，管道至少应该有一个标识符、名称、组织标识符和项目标识符(见下面的截图)。

此外，我们内联显示模式验证错误，以突出确切的验证问题(参见下面的屏幕截图)和预期的开发人员修复它的操作(参见后面的屏幕截图)。

除了为实体提供针对 JSON 模式的智能自动建议之外，Harness 的 YAML 编辑器还可以为 YAML 中的特定字段注入定制建议。例如，如果 CI/CD 管道必须在构建/部署阶段引用现有的连接器或机密，我们可以根据 YAML 中的“ **connectorRef** 或“ **secretRef** ”字段，在下拉列表中登记每个连接器或机密引用(“引用”)。这是一个强大的开发人员体验，因为开发人员不必导航到另一个屏幕来找出要在管道中指定的连接器或秘密引用。

类似地，编辑器也可以将每个管道变量作为字段的下拉列表进行提示(参见下面的屏幕截图)。这个以开发人员为中心的特性允许在管道中无缝引用管道变量。

最后，编辑器还允许自动完成部分管道变量作为输入。例如，当开发人员输入“< +pipeline.variables”触发自动完成时，我们只向开发人员显示下拉列表中以“pipeline.variables”开头的管道变量(参见下面的截图)。

## 多走一步

即使在提供了具有智能感知和自动完成功能的强大编辑器体验之后，我们仍然觉得从头编写一个完整的 YAML 对于一个可能不熟悉 YAML 语言或者一般概念上的管道的人来说可能有点太难了。为了解决这个问题，我们设计了一个 Snippets 部分，它提供了现成的 YAMLs，可以在编辑器窗格中立即复制/粘贴，并根据需要进行编辑，以快速创建连接器、秘密或管道(参见下面的截图)。

到目前为止，对于大多数线束实体来说，该特性仍处于积极开发中。然而，它确实为一个伟大的市场体验铺平了道路，帮助开发人员只需点击几下鼠标，就可以像 YAML 一样开始创建管道或连接器。

## 摘要

Harness 的 YAML 编辑器为现代 DevOps 解决方案带来了巨大的潜力，提供了一流的用户体验，并帮助开发人员减少了设置和维护 CI/CD 管道的总时间。

想了解更多关于 CI 和 CD 的知识？几周前，我们发布了 CI 的[模板——旨在为您节省大量时间。在 CD 端，这里有一个关于使用 Redis Streams](https://harness.io/blog/templates-harness-ci/) 的[事件驱动架构的很酷的技术深度挖掘。](https://harness.io/blog/event-driven-architecture-redis-streams/)

*本文由阿比纳夫·辛格、拉玛·图马拉和瓦尔丹·班萨尔合作撰写。*