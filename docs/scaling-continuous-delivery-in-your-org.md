# 利用 Harness | Harness 在您的组织中扩展持续交付

> 原文：<https://www.harness.io/blog/scaling-continuous-delivery-in-your-org>

获得一些快速胜利，获得动力，并在整个旅程中设定更大的目标。

在 Harness，我们经常被问到，“在整个组织中扩展[连续交付](https://harness.io/blog/what-is-continuous-delivery/)的最佳实践是什么？”很自然，我们的回应是:“解雇任何仍然做瀑布的人，并立即雇佣 10 名 DevOps 工程师。”我开玩笑的。雇佣 10 名 DevOps 工程师将花费你 6-12 个月的时间，并且可能花费你 100 多万美元。

持续交付是一个渐进的过程，不会一蹴而就。

例如，不是每个人都需要每小时部署一次来实现业务成果。我们与一些客户合作，他们从每月部署一次到每周部署一次，这对他们的业务产生了巨大影响。

这引出了一个重要的首要问题:对你的组织或团队来说，什么是成功？

## 你的 CI/CD 目标是什么？

不要试图在第一天就把海洋烧开，或者设定不切实际的目标，比如“我们想像脸书一样，一天做一百万次部署。”

获得一些快速胜利，获得动力，并在整个旅程中设定更大的目标。

如果你刚开始，有这样的目标来扩展持续交付:

*   跨开发、QA、试运行和生产环境自动提升代码。
*   将部署速度从每月一次提高到每两周一次。
*   将部署工作从几名工程师减少到一名工程师。

如果你是更高级的，有这样的目标来扩展连续交付:

如果您是专家，那么您可能有这样的目标来扩展连续交付:

*   授权每个开发人员在生产中部署他们自己的代码。
*   报告并量化每个部署的业务成果。
*   基于业务异常或回归执行连续验证和回滚。

## 您的组织目前在哪里？

像任何事情一样，了解你今天在哪里，你想去哪里。

下面是一个简单的三阶段成熟度模型，反映了大多数客户在其持续交付旅程中所处的阶段:

简单地说，你多久发布一次代码？现在谁负责贵公司的部署？是 it 运营，DevOps，还是开发者？

我们交谈过的 60%的客户处于第 1 阶段，这意味着 IT 运营(特别是发布和部署团队)负责部署——其中大多数负责每月的发布周期。“发布”在这里是一个关键词，代表一个需要计划、会议和变更控制过程的重大事件。这是部署周期更长的主要原因。部署管道通常不存在，并且部署或者通过特别脚本或者通过基础设施配置管理工具来管理。

约 35%的客户处于第 2 阶段，其中有一个专门的开发运维团队，主要负责平台工程、CI/CD 和自动化。在一些组织中，DevOps 团队可能还拥有部署。DevOps 团队通常尝试在他们的 CI 平台(如 Jenkins 或 Bamboo)上使用 shell 脚本构建 CD 功能。

如今，只有不到 5%的客户在实践持续交付即服务。对许多人来说，第 3 阶段是大多数客户想要达到的阶段；这是软件交付的“天堂”或“圣杯”。在这个阶段，DevOps 团队提供了一个交钥匙的“CD 即服务”，开发人员拥有高度的自主权来构建他们自己的部署管道，因此他们可以自己部署到生产环境中。

## CI/CD 的组织特征和要求

与上述成熟度模型一样，我们交谈过的绝大多数客户目前都有一个由 IT 运营部门或开发运维部门拥有的集中式部署模型。这种模型往往最适合 monolith 和 SOA 应用程序，因为小型的专门团队可以轻松地管理每月的发布周期。安全性和法规遵从性要求较低，因为部署的人员较少，可见性和报告级别也较低，因为您的变更和活动较少。

不幸的是，这种集中式部署模式打破了微服务、无服务器和云原生应用。更多组件和更高水平的并行开发意味着变化和部署增加 100 倍。

为了克服这一瓶颈，IT 运营和开发运维团队需要为开发人员提供一个自助服务平台。不幸的是，这是有代价的。给予开发人员自由对安全性、合规性、可见性和报告需求有着巨大的影响——因为现在部署的人数很可能是原来的 100 倍。随着更大的自由而来的是责任，组织仍然需要保持一定程度的控制。

例如，以下是为支持我们的客户持续交付“即服务”而构建的一些关键功能:

*   单点登录(SSO)身份验证支持
*   授权的基于角色的访问控制(RBAC)
*   云客户和 CI/CD 工具的使用限制
*   控制设备访问的 IP 白名单
*   详细报告何人、何事、何时的审计日志
*   用于管理凭证、密钥和证书的秘密管理
*   服务级别控制面板，显示每个服务/应用程序在什么环境下运行什么版本/配置
*   模板库，因此开发人员可以跨团队重用部署管道、工作流、命令和脚本
*   配置即代码，因此开发人员可以编写脚本并对他们自己的部署管道进行版本控制

授权开发人员进行部署意味着您的 CD 平台需要支持主要的安全性、合规性和报告要求。如果你正在构建你自己的 CD 平台，这些需求对你来说并不是无关紧要的。购买 CD 即服务比自己制作更有意义。

利用 Harness 这样的解决方案，您可能需要 12 个多月才能构建的东西可以在几个小时内交付。

## 谁负责为您的服务构建部署管道？

部署管道是一组逻辑阶段，代码必须通过这些阶段才能为生产中的客户做好准备。阶段通常对应于环境，如开发、QA、准备等。在一个阶段中，您通常将代码部署到基础设施(也称为环境)中，并运行一系列测试来验证最新构建工件的所有功能和非功能都是正确的。

将部署管道想象成一条汽车生产线。汽车经历了一个制造过程，并通过工厂的不同测试区域，在最终交付给客户之前，使用工具对其进行检查和验证。如果在任何一个阶段发现了一个缺陷，它就会被拒绝，并在进入下一个阶段之前被送回修复。

在大多数组织中，集中的 DevOps 团队通常负责构建部署管道。把 DevOps 想象成汽车生产线的设计师和建筑师。他们最终负责部署管道中所有东西的结构和治理(环境、工具、测试、标准、安全)。

一旦创建了部署管道模板，发布/部署工程师或开发人员就可以使用它来实例化和使用他们自己的服务构件。

例如，Harness 有一个客户， [Jobvite](https://harness.io/customers/case-studies/reduce-deployment-time/) ，他为 4 个环境(开发、QA、试运行和生产)中的 40 个不同的微服务(开发团队)使用一个部署管道模板。这是测试、部署和验证部署的一种一致且可重复的方式。

最终目标是让开发者自己构建自己的部署管道，使之成为真正的自助服务体验。无论您想要集中管理还是分散管理部署管道，Harness 都可以支持这两种用例。集中管理给你控制权；分散管理会给你规模。无论哪种方式，你都需要一个所有者来建造和管理管道。

## 谁拥有您服务的部署？

一旦部署管道存在，您需要决定谁负责按下那个闪亮的大部署按钮。

同样，IT 运营和集中发布/部署团队传统上是部署按钮的所有者。如今，开发运维团队正在慢慢地将这一职责转移给应用开发团队。DevOps 文化和持续交付是实现这一转变的重要组成部分。
你可以向两个方向连续交货:

*   人工驱动的部署(半自动)。
*   事件驱动的部署(全自动)。

第一种是人工启动部署管道，并通过不同的阶段进行。我们的大多数客户从这个过程开始，因为他们希望完全控制他们的部署过程，直到信心增长，他们熟悉他们的管道如何执行。在管道中使用手动批准阶段也有助于客户保持对每一步的控制。时机成熟时，您可以从您的管道中移除手动批准和阻止，以推动更多自动化。

底线:从由人触发的部署管道开始，在不同的管道阶段之间有人工批准。经过几次部署后，您可以逐渐减少手动批准和移交的次数。

事件驱动部署是基于以下事件触发管道:

*   在您的工件存储库中创建新的构建或版本。
*   完成其他部署管道。
*   一天、一周或一月中的时间。
*   HTTP Webhook。

许多客户的最终目标是基于开发人员检入代码和创建新的构建来自动启动部署管道:每个新的工件应该自动通过开发、qa、试运行，并在很少或没有人工监督的情况下进入生产。您依靠您的测试自动化脚本、工具和验证步骤来告诉您工件是否适合它们被部署的环境(包括生产)。如果验证失败，那么工件应该自动回滚。例如，这里有一个我们的客户 Build.com 的例子，他就是这样做的。

## 谁管理您的 CD 配置？

最后，您的连续交付配置位于何处，由谁来管理？

Harness 支持 CD 配置的集中模式和分散模式。

IT 运营或开发运维团队可以通过单一控制台用户界面或通过配置代码 API 来管理所有 CD 配置。这可以在帐户级别进行管理。

开发人员还可以使用 GitOps in Harness 在服务级别管理 CD 配置。Harness 基本上允许开发人员在 YAML 管理 CD 配置，并在与源代码相同的 repo 中管理该配置。开发人员基本上像管理他们的应用程序一样管理他们的部署管道，作为回购中的源代码。Harness 具有双向同步和版本控制功能，可确保一切保持最新。该选项使开发人员能够完全控制他们的管道，但也使开发运维团队能够报告谁、什么以及何时进行部署。

## 利用线束扩展连续输送

如果您想尝试连续交付，[注册我们的免费试用](https://app.harness.io/auth/#/signup/)。Harness 平台支持所有 3 个 CD 成熟度级别，it 运营、开发运营或开发人员是否想要拥有管道并进行部署都无关紧要。

我们可以为您提供支持当前部署流程的灵活性，或者帮助您过渡到 CD 即服务，让开发人员自助满足他们的需求。我们经营 SaaS 或内部，所以我们也迎合所有类型的组织。利用线束扩展连续交付轻而易举。

干杯！
史蒂夫。
@伯顿说