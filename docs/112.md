# 詹金斯管道易碎的 4 个原因|线束

> 原文：<https://www.harness.io/blog/4-reasons-your-jenkins-pipelines-are-brittle>

在本文中，我们讨论了 Jenkins 管道脆弱的 4 个原因。提示:部分原因在于插件。

当我们在 2017 年 10 月首次推出 Harness 时，我们最初的[挑战之一](https://harness.io/blog/ci-cd-challenges/)是让市场了解[持续集成(CI)解决方案](https://harness.io/platform/continuous-integration/)和[持续交付(CD)解决方案](https://harness.io/platform/continuous-delivery/)之间的差异。当时，我写了一篇关于 Harness 和 Jenkins 之间的[差异和 CI 的](https://harness.io/blog/comparing-harness-vs-jenkins/)事实的快速对比博客！= CD。

从那时起，我就被走上詹金斯管道的客户数量所震惊，结果，他们陷入了痛苦的世界。实际上，在本周一，我与我们的一位客户进行了 30 分钟的通话，内容是关于尝试使用 Jenkins Pipeline 进行 20 多项微服务应用的体验。

顾客说:

“这很痛苦——事实上，非常痛苦。”

这就是他们的旅程被描述的方式。我曾听到另一位顾客将詹金斯描述为“DevOps 胶带”

Jenkins 文档将 Jenkins 管道定义为:

[Jenkins Pipeline](https://jenkins.io/doc/book/pipeline/) (或简称为大写“P”的“Pipeline”)是一套插件，支持将*连续交付管道*实现和集成到 Jenkins 中。

这很好地引出了詹金斯管道易碎的第一个原因。

## 1.詹金斯管道依赖于(大量)插件

现在，在你用湿鱼打我之前，请允许我解释一下——因为我喜欢一个好的 SDK，就像下一个开发者一样。可扩展性在软件中是一件好事，但它也可能是一件坏事——尤其是当可扩展性没有得到正确的管理或构建时。

例如，假设我有一个简单的 Docker 应用程序，我想使用 Jenkins 构建一个简单的部署管道。我进入 [Jenkins 插件网站](https://plugins.jenkins.io/)，搜索“Docker”插件，得到:

这是与 Docker 相关的 26 个不同的插件，按相关性排序。事实上，有人甚至好心地将他们的插件命名为“又一个 Docker”，这就像用棍子戳一下眼睛一样有用。

也许我在这里过于戏剧化了，所以让我们点击第一个插件“Docker ”,看看到底是什么:

不幸的是，再看一眼，我们就找到了詹金斯管道如此脆弱的第二个原因；我发现了 8 个插件依赖项和另外 7 个可选依赖项。你可以明白我的意思。在一个应用/服务变化比特斯拉股价更频繁的世界里，随着技术栈和插件的自然发展，插件依赖可能会成为问题，这似乎是合乎逻辑的。您最不希望看到的是一个破碎的部署管道，因为管道本身相对于实际的软件工件或被测试的构建而言是破碎的。

简单地说，应该使用哪个 Jenkins 管道插件？当一个人需要升级插件和维护版本依赖时会发生什么？我需要一个 DockerHub、Docker、Kubernetes 的插件，以及我的应用程序与之交互的其他技术栈或工具吗？你认为这个插件列表会有多少插件依赖关系？超过 100 不是不现实的。

## 2.Jenkins Pipeline 依赖于作业/脚本

让我们暂时把插件放在一边，把重点放在部署管道的核心概念或实体上:

*   构建或工件(例如容器、AMI、函数)
*   应用/服务
*   环境
*   变量和秘密
*   部署工作流程
*   阶段
*   步伐
*   引发
*   同意
*   验证或健康检查
*   反转
*   发布策略(蓝色/绿色，淡黄色，...)
*   测试和工具(测试、安全、监控、...)
*   用户组和用户(RBAC)

在詹金斯管道中，以上有多少人今天实际上作为一等公民存在？更重要的是，其中有多少要求您编写 Jenkins 作业或 Shell 脚本来管理或执行上述任务？

**回答:**几乎全部。

詹金斯管道是另一种说法:“我用脚本硬编码了我的部署管道。”像环境、变量、秘密、依赖关系和发布策略这样的硬编码在 2008 年还能工作，那时你只有一个 apache web 服务器、几个 Tomcat/WebLogic/WebSphere 实例和一个庞大的 Oracle 数据库。然而，它在 2018 年不适用于公共云、容器和微服务。你将花费更多的时间来维护你的部署管道，而不是实际部署新版本的应用。

事实上，由于应用程序、技术堆栈和工具每周都在变化，客户拥有一个专注于维护部署管道的 DevOps 工程师团队并不罕见。DevOps 团队不是将创新添加到部署管道中，而是将时间花在修复或处理破裂的管道上。

这可不好。您对部署管道的核心组件编写的脚本越多，随着应用程序和技术的变化，您就越需要维护这些脚本。您希望您的部署管道是动态的，因为它们可以根据您的云提供商或 DevOps 工具生态系统中存在的元数据自动适应或更改。

此外，我见过的大多数 Jenkins 管道仍然提示用户手动输入，比如“请提供您想要部署的主要和次要构建版本。”为什么这些信息不能从构建或者工件库中动态地提取出来？Shell 脚本本质上会使您的部署管道变得脆弱。您的部署管道越复杂，您的管道就会变得越脆弱。

## 3.调试一个 Jenkins 管道是一件容易的事

我们暂时忽略那些讨厌的插件和性感的脚本怎么样。假设我们已经使用 Jenkins Pipeline 为我们的应用程序硬编码了最佳部署管道，该应用程序有 20 个微服务，每个微服务都有一个开发、QA、试运行和生产环境。快速问题，我们的应用程序需要一个 Jenkins 管道还是 20 个管道？那些流水线可以并行执行吗？

无论如何，让我们想象一下，我们按下红色的“立即构建”按钮，启动我们的部署管道，并得到这样的视觉效果:

Example Jenkins Pipeline

上面的截图乍一看还不算太差。我们可以看到詹金斯管道有 10 个台阶，它们都是绿色的。

请注意“Shell 脚本”执行的长列表，特别是那些窗口缺少上下文。那些 shell 脚本到底在做什么，告诉正在观察部署的用户什么？如果这些脚本失败了怎么办？我们能详细了解发生了什么吗？或者我们只是看到一个确认 shell 脚本执行的控制台？

同样，如果我们的应用相对简单，只有几个微服务/环境，这也不是什么大问题。但是，如果我们必须观察 20 个不同的管道，每个管道都有数百个 shell 脚本输出，这可能是一个痛苦的世界。

了解 Jenkins 管道(以及您的应用程序)的真实状态和健康状况并不是一件容易的事情。一位客户告诉我，“Jenkins Pipeline 真的缺乏任何全球背景、依赖模型或微服务世界中部署管道的高级视图。”

## 4.部署验证和回滚

简而言之，持续交付不仅仅是部署。每个人都有持续交付的原因，通常是为了提高你的创新和业务的速度，让客户花更多的钱。

不知道在生产中部署的[业务影响是一件大事。没有回滚策略也是一件大事。我不是说运行一个 Jenkins 作业来运行一个简单的负载测试或单元测试。我指的是观察客户如何受到生产部署的影响，并实时管理这种风险。在 Harness，我们称之为持续验证和智能回滚。](https://harness.io/blog/production-deployments-actually-succeed-fail/)

要在 Jenkins Pipeline 中实现这一点，您必须编写一个作业或 shell 脚本。为什么 Jenkins Pipeline 不能与您的监控生态系统集成，并自动告诉您部署是否成功？有可能。我们每天在 Harness 为我们的客户做这件事，所以这是可以做到的。

知道部署成功不是部署步骤或工作完成。成功是对您的业务产生积极影响的部署。相反，对您的业务有负面影响的部署会使您的部署管道变得脆弱。它会让您产生一种错误的安全感，认为您的部署或应用程序一切正常，而实际情况并非如此。

## CI！=光盘

最后，Jenkins 无疑是持续集成(CI)用例的佼佼者。但是连续交付(CD)不仅仅是将代码构建和测试成工件。持续交付就是将这些产品投入生产，让客户满意。

请记住，Jenkins Pipeline 只是一套插件，允许您构建自己的 CD 平台。这意味着，随着应用程序和服务的发展，您实际上是编码和维护 CD 过程的人。

今天，许多真正的持续交付解决方案已经存在，它们与 Jenkins for CI 相集成并对其进行补充。马具是其中之一，但如果你搜索，你会发现其他的。试试看！不要成为那种认为用 DevOps 管道胶带就能构建自己的 [CD 平台](https://harness.io/platform/continuous-delivery/)的客户或团队。

你对 Jenkins Pipeline 和持续交付有什么体验？是还是不是？

问候，

史蒂夫(男子名)

@伯顿说