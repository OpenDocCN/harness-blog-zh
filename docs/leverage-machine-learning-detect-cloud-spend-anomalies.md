# 如何利用机器学习来检测云支出异常|利用

> 原文：<https://www.harness.io/blog/leverage-machine-learning-detect-cloud-spend-anomalies>

为了对成本数据进行预测，我们测试了统计和神经网络模型，并比较了它们在不同时间序列数据集上的性能。

作者:拉姆·波塔姆、帕尔尼安·扎尔加姆、拉维·雅达拉姆

随着企业不断扩大云消费规模，有效管理云成本变得至关重要。自动检测云支出异常的能力是有效管理云成本的关键。[云支出异常](https://harness.io/blog/i-love-spending-money-on-cloud-costs)是指公司的云成本偏离其典型的支出模式，并可能对公司造成重大影响。这些异常可能是由各种原因造成的，例如团队中的某个人无意中调配了资源或泄露了云帐户凭据。当务之急是尽快抓住并解决他们。

检测云支出异常或[云成本管理(CCM)](https://harness.io/blog/ccm-best-practices) 的第一步是能够准确预测公司的云成本。找到成本过高的云服务和资源可以防止大量浪费的云支出。通过将问题构建为时间序列预测问题，使用机器学习方法可以准确地进行云成本预测。

在这篇博客中，我们详细介绍了我们为了找到这个问题的最佳解决方案而尝试的多种机器学习方法。

## 机器智能中的时间序列预测导论

我们的时间序列数据是每日实例成本的序列。总的来说，机器学习预测已被证明在捕捉时间序列数据中的模式方面是有效的，因为它可以发现成本数据中的每周、每月和季节性模式。使用模式和以前的数据，模型可以提前一天到一个多月做出预测。我们通过开发模型来发现这些模式，这些模型旨在分离时间序列数据的不同组成部分，并发现它们如何变化和相互作用。一旦我们可以准确预测数据，我们只需创建误差边界来准确预测异常，以确定公司何时支付过多。

通常，时间序列数据可以分为趋势(例如，增加或减少行为)、季节性(例如，某个时期的循环分量)和随机噪声(因为观察到的数据不完全符合模型)。我们可以分别对它们建模，然后将它们放在一起进行最终预测。

然而，在我们开始构建模型之前，我们需要首先预处理数据。这包括通过线性插值处理和输入缺失值。对于这个博客，我们将使用最近 90 天的观察来进行一天的预测。我们还必须适当地调整数据和预测的比例，以便模型得到准确的训练，并且预测的比例正确。

为了对成本数据进行预测，我们尝试了统计和神经网络模型，并比较了它们在不同时间序列数据集上的性能。

## 机器学习模型概述

### ARIMA 汽车

ARIMA 主张“自回归综合移动平均线，这是一个很大的解开。”我们称这个模型为 uto ARIMA，因为它根据训练的时间序列数据自动生成模型的最佳参数。这个模型有三个部分:

1.  自回归组件包括使用过去的值(特别是它们的线性组合)预测未来的值
2.  集成组件包括多次差分数据(取每两个相邻点的差),直到趋势消除。通过这样做，我们称数据为稳定的，并且更容易预测未来的值。
3.  移动平均分量包括使用过去值的误差分量来预测未来值。我们测试的这个模型的一个变体是 SARIMA，它也考虑了季节因素。

这些参数 p、d 和 q 分别基于 ARIMA 模型的 AR、I 和 MA 分量。

### ESRNN

这是一个深度学习时间序列模型，它赢得了 M4 重大预测竞赛，这是一个旨在提高预测准确性的竞赛。它代表“指数平滑递归神经网络”指数平滑组件将时间序列分解为趋势和季节性组件。同时，递归神经网络是一种使用序列时间序列数据的人工神经网络。网络将以前的输入输入到它的存储器中，影响将来的输入和输出。这不同于传统的神经网络，在传统的神经网络中，所有的输入都是相互独立的。

### LSTM

长短期记忆(LSTM)网络是另一种神经网络，它记住过去的序列/模式来预测未来的值，类似于 RNN。然而，典型的递归神经网络可能面临消失梯度问题，其中信息在训练时丢失。与此同时，LSTM 模型包括一系列的门(输入、输出和遗忘)，就像开关一样控制权重和防止渐变消失。我们的实现使用堆叠的 LSTM 层，这使得模型更深，允许它理解数据中更复杂的模式。

### 先知

先知是脸书发明的。它旨在预测具有年、周、日模式以及假日效应的时间序列。这个框架的好处是易于使用和推广，包括多个时间序列模型。我们使用 Kats 进行预测和异常检测。

## 实验评估

### 资料组

为了有效地比较所有的方法，我们为模型输入相同的数据进行训练，并在相同的点上进行预测。我们使用在我们自己的 QA 环境中运行的 Harness 实例的每日成本数据。在这项研究中，我们感兴趣的是根据过去 90 天的数据预测每天的成本值。数据集的时间跨度为 2021 年 1 月至 2022 年 6 月。

### 结果

我们比较了这些模型相对于平均绝对百分误差(MAPE)的准确性，这是一种用于比较预测模型的常用指标。结果总结在下表 1 中。

## 将 CCM 推向新的高度

虽然看起来自动 ARIMA 确实在 MAPE 方面表现最好，但它需要大量的超参数调整。ARIMA 汽车公司在某些特定模式的数据上也表现不佳。例如，对于每月第一天出现峰值的成本数据，它无法预测峰值的值。

总的来说，我们发现当没有太多随机噪声并且有稳定的季节性和趋势成分时，最好使用自动 ARIMA。当有大量随机噪声和稳定的季节/趋势分量时，LSTM 和 ESRNN 工作得更好，但它们都需要一个大规模数据集来训练和学习正确的参数集。因为我们需要为每个客户和每个实例训练单独的模型，所以我们处理的是较小的数据集。另一方面，Prophet 在建模季节性方面表现出色，hypermater 调整较少。

通过这次经历，我们得出结论，我们不能使用一种算法来模拟所有类型的成本数据。在预处理步骤中，我们需要根据季节性等一些特征对时间序列进行分类，以了解哪些模型的性能会更好。在选定的模型之间，我们在验证数据集上进行交叉验证，以挑选具有最佳超参数集的最佳模型，因此不同数据的训练和预测时间可能不同。

这些机器学习模型不仅使公司能够准确预测他们的日常云成本，还能从他们的日常云消费中发现成本异常。这些预测使公司能够通过及时解决云服务和资源的异常消费，主动预防不利的云成本影响。

[详细了解【Harness CCM 如何帮助您的团队预测云支出，以免超出预算。](https://harness.io/company/contact-sales)