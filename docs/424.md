# 什么是 GitOps | Harness

> 原文：<https://www.harness.io/blog/gitops>

GitOps:部署、变更等应该像提交 Git 一样简单的理念。了解关于 GitOps 的所有信息——以及 Harness 如何提供帮助。

在本文中，我们将介绍什么是 gitop，组织从[gitop](https://www.harness.io/products/continuous-delivery)中获得什么好处，以及如何为企业扩展 gitop。

在 Harness，我们提供**[**【GitOps-as-a-Service】**](https://harness.io/blog/generally-available-harness-gitops-as-a-service)，构建于流行的云计算原生计算基金会(CNCF)孵化的开源 Argo CD 项目之上。Harness GitOps-as-a-Service 不仅提供了开发人员喜爱的闪电般的快速部署和轻量级操作，而且还提供了企业级安全和大规模治理。**

**如果您想了解如何利用 GitOps-as-a-Service，[请求一个演示](https://harness.io/demo/gitops)。**

## **什么是 GitOps？GitOps 是如何工作的？**

**GitOps 是一种面向希望简化云原生应用部署的公司的方法。无论是添加防火墙规则、定义 VPC，还是修复 UI 错误，所有这些都应该来自源代码控制的中心层面。下面我们详细介绍了使 GitOps 工作流吸引开发者和他们的团队的原则，这些开发者和他们的团队希望以更快、更可靠的方式交付软件。**

## **GitOps 原则**

### **整个系统以声明的方式描述**

**GitOps 关注的是什么，而不是如何做。Kubernetes 是目前最流行的平台，其中所有的应用程序组件都是描述，而不是如何完成构建它们的方向。在声明性范例中，开发人员描述他们想要的状态，他们与之交互的系统确定何时、如何以及在何处以满足所描述的需求的方式放置应用程序。**

**声明式基础设施和声明式配置的主要好处是，它们允许软件开发团队首先关注他们的应用程序，而不是部署和运行时的逻辑。**

### **系统的状态存在于版本控制中**

**在 GitOps 中，Git 存储库充当应用程序所需状态的权威。每一次更改或回滚都是通过 Git 拉取请求、Git 回复和面向版本控制系统的操作来完成的。**

### **自动应用批准的更改**

**在 GitOps 中，应用更改的过程完全由 Git 存储库通过 pull 请求或 merge 请求驱动。在一个特性分支上工作之后，开发人员提交一个 pull 请求，任何适用的 gitop[持续集成](https://harness.io/blog/continuous-integration/what-is-continuous-integration/)管道运行，一旦所需的过程完全满足，变更就被合并。在合并时，主分支作为事实的来源，部署过程由部署的基础设施中的 GitOps 操作者运行，合并后不需要额外的步骤。**

### **漂移固结**

**围绕 GitOps 的大部分兴趣都集中在基于推送的开发方面。随着变更的进行，它被应用到集群中，并且不管这是如何完成的，它都以开发人员部署的变更为中心。 [GitOps](https://www.harness.io/products/continuous-delivery) 的另一半是拉动作，其中应用程序是自我修复的，自我修正以符合期望的状态。**

**基于 Kubernetes 的基础设施已经重启了失败的应用程序实例(pods ),并与期望的状态保持一致。GitOps 将这一原则扩展到应用程序的各个方面。当在配置、部署的映像等方面从应用程序端发现不一致时。GitOps 操作符将源代码控制视为最终权限，并将运行状态与 Git 中的状态对齐。**

## **为什么是 GitOps？**

### **GitOps 之前的生活**

**在不太遥远的过去，本文作者拥有一个电子商务应用程序的部署。该流程涉及部署管道，还涉及许多手动流程，以及对各种内部服务提供商的请求。每六周，部署新的变更，当您包括软件开发过程时，结束一个跨越数月的过程。一些简单的事情，如一些应用程序代码的改变，或者配置文件的修改，是一个大的产品。在出现问题的第一个迹象时，要求退回并进行另一个六周的测试周期。**

**为期六周的准备工作包括在每个生产前环境中进行部署、测试和重新测试。如果变更需要防火墙更新、额外的服务器资源或部署代码库范围之外的任何东西，则每个环境至少需要两周的准备时间，通常更长。在每个较低的环境中进行测试之前，不能为生产启动任何更改，而且跨多个环境的基础架构更改不能在一个六周的周期内完成。**

**这不是一个不寻常的故事；其实很常见。由于所有这些问题，公司正在实施 [GitOps](https://www.harness.io/products/continuous-delivery) 。由于脆弱的、不可重复的、不可扩展的软件开发和部署方法，变化的速度慢得像爬行一样。从下面的 GitOps 模型中可以看到好处。**

### **GitOps 方法的优势**

#### **真理的单一来源**

**任何必须加入工程组织的人可能都非常熟悉与多个权威系统打交道的难题。一个系统用于防火墙，另一个系统用于 DNS，另外几个系统用于调配计算基础架构(如果您在本地以及在云中),一个版本控制系统，以及最后一个 CI/CD 管道工具。除非您的组织有记录一切的特殊文化承诺，否则知道在哪里找到答案就像解析它一样是一项全职工作。**

**GitOps 的一个定义是，GitOps 允许开发人员将他们的版本控制系统作为权威来源来寻找他们关心的每个配置的答案。这样做的好处首先是简化入职流程，提供增强的[开发人员体验](https://harness.io/blog/devops/developer-experience/)，一直到避免可怕的“上下文切换”占用生产时间。**

#### **版本控制**

**对应用程序的每个方面所做的更改都存在于一个地方，并且随着每个更改由拉请求提出并被实现而被版本化。有了代码中的一切，任何更改都可以被审查，并且有完整的文档记录，以及回滚更改的能力。**

#### **基础设施管理民主化**

**从历史上看，每个系统都有一组不同的看门人。网络团队、安全团队、运营团队等等。在 GitOps 之前的世界中，实现连续部署自动化至少受到六个不同团队的支配——以及他们设置的任何繁文缛节。任何更新都需要给定系统的所有者一个漫长的请求过程，并仔细记录变更。**

**开发人员调配云资源是公司管理基础设施的第一个主要偏差。然后是代码为的[基础设施，最后是](https://harness.io/blog/devops/infrastructure-as-code/) [GitOps](https://www.harness.io/products/continuous-delivery) 管道，从而结束了从想法到实现的循环。**

#### **标准化/易用性/简化**

**[变更管理](https://harness.io/blog/continuous-delivery/change-management-continuous-delivery/)和把关的部分原因是为了确保在生产环境中结束的东西映射到较低的环境。由于有许多层的应用程序、配置和基础架构，建立一个新的环境通常需要检查许多事实来源、变更凭证，并最终进行反复试验。**

**所有的基础设施、配置和代码都定义在 Git 存储库中(或 VC 的选择)，构建新环境或跨环境的端口配置的能力不是一个多 sprint 项目。**

#### **速度**

**组织越来越多地标准化度量来测量软件交付的有效性，其中最流行的是 [DORA 度量](https://harness.io/blog/continuous-delivery/dora-metrics/)。衡量的一个关键指标是交付时间，或者用实际的术语来说，从代码提交到变更进入生产所需要的时间。GitOps 自动化方法将持续交付周期时间缩短到推动新变更和新功能所需的最短时间。GitOps 连续交付过程可以减少将新代码投入生产所需的时间。**

#### **较短的反馈回路**

**速度提供了两个好处。让最终用户更快地获得特性本身就很有价值。然后，在顶部添加开发团队获得的关于变更的快速反馈。从拉取请求到用户反馈的时间以月来表示并不罕见。在开发团队转移到另一个项目很久之后，重新访问、提炼和推动变更更加耗时，效率更低，尤其是当有多个迭代的时候。**

## **利用 GitOps 即服务**

**在 Harness，当我们与客户一起大规模实施 GitOps 原则时，我们目睹了大量的挑战。**

### **跨环境推广版本**

**描述测试、QA 和生产[环境](https://harness.io/blog/continuous-delivery/deployment-environments/)之间的期望状态变得越来越困难。在撰写本文时，实践者被分成几个可能的解决方案，包括每个环境使用一个分支。**

**这引入了一系列潜在的问题，尤其是代码没有按照正确的顺序正确地合并到所有的分支中。继续计算，在这种运营模式下，您最终会在许多环境和应用程序中拥有多少个存储库。**

**如果没有明确的解决方案，组织要么不会采用，要么会在特定的环境中采用，要么会将不同的实践变成一种技术债务。**

**Harness 选择了 [Argo CD](https://harness.io/learn/comparison-guide/argocd-vs-harness) 来采用 GitOps，因为它提供了使用“应用中的应用”模式的能力，至少解决了大规模管理基础设施的部分问题。当不再有单个 Kubernetes 集群需要管理时——而是随着更多团队实施 GitOps 工作流而有越来越多的集群需要管理——整个组织中的问题会加剧。有了父应用程序，跨多个应用程序的级联更改不再是入门的障碍，并有助于集群管理。**

**GitOps-as-a-Service 通过提供拉请求管道进一步解决了这个问题。通过在标准 GitOps 部署的基础上添加一个管道编排层，pull 请求管道的添加使得跨多个服务和环境传播更改变得容易，而不必单独管理每个部署。**

### **审计**

**使用 [GitOps](https://www.harness.io/products/continuous-delivery) ，Git 日志提供了所有更改的明确记录。但是，作为审计跟踪，搜索更改并将其与业务或法规影响直接联系起来可能会成为一种负担。在 Git 中，所有的提交都被记录下来，但是每个提交的含义都需要花费时间和精力去挖掘——特别是对于非技术人员来说。如果没有额外的功能来简化对大量拉取请求或合并请求的排序，审计跟踪就只能到此为止。**

**GitOps with Harness 提供了所有部署和变更的完整审计日志，通过跟踪可以进行操作和业务级别的分析，而不需要挖掘 Git 提交。搜索 Git pull 请求和文件直到代码级别仍然是一个选项，但它不再是必需的起点。**

### **GitOps 涵盖了 SDLC 的一部分**

**众所周知，GitOps 方法本身的局限性是，[软件开发生命周期](https://harness.io/blog/devops/software-development-life-cycle/)的许多部分没有被涵盖，因为它不是一个通用的解决方案或灵丹妙药。编译代码、运行单元测试、集成测试、安全扫描等等需要更多的工具和流程来支持 GitOps 的持续部署模型。**

**Harness 平台提供了内置的 GitOps 作为整体解决方案的一部分，涵盖了持续集成和持续部署生命周期中的所有内容。这里有必要做一个区分，因为 GitOps 遵循的理念是立即将所有东西推活。除了 GitOps 功能之外，Harness 还围绕您的流程提供完整的交付渠道，包括批准、受控功能发布、淡黄色/蓝色/绿色推广策略，以及[持续验证](https://harness.io/blog/continuous-verification/continuous-verification-demystified/)。**

### **按比例放大**

**许多应用程序和环境都面临着一系列规模挑战。随着 Git 存储库数量的激增，很快就很难跟踪环境和配置。集中和真正的自治很快成为一个真正的问题，因为当给予团队自治时，应用公司范围的变更或策略成为一种负担，与集中配置和创建大瓶颈的权衡形成对比。随着人才争夺战的展开和以开发者为中心的体验的必要性，大规模建立 GitOps 会成为一种负担。**

**由于 GitOps 是一种非常以开发人员为中心的、去中心化的软件交付方法，DevOps 团队的负担是提供必要的工具，而不是一切都变成蛮荒的西部。与平台为 SDLC 的其他部分提供的好处一样，Harness 也为管理 GitOps 提供了一个集中的管理平台，同时为开发团队提供了所需的自主权。**

**该平台希望解决的几个关键挑战是提供项目级空间、健壮的基于角色的访问控制(RBAC)以及由 OPA 支持的代码为的[策略。将划分空间、提供适当的访问并最终通过被描述为代码的策略进行治理的能力结合起来，允许 DevOps 团队完全控制日常操作，而不需要在团队如何构建他们的软件方面进行过多的实践或规定。](https://harness.io/blog/harness-policy-as-code)**

## **采用 GitOps**

**希望在您的组织中采用 GitOps，并想了解更多信息？查看我们的[网络研讨会](https://harness-1.wistia.com/medias/ohh6iv06h0)，深入了解 GitOps、如何采用、潜在陷阱以及如何将 GitOps 扩展到下一个级别。**

**无论您在 GitOps 的旅程中处于什么位置，从探索到经验丰富的专业人士，我们都希望这对您有所帮助。如果您想了解 [GitOps 与 Harness](https://harness.io/gitops-beta/) 的合作，请与我们交流，我们将分享我们对 GitOps 机遇的看法，以及我们如何应对挑战。**

**[立即申请您的演示](https://harness.io/demo/)！**