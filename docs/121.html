<html>
<head>
<title>Your First Kubernetes Cluster Deployment | Harness</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>您的第一个Kubernetes集群部署|工具</h1>
<blockquote>原文：<a href="https://www.harness.io/blog/kubernetes-cluster-deployment#0001-01-01">https://www.harness.io/blog/kubernetes-cluster-deployment#0001-01-01</a></blockquote><div><p>有了这么多的Kubernetes产品，让我们走一条阻力最小的路，让您的第一个集群嗡嗡作响。</p><div fs-richtext-element="rich-text" class="blog-rtf w-richtext"><p>既然我们已经了解了容器的用途，以及构成广受欢迎的容器编排器Kubernetes的重要部分，那么是时候构建一个小型集群了。Kubernetes作为一个项目进展非常快，只有最近<a href="https://gravitational.com/blog/kubernetes-release-cycle/" target="_blank">发布的节奏</a>慢了下来。</p><p>由于项目的流行和速度，在考虑Kubernetes供应商时，肯定有很多选择。供应商们试图用一系列关于运营和附加价值的处方来区分他们自己与“仅仅是另一个Kubernetes供应商/平台”的污名。</p><p>来自提供以下服务的公共云供应商的竞争非常激烈</p><p><a href="https://cloud.google.com/kubernetes-engine/" target="_blank">谷歌的Kubernetes引擎</a>和<a href="https://aws.amazon.com/eks/" target="_blank">亚马逊的弹性Kubernetes服务</a>到<a href="https://harness.io/blog/what-is-paas/" target="_blank">的平台即服务</a>供应商，如Red Hat的OpenShift和Pivotal的PKS，争夺mindshare和你辛苦赚来的美元。</p><p>请随意浏览博客文章或视频，了解创建自己的Kubernetes集群的策略！我们现在将跳过一些操作项目，将重点放在您的第一个K8s部署上，不一定是管理平台。</p><h2>观察和学习</h2><p>一个关于在你的Mac上使用自制程序运行Minikube并运行本教程中的<a href="https://github.com/ravilach/harness/blob/master/minikubecommands" target="_blank">命令的简短视频。<br/></a></p><figure class="w-richtext-align-center w-richtext-figure-type-image"/><h2>Minikube -当地Kubernetes</h2><p>在我看来，在你的笔记本电脑上与Kubernetes互动的最快方式是<a href="https://github.com/kubernetes/minikube" target="_blank"> Minikube </a>。Minikube自2016年夏天以来一直存在，并试图匹配Kubernetes的次要发布版本。<br/>使用像<a href="https://brew.sh/" target="_blank">家酿</a>这样的软件包管理器，在你的Mac上安装Minikube非常简单。你还需要虚拟化部分，即<a href="https://www.virtualbox.org/" target="_blank"> VirtualBox </a>。如果你的安装方法没有附带VirtualBox，VB是一个<a href="https://www.virtualbox.org/wiki/Downloads" target="_blank">快速安装</a>。</p><p>您可以按照以下步骤从Homebrew安装Minikube和VirtualBox。</p><ul role="list"><li>从终端安装自制软件。</li><li>使用终端命令“<em>brew tap caskroom/木桶</em>”加入更多软件的木桶通道。</li><li>用<em>安装VirtualBox“brew木桶安装virtualbox </em>”。</li><li>用“<em>brew buck安装minikub </em> e”安装Minikube/KubeCTL。</li><li>默认情况下，分配4GB内存。安装minikube后，您可以使用“<em> minikube配置设置内存8128 </em>”提供更多资源，例如8GB。</li><li>用“<em> minikube start </em>”启动Minikube。</li><li>使用“<em> minikube dashboard </em>”启动您的K8s仪表盘。</li></ul><p>有了这些步骤，您就可以开始使用<a href="https://kubernetes.io/docs/reference/kubectl/overview/" target="_blank"> KubeCTL </a>命令行界面了！</p><h2>先有鸡还是先有蛋？</h2><p>在第二部分中，我们讨论了与Kubernetes集群交互的机制。KubeCTL，Kubernetes的命令行接口，是主要的机制之一。</p><p>如果这是您第一次安装Minikube，那么最新版本的KubeCTL将与Minikube内部最新版本的Kubernetes相匹配，因为KubeCTL将与Minikube Brew安装程序一起安装。KubeCTL和Kubernetes的版本需要匹配，否则将来可能会出现一些奇怪的API警告。</p><p>我倾向于先安装KubeCTL，然后将我的Kubernetes集群连接到KubeCTL。好消息是您可以有不止一个<a href="https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters/" target="_blank"> KubeCTL Context </a>这意味着您可以有不止一个集群。虽然对于这个例子来说，让Minikube安装程序来处理是非常好的，你可以专注于更难的东西，如YAML。</p><h2>一点YAML不会伤害任何人</h2><p><a href="https://yaml.org/" target="_blank"> YAML </a>又名“另一种标记语言”是Kubernetes中使用的主要描述符语言。Kubernetes最大的一个好处就是Kubernetes是声明性的；你只要说出你想要什么，其余的就由K8公司解决了。我们可以描述一个应用程序，比如说一个功夫金丝雀应用程序的端点。</p><p>如果您以前没有和YAML打过交道，请注意YAML是空间分离的，不一定依赖于数据结构。喘息标签vs太空战肆虐。对于命令行人员来说，我鼓励使用某种类型的<a href="https://github.com/adrienverge/yamllint" target="_blank"> linter </a>(代码验证器)。</p><p>掌握YAML语法非常简单。Kubernetes使用YAML地图和YAML列表来描述州/ a部署。维基百科对YAML语法有很好的解释。在Harness，我们将为您提供一只功夫金丝雀，让您继续学习。</p><h2>功夫金丝雀，你的第一次部署！</h2><p>我们可以用这个简单的<a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" target="_blank">部署</a>作为例子。在Kubernetes中，部署是一个<a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/" target="_blank"> Pod </a>和<a href="https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/" target="_blank">副本集</a>的声明性/期望状态。部署的好处是能够整体管理部署；它可以删除、恢复等。</p><p>我把<a href="https://github.com/ravilach/harness/blob/master/kung-fu-canary.yaml" target="_blank">功夫金丝雀</a>的部署贴在了<a href="https://github.com/ravilach/harness/blob/master/kung-fu-canary.yaml" target="_blank"> GitHub </a>上，供你复制粘贴。请随意下载用于练习。<br/></p><figure class="w-richtext-figure-type- "/><p><br/>让我们来分解一下这个辉煌的功夫-canary.yaml的几个片段。我们定义这个特殊的资源/YAML是一个部署。我们定义了我们的部署规范，即我们需要最小数量的副本，以及在有更新/升级的情况下应该做什么，并定义了关于如何执行<a href="https://kubernetes.io/docs/tasks/run-application/rolling-update-replication-controller/" target="_blank">滚动更新</a>的策略。</p><p>Kubernetes只对其声明的内容和解释的内容采取行动。<a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/" target="_blank">准备就绪和活性检查</a>很重要。如果没有它们，Kubernetes只会在发生诸如<a href="https://www.gnu.org/software/libc/manual/html_node/Termination-Signals.html" target="_blank"> Sig-Term </a>完全杀死一个容器的事件时重新启动/补充你的容器。准备就绪</p><p>活动检查可以提供更多关于运行中的应用程序的信息，以及在应用程序不健康时应该做什么。带着那只功夫金丝雀。YAML，开始部署！</p><h2>一些KubeCTL命令</h2><p>记住少数命令会让你在K8s世界里变得危险。让我们来看看KubeCTL应用、获取、描述和扩展。Kubernetes文档确实有一个冗长的备忘单，但是我们可以在这里把重点放在基础上。</p><p>首先要使用的命令之一是“kubectl apply”。随着<a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#apply" target="_blank">应用</a>命令，您正在执行您的可部署YAML。我比我需要在Kubernetes中执行的大多数操作都更坚持，我把版本控制留在YAML，等等。可以用"<em>kube CTL apply-f kung-fu-canary . YAML</em>"部署我们的功夫金丝雀<a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" target="_blank">部署</a>。现在正在部署您的第一个部署！</p><p>您可以在终端中导航到WebUI["<em>minikube dashboard</em>]以查看您的部署！<br/></p><figure class="w-richtext-figure-type- "/><p><br/>现在您已经完成了第一次部署，让我们来看看幕后发生了什么。使用<a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#get" target="_blank"> Get </a>命令，我们可以获得一个运行Pod的列表(还记得来自<a href="https://harness.io/blog/kubernetes-container-sprawl/" target="_blank">第二部分</a>强大的Pod)或者其他指定的资源</p><p>现在我们知道了我们的豆荚，我们可以更深入地看看它们。使用<a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#describe" target="_blank"> Describe </a>命令，您可以查看详细信息或资源，在本例中是我们的功夫金丝雀Pod。从"<em> kubectl get pods </em>"列出的pod中，让"<em>ku bectl describe Pod _ id</em>"描述Pod。看那可爱的州信息。</p><p>如果我们需要副本集或多或少的火力呢？我们的功夫金丝雀部署示例利用了三个副本。如果我们想把数量增加到四个呢？<a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#scale" target="_blank"> Scale </a>命令可以设置多个资源的新大小。只需运行"<em>ku bectl scale-current-Replicas = 3-Replicas = 4 deployment/kung-fu-canary</em>"即可从3个副本扩展到4个副本。</p><h2>奖励命令:暴露</h2><p>如果不能访问我们的应用程序，我们的应用程序将会非常孤独。暴露T21命令将创建一个服务来暴露你的应用程序。为了以最简单的方式公开我们的功夫-金丝雀部署，可以运行"<em>kubectl expose deployment kung-fu-canary-port = 80-type = load balancer</em>"。可以通过运行"<em> kubectl cluster-info </em>"找到您的集群的公共IP地址，这是主服务器在Minikube中运行的地方</p><p>您可以使用“<em>ku bectl describe service kung-fu-canary</em>”来检查您的新服务。记下节点端口。要访问您的nginx实例，可以欺骗并使用Minikube命令"<em>Minikube service kung-fu-canary</em>"，这将自动为您显示public_ip:NodePort。<br/></p><figure class="w-richtext-figure-type- "/><h2>清除</h2><p>一旦我们都完成了这个示例部署，就像一个好公民一样，我们可以清理我们所做的事情。</p><p>使用<a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#delete" target="_blank"> Delete </a>命令，我们可以删除已经完成的部署。我们将我们的可部署包到一个部署中，这样就可以简单地运行"<em>kubectl delete deploy/kung-fu-canary</em>"可以验证您的pods已经消失，并且没有功夫Pods出现，或者我们信任的朋友没有返回任何资源。</p><p>如果您选择运行奖励命令，可以删除暴露功夫金丝雀的服务，该服务被方便地命名为功夫金丝雀，并带有"<em>kubectl delete Service kung-fu-canary</em>"可以验证服务是与“<em> kubectl get services </em>”和功夫-金丝雀不应该在那里。</p><p>最后，我们可以通过运行“<em> minikube stop </em>”来关闭我们忠实的老朋友Minikube如果你想从头开始或做更多的修改，可以运行<em> minikube delete </em></p><h2>实际的Kubernetes星团呢？</h2><p>在我们的下一部分，第四部分，我们将开始谈论Kubernetes集群本身。重要的是，把你的应用程序和Kubernetes平台分开。您的应用程序和Kubernetes集群都有不同的伸缩机制。</p><p>一个TL；灾难恢复方面，大多数Kubernetes操作都是添加/减少节点、更换可插拔部件以及升级平台。和其他软件一样，这里没有什么神秘之处。</p><h2>驾驭，增强您的Kubernetes部署</h2><p>当我们剥开Kubernetes的洋葱皮时，Kubernetes预成型的“魔术”归结为一个声明式驱动的系统。我们描述最终状态，Kubernetes通过调度器和资源管理器功能努力提供我们所描述的内容。尽管完成更复杂的任务，比如canary发布或发布验证，需要几个精心编排的步骤和这些步骤的底层描述。</p><p>Harness平台让这些项目变得异常简单。现在，凭借您的Kubernetes知识，您可以将<a href="https://ngdocs.harness.io/article/2k7lnc7lvl-delegates-overview" target="_blank">控制代理</a>安装到Kubernetes环境中，<a href="https://community.harness.io/t/minikube-setup-with-harness/22" target="_blank">甚至是Minikube </a>！请继续关注博客系列的第四部分，操作化。<br/>-拉维</p></div></div>    
</body>
</html>