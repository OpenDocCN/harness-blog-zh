# Harness | Harness 中的 Git 同步体验

> 原文：<https://www.harness.io/blog/git-sync-experience>

Git Sync 可以节省您的时间，并使 CI/CD 更容易！只需在 Git 中创建和修改 YAML 文件，就可以创建和维护新的管道。

DevOps 的出现模糊了开发和部署之间的界限。现在，工程团队需要创建、维护和使用配置以及持续集成和持续交付(CI/CD)管道。对于开发人员来说，在向导中创建配置，然后单击 next 的传统方式是一个很大的麻烦。我们更喜欢用编写代码的方式来编写配置。Git Sync 体验的主要目标是让我们用户的 CI/CD 体验像编写代码一样简单。

使用 Git Sync，我们希望创造一种出色的开发人员体验，使我们的用户能够:

1.  在 Git 中存储和检索它们的线束配置。
2.  只需更改 Git 中的 YAML 文件，就可以更改线束配置。
3.  只需在 Git 中添加管道 YAML，即可轻松地为新创建的微服务创建 CI/CD 管道。
4.  像维护代码一样维护他们的配置。

## **挑战和解决方案**

### **Git 同步**

Git 体验最重要的部分是允许双向同步(UI 端的更改应该推送到 Git，Git 端的更改应该反映在 Harness 中)。

在相同的数据存储在两个不同的地方的情况下，我们必须决定哪一个地方是真实的来源。我们在这里遵循 GitOps 哲学，它将 Git 作为真理的来源。这个决定将向我们的客户保证，无论他们在 Git 中看到什么都是真实的状态，并且他们不需要访问 UI 来确认它。每当用户在启用 Git Sync 的项目中进行更改时，我们首先将更改推送到 Git，然后在 Harness 中应用这些更改。

我们解决的下一个挑战是如何将线束变更推送到 Git。想到的简单解决方案如下:

1.  每当对 Harness 进行更改时，如果 Git repo 不存在，就克隆它。
2.  将更改添加到 Git repo 中。
3.  提交并推动变更。

这种克隆完整的 Git repo 并在本地维护它的方法是不可伸缩的。下一个解决方案是使用各种 Git 提供者提供的 API。我们创建了一个开源的 [scm 服务](https://github.com/drone/go-scm)，它是所有公共 Git 提供者的包装器。为了将更改推送到 Git，我们向 SCM 服务发送一个请求，SCM 服务将更改推送到相应的 Git 提供者。一旦更改被推送到 Git 端，我们就在 Harness 端应用这些更改。

下一个问题是:我们如何将用户在其 Git 文件中的更改应用到 Harness？

我们使用 Git 提供者的 webhooks 特性来解决这个问题。每当用户提交对配置存储库的更改时，我们都会在 Harness 端收到 webhook 请求。请求包含了关于变更的细节，我们用它来将变更应用到线束实体。

## 多重回购支持

开发人员可以遵循各种模式来存储他们的配置文件。常见模式包括:

1.  配置文件与代码库一起存储。
2.  配置文件存储在与代码分开的存储库中。
3.  将生产配置存储在一个存储库中，将非生产配置存储在另一个存储库中，以便只有选定的开发人员可以访问生产配置。
4.  将不同环境的配置文件存储在不同的分支中。
5.  将管道存储在一个存储库中，将其他配置文件存储在另一个存储库中。

我们确保我们的设计足够灵活，能够支持上述所有用例。

用户可以在同一个项目中使用多个 Git 存储库。在推送每个配置之前，我们要求用户选择他们想要将变更推送至的存储库。这为用户提供了灵活性，以他们想要的方式维护他们的 Git 存储库。

**线束文件夹**

所有线束图元都同步到。用户存储库中的线束文件夹。我们处理。线束文件夹并忽略其他文件。在里面。线束文件夹，用户可以存储他们的 YAML 文件在任何文件夹结构，他们想要的。

他们可以将所有连接器一起存储在一个文件夹中，将管道存储在另一个文件夹中，或者他们可以按项目/团队对 YAML 文件进行分组。这种灵活性允许用户将线束配置与其代码一起存储，或者单独存储在不同的存储库中。用户可以在所有文件夹中选择默认文件夹。

## 摘要

Git Sync 为现代 DevOps 解决方案带来了巨大的潜力。它提供了一种简单的方法来进行配置更改，并帮助开发人员减少设置和维护 CI/CD 管道的总时间。

大多数组织中的 CI/CD 流程都是单调乏味的手动流程。运营团队最终维护、更新和运行管道。此外，从开发团队到运营团队的沟通不匹配会导致 prod 问题。这就是 Git Sync 让您的生活变得简单的地方:您可以通过简单地在 Git 中创建/修改 YAML 文件来创建和维护新的管道。

请保持警惕，周一我们将发布一篇关于 Git 分支的姊妹文章。同时，为什么不仔细阅读我们新的 [GitOps 公告](https://harness.io/blog/harness-gitops-deployments/)？

编辑:关于 [Git 分支](https://harness.io/blog/git-branching/)的文章现已上线！

*本文由 Deepak Patankar、Abhinav Singh、Akash Nagarajan 和 Rama Tummala 合作撰写。*