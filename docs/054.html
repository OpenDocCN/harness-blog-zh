<html>
<head>
<title>Welcome to the Harness Family, Kustomize! | Harness</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>欢迎来到线束家族，Kustomize！装具</h1>
<blockquote>原文：<a href="https://www.harness.io/blog/welcome-to-the-harness-family-kustomize#0001-01-01">https://www.harness.io/blog/welcome-to-the-harness-family-kustomize#0001-01-01</a></blockquote><div><p>在帮助实现 Kubernetes 内部的配置和包管理的竞赛中，Kustomize 和 Helm 是两个非常受欢迎的工具，分别在这些领域提供帮助。</p><div fs-richtext-element="rich-text" class="blog-rtf w-richtext"><p>在帮助实现 Kubernetes 内部的配置和包管理的竞赛中，<a href="https://kustomize.io/"> Kustomize </a>和<a href="https://helm.sh/"> Helm </a>是两个非常受欢迎的工具，分别在这些领域提供帮助。我们最近欢迎了<a href="https://harness.io/blog/product-updates/welcome-to-the-harness-family-helm-v3/">头盔 V3 </a>加入线束家族，我们也非常兴奋地欢迎<a href="https://developer.harness.io/docs/continuous-delivery/onboard-cd/cd-quickstarts/kustomize-quickstart/"> Kustomize 加入线束家族</a>！</p><p>一个常见的比较是在赫尔姆和 Kustomize 之间。这两个项目有不同的目标；Kustomize 是为成为一名配置经理而设计的，而 Helm 并没有自称是一名配置经理。</p><h3>为什么 Kustomize 产生喧嚣？</h3><p>如果你在最新发布的 Helm aka <a href="https://helm.sh/docs/"> Helm V3 </a>之前沿着记忆之路走一趟，Helm 需要安装<a href="https://v2.helm.sh/docs/install/">舵柄</a>和<a href="https://v2.helm.sh/docs/using_helm/#installing-helm">舵柄客户端</a>。Kustomize 从早期就有能力被<a href="https://kubernetes.io/blog/2018/05/29/introducing-kustomize-template-free-configuration-customization-for-kubernetes/"> Kubernetes 的 CLI </a>，<a href="https://kubectl.docs.kubernetes.io/pages/app_management/introduction.html"> KubeCTL </a>执行。作为一名配置经理，这一点很重要，因为想象一下一个新创建的 Kubernetes 集群启动并运行，开始利用 Kustomize 不需要在集群上安装额外的客户机。Harness 使在您的基础设施和部署中利用 Kustomize 变得轻而易举。</p><h3>去 Kustomize 'ing</h3><p>利用 Kustomize 文档是一个很好的起点。像往常一样，你可以观看视频和/或跟随博客。</p><h4>Kubernetes 基础设施设置</h4><p>在我的例子中，我将使用亚马逊 EKS，并在 EKS 集群中安装一个 Kubernetes 代理。<br/></p><p>安装一个<a href="https://developer.harness.io/docs/first-gen/continuous-delivery/kubernetes-deployments/connect-to-your-target-kubernetes-platform/">Harness Kubernetes Delegate</a>非常简单。登录<a href="https://app.harness.io/">驾驭平台</a>，如果你还没有运行 Kubernetes 代理，进入设置- &gt;驾驭代理。<br/></p><p>在“下载代表”下，选择 Kubernetes YAML。<br/></p><p>为线束代理提供一个名称，在这种情况下，我们可以将所有代理“kustomize”。<br/></p><p>点击“提交”后，将会下载一个包含所有所需内容的 tar.gz。展开 tar.gz。<br/></p><p>在展开的文件夹中，只需运行<em>ku bectl apply-f harness-delegate . YAML</em>即可启动并运行您的代理。如果您的 KubeCTL 没有连接到您的 EKS 集群，可以运行一个 helper 方法，用<em>AWS eks-region your-region update-kube config-name your-cluster-name 注入<a href="https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/"> Kubeconfig </a>。</em></p><p>可以运行<em>ku bectl get pods-n Harness-Delegate</em>来获取线束代理的状态。<br/></p><p>回到线束 UI，可以验证代理是否已连接。<br/></p><p>一旦连接了委托，为了将 Git 位安装到 Harness Kubernetes CLI 中，我们可以创建一个<a href="https://docs.harness.io/article/nxhlbmbgkj-common-delegate-profile-scripts#git_cli">委托概要文件</a>来安装 Git CLI。<br/></p><p>设置-&gt;利用代理-&gt;管理代理配置文件+添加代理配置文件“安装 Git”<br/></p><p><em> apt-get 更新</em> <br/> <em> #自动批准安装 Git</em><br/><em>是| apt-get 安装 git </em> <br/> <em> #检查 Git 安装</em><br/><em>Git-version</em><br/></p><p>点击 submit 后，在委托中，点击 Profile -&gt; Install Git</p><p>应该需要几分钟的时间来执行。您可以通过点击最后执行日期旁边的 View Logs 来查看概要文件执行日志，从而验证是否已经安装了 Git。<br/></p><p>接下来，您可以将您的 Kubernetes 集群连接为一个<a href="https://developer.harness.io/docs/first-gen/firstgen-platform/account/manage-connectors/add-kubernetes-cluster-cloud-provider">云提供商</a>。</p><p>设置-&gt;云提供商+添加云提供商<br/></p><p>添加一个名为“EKS 集群”的云提供商，类型为<em> Kubernetes 集群</em>。因为我们将 Harness 委托安装到了 EKS 集群中，所以我们可以从一个委托(在本例中是委托“kustomize ”)继承细节。<br/></p><p>当您单击 Submit 时，Kubernetes 集群将可用于工作负载。<br/></p><p>一旦集群连接起来，就该开始挖掘 Kustomize 部分了。</p><h4>Kustomize 工作流程</h4><p>Kustomize 的<a href="https://developer.harness.io/docs/continuous-delivery/cd-advanced/kustomize-howtos/use-kustomize-for-kubernetes-deployments/">线束文档</a>是帮助您入门的绝佳资源。在这个例子中，你将利用<a href="https://github.com/kubernetes-sigs/kustomize/tree/master/examples/multibases"> Kustomize 的多基地例子</a>展示环境变量的使用，例如开发/生产作为<a href="https://kubernetes.io/docs/tasks/manage-kubernetes-objects/kustomization/">覆盖</a>。<br/></p><p>接下来，您需要将 Kustomize GitHub 库连接到 Harness。</p><p>设置-&gt;连接器-&gt;源回购提供者+添加源回购提供者<br/></p><p>添加<em>https://github.com/kubernetes-sigs/kustomize</em>的存储库细节，包括您的 GitHub 凭证，并指定<em> master </em>作为分支名称。<br/></p><p>单击提交后，您的存储库将可用。<br/></p><p>您现在可以创建一个<a href="https://docs.harness.io/article/bucothemly-application-configuration">线束应用程序</a>来尝试 Kustomzie 集成。</p><p>设置-&gt; +添加应用程序<br/></p><p>创建一个名为“Hello World”的应用程序<br/></p><p>单击 Submit 后，您就可以创建一个<a href="https://developer.harness.io/docs/first-gen/continuous-delivery/model-cd-pipeline/setup-services/add-service-level-config-variables/">线束服务</a>。</p><p>设置-&gt; Hello World -&gt;服务+添加服务<br/></p><p>创建一个名为“Multibases”的服务，部署类型为<em> Kubernetes </em>。<br/></p><p>一旦你点击了提交，就该进行 Kustomization 配置了。在 Multibases 服务的 Manifests 部分，单击省略号-&gt;链接远程清单。<br/></p><p>链接远程清单时，选择定制化配置。源存储库将是您之前链接的 GitHub 存储库。对于 kustomization 目录的路径，这将是<em>examples/multi base/$ { env . name }</em>。有了<em> env.name </em>的变量，我们可以指向一个特定的环境。<br/></p><p>一旦你点击提交，清单应该已经链接。<br/></p><p>当创建一个<a href="https://developer.harness.io/docs/first-gen/continuous-delivery/model-cd-pipeline/environments/environment-configuration/">线束环境</a> t 时，我们可以模仿多基座示例结构。<br/></p><p>您可以创建两个环境，“开发”和“生产”。</p><p>设置-&gt; Hello World -&gt;环境+添加环境<br/></p><p>可以先加上“dev”。<br/></p><p>单击提交后，您可以添加基础结构定义。<br/></p><p>创建一个名为<em> dev_eks </em>的<a href="https://developer.harness.io/docs/first-gen/continuous-delivery/model-cd-pipeline/environments/infrastructure-definitions/">基础设施定义</a>，作为云提供商类型<em> Kubernetes </em>集群，部署类型<em> Kubernetes </em>，并为您之前连接的 Kubernetes 集群选择云提供商。<br/></p><p>单击提交后，您的基础结构定义就可用了。<br/></p><p>对<em>产品</em>的线束环境重复该过程。</p><p><em>产品</em>的基础设施定义。<br/></p><p>现在您可以创建一个<a href="https://developer.harness.io/docs/first-gen/continuous-delivery/model-cd-pipeline/workflows/workflow-configuration/">利用工作流</a>来运行您的 Kustomization 部署。</p><p>设置-&gt; Hello World -&gt;工作流+添加工作流<br/></p><p>我们可以设置 Hello Kustomize 工作流。现在让工作流指向你的<em>开发</em>基础设施。<br/></p><p>创建完成后，我们可以通过展开工作流变量部分并单击铅笔图标来添加一个<a href="https://developer.harness.io/docs/first-gen/continuous-delivery/model-cd-pipeline/expressions/passing-variable-into-workflows/">工作流变量</a>。<br/></p><p>创建一个名为 Environment 的工作流变量，并将<em> dev，production </em>添加到列表中，以模拟多基地示例和您的线束环境。<br/></p><p>一旦你点击保存，现在你可以运行你的第一个例子。在工作流概述中，单击部署。<br/></p><p>在 Start New Deployment 窗口中，选择<em> dev </em>作为环境值。<br/></p><p>点击提交运行和繁荣！<br/></p><p>您还可以弹出<a href="https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/"> Kubernetes UI </a>并查看正在创建/追加的<a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/">配置映射</a>。<br/></p><p>祝贺你的第一次 Kustomize 部署！在 Harness，我们是您的合作伙伴。<br/></p><h3>马具——你在 Kubernetes 的伙伴</h3><p>许多组织正在经历 Kubernetes 之旅。在 Harness，我们是 Kubernetes 内外工作负载的权威持续交付平台。我们的客户和社区都支持 Kustomize。随着 Kubernetes 生态系统的不断发展和成熟，Harness 将会出现。请随时带着工具<a href="https://harness.io/platform/" target="_blank">软件交付平台</a>出去兜风，并立即注册！<br/></p></div></div>    
</body>
</html>