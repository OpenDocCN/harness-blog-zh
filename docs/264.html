<html>
<head>
<title>Automated CI CD Rollback to 30 Seconds | Harness</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>自动CI CD回滚到30秒|线束</h1>
<blockquote>原文：<a href="https://www.harness.io/blog/automated-ci-cd-rollback#0001-01-01">https://www.harness.io/blog/automated-ci-cd-rollback#0001-01-01</a></blockquote><div><p>Build.com取消了他们大部分的核查工作。找出你也能做到的方法。</p><div fs-richtext-element="rich-text" class="blog-rtf w-richtext"><p>潜在客户和分析师有时会问“是的，我得到了控制，但是您真的有在生产中自动部署、验证和回滚的客户吗？”是的，实际上，我们有。自动化听起来很可怕，但话说回来，把你的任务关键型应用程序搬到云中的大型书店也同样可怕。<br/></p><p>在我继续之前，我只想对Ed、Tim和Build.com的团队大声疾呼，他们是Harness的早期信徒，更重要的是，他们非常相信CI/CD和使用机器学习来自动化生产部署的验证和回滚。<br/></p><p>以下是他们如何在短短几周内成功实现端到端部署流程自动化的案例:</p><h2>部署管道</h2><p>下面的第一个截图显示了Build.com的实际部署流程，由7个不同的阶段和工作流程组成:</p><ul role="list"><li>阶段1和2–开发和测试工作流(并行执行)</li><li>阶段3至5—edu/沙盒/试运行工作流(并行执行)</li><li>第6阶段–人工批准</li><li>第7阶段–生产工作流程</li></ul><figure class="w-richtext-figure-type- "/><p>您可以看到，在生产工作流失败的阶段7之前，部署管道看起来很坚固。</p><h2>失败的生产工作流程</h2><p>下面我们可以更详细地看到失败的生产流程。<br/></p><p>工作流从canary部署开始，第1阶段升级20%的生产环境。接下来，Harness在New Relic中标记这个新部署，然后立即连接到New Relic和Sumo逻辑，以验证服务/应用程序的性能和质量。<br/></p><p>在此验证过程中，Harness无监督机器学习算法开始分析、比较和标记两种工具从应用程序中捕获的数千个日志条目和时序指标中的异常/回归。</p><figure class="w-richtext-figure-type- "/><p>从上面的截图可以看出，应用程序性能验证成功，但应用程序质量验证失败。这通常表明Harness观察到了一些独特和意想不到的事情，通常是服务/应用程序中引入的新事件、错误或异常。</p><h2>使用机器学习进行连续验证</h2><p>在利用之前，6到7名团队领导将花费60分钟来验证每个生产部署。现在，一名工程师可以在几分钟内完成这项工作。<br/></p><p>下面是一个截图，确认了为什么上述应用程序质量验证步骤失败。通过分析Sumo Logic中的应用程序日志数据，Harness的机器学习算法能够检测到四种新的质量回归。具体来说，Harness检测到4个新的异常，这些异常在之前的任何部署中都没有发现过。<br/></p><p>您在下图中看到的灰点代表“基线事件”或“集群”——这些是Harness随着时间的推移了解到的事件，被归类为“正常”，因为它们在部署期间经常被观察到。红点代表未知事件或发生频率出乎意料的事件。在生产部署过程中，这些通常是让你头疼的事情。</p><figure class="w-richtext-figure-type- "/><p>在检测到这些退化的几秒钟内，Harness执行了一个“智能回滚”，将服务/应用程序带回到上一个工作版本(工件和运行时配置)。值得一提的是，智能回滚可以作为工作流的一部分完全自动化，也可以通过手动干预(人工)来控制。</p><h2>智能回滚(32秒内)</h2><p>如果我们放大上述工作流的顶部，您将看到在canary部署的第1阶段失败后确实发生了回滚的视觉确认:</p><figure class="w-richtext-figure-type- "/><p>也许这次部署失败最令人满意的方面是自动回滚到前一个工作版本所花费的时间…..仅仅<strong> 32秒</strong>。上次我在10月份与ed、Tim和团队聊天时，他们告诉我，由于脚本、依赖项和配置的数量，他们平均需要32分钟来手动回滚生产部署。Build.com是仅次于家得宝的第二大电商市场，电商收入超过<a href="https://www.forbes.com/sites/georgeanders/2016/01/04/whod-start-a-tech-firm-in-chico-chris-friedlands-zany-path-to-riches/#7b7864ea50b7">5亿美元</a>，所以每一分钟的停机和回滚都很重要。</p><figure class="w-richtext-figure-type- "/><p>因此，这证明了今天可以端到端地自动化您的整个CI/CD流程。在Build.com的案例中，他们使用Jenkins进行持续集成，使用Harness进行持续交付，使用<a href="https://harness.io/platform/continuous-delivery/continuous-verification/">对New Relic和Sumo逻辑数据进行持续验证</a>。更好的是，这部电影中没有人因为机器学习的使用而受到伤害或被取代。</p></div></div>    
</body>
</html>