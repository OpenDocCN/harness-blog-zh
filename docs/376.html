<html>
<head>
<title>GitHub Actions Support in Harness CI | Harness</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>线束配置项|线束中的 GitHub 操作支持</h1>
<blockquote>原文：<a href="https://www.harness.io/blog/github-actions-support-harness-ci#0001-01-01">https://www.harness.io/blog/github-actions-support-harness-ci#0001-01-01</a></blockquote><div><p>GitHub 动作允许您创建可以执行预定义任务的自定义动作。了解如何在利用 CI 中使用它们来增加可扩展性。</p><div fs-richtext-element="rich-text" class="blog-rtf w-richtext"><p>在本文中，我们将了解 Harness CI 中的 GitHub 动作支持，以及插件可扩展性如何帮助将动作模板化为插件步骤。</p><p>GitHub 动作允许您创建可以执行预定义任务的自定义动作。这些预定义的任务包括从克隆代码库到构建 Docker 映像和安全扫描映像。以前创建的动作出现在 GitHub marketplace 上，对超过 10k 个动作提供了丰富的支持。</p><p>Harness CI 增加了对运行 GitHub 动作的支持。这意味着 GitHub 动作可以通过 CI 管道中的插件步骤使用。</p><h2>使用</h2><p>GitHub Actions YAML 包含三个属性:</p><ol role="list"><li><strong> name </strong>:指的是动作的 GitHub 库以及分支或标签。</li><li><strong> with </strong>:一个键和值为字符串的 map。这些是行动输入。</li><li><strong> env </strong>:传递给动作的环境变量。</li></ol><p>您必须在插件步骤设置中复制 with、uses 和 env 属性，以将 GitHub 动作用作 Harness CI 中的插件。您还必须在特权模式下运行该步骤，因为 GitHub 操作插件使用 Docker 中的 Docker (dind)。</p><p>以下是 GitHub actions 中的 action YAML 与 Harness CI 的对比:</p><figure class="w-richtext-figure-type-image w-richtext-align-fullwidth"><figcaption>A comparison of action YAML in GitHub actions vs. Harness CI</figcaption></figure><p>以下是在线束配置项中使用操作的一些示例。</p><h3>繁琐的扫描动作</h3><p>Trivy 是一个开源的扫描器，用于检测容器图像、git 存储库等等中的漏洞。</p><p>以下示例使用 Harness CI 中的 trivy 扫描“drone/git”容器图像。</p><h6>-step:<br/>identifier:Trivy<br/>name:Run Trivy 漏洞扫描器<br/>type:Plugin<br/>spec:<br/>connector ref:docker hub<br/>image:plugins/github-actions<br/>privileged:true<br/>settings:<br/>uses:aquasecurity/Trivy-action @ master<br/>with:<br/>image-ref:drone/git<br/>format:table<br/>exit-code:" 1 "<br/>ignore-unfixed:" true "<br/></h6><p>‍</p><figure class="w-richtext-figure-type- "/><h3>GCS 上传活动</h3><p>GCS 上传操作可用于将文件上传到 Google 云存储。<br/></p><p class="w-embed">-步骤:<br/>标识符:GCS-上传者<br/>名称:上传文件到 GCS <br/>类型:插件<br/>规格:<br/>连接器 Ref: dockerhub <br/>图片:插件/github-动作<br/>特权:真<br/>设置:<br/>用途:Google-github-动作/上传-cloud-storage @ main<br/>with:<br/>路径:'/path/to/file' <br/>目的地:demo/gcs <br/>凭证:&lt; +stage</p><h6 class="code--embed">‍</h6><p>Git 签出操作</p><figure class="w-richtext-figure-type- "/><h3>Git checkout 操作用于克隆 GitHub 存储库代码库。该操作可用于在 Harness CI 的一个阶段中克隆一个或多个 git 存储库。</h3><p>以下示例克隆触发器有效负载中存在的主存储库。需要指定 GITHUB_TOKEN 作为克隆私有存储库步骤的环境变量。</p><p>-步骤:<br/>标识:checkout <br/>名称:checkout GitHub action <br/>类型:插件<br/>规格:<br/> connectorRef: dockerhub <br/>图片:插件/github-actions <br/>特权:真<br/>设置:<br/>用途:actions/check out @ v2<br/>with:<br/>ref:$ { { GitHub . event . pull _ request . head . sha } }<br/>event _ payload:&lt;+trigger . event payload【t5t 5】</p><h6>‍</h6><p>您必须在插件步骤设置中指定存储库名称，以克隆第二个存储库。</p><figure class="w-richtext-figure-type- "/><p>-步骤:<br/>标识符:checkout-repo-by-name <br/>名称:check out GitHub repository by name<br/>类型:Plugin <br/>规格:<br/> connectorRef: dockerhub <br/>图像:plugins/github-actions <br/>特权:true <br/>设置:<br/>用途:actions/check out @ v2<br/>with:<br/>repository:my-org/my-private-tools<br/>路径:my-tools <br/> ref: ${</p><h6>履行</h6><h2>GitHub Actions 的工作方式是克隆“<strong> uses </strong>”属性中指定的存储库，并从克隆的 action 代码中执行“<strong> action.yml </strong>”文件中的步骤。</h2><p>GitHub 动作的 CI 插件使用<a href="https://github.com/nektos/act" target="_blank"> nektos/act </a>，这是一个在本地执行 GitHub 动作的开源项目。Nektos/act 运行 Docker 容器，GitHub 动作工作流在该容器上执行。CI 插件为输入操作步骤创建一个工作流，然后通过 nektos/act 执行它。以下是插件源代码的链接:<a href="https://github.com/drone-plugins/github-actions" target="_blank">https://GitHub.com/drone-plugins/GitHub-actions</a></p><p>结论</p><h2>我们已经展示了 Harness CI 中插件的可扩展性和简单性，使得只需一个插件就可以添加许多动作。这展示了可插拔的线束配置项有多强。我希望你在 Harness CI 中尝试你最喜欢的动作，并可能为你定制的任务创建你自己的插件。</h2><p>要进一步阅读 Harness CI，为什么不看看我们的<a href="https://harness.io/blog/jenkins-to-cie-journey/" target="_blank">从 Jenkins 迁移到 Harness CIE </a>的文章呢？</p><p>要进一步阅读 Harness CI，为什么不看看我们的<a href="https://harness.io/blog/jenkins-to-cie-journey/" target="_blank">从 Jenkins 迁移到 Harness CIE </a>的文章呢？</p></div></div>    
</body>
</html>