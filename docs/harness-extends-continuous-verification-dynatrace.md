# 线束将连续验证扩展到 Dynatrace |线束

> 原文：<https://www.harness.io/blog/harness-extends-continuous-verification-dynatrace>

将 Harness 与 Dynatrace 集成，并跨部署管道自动验证应用程序性能。通过我们的教程了解如何操作！

如今，客户在其开发、QA 和生产环境中使用应用性能监控(APM)软件并不罕见。

几周前，一家大型 FS 企业客户评估了 Harness for Continuous Delivery(CD)并表示:“我们需要尽快获得 Dynatrace 的支持。”

所以，几个星期后，通过 API 的力量，我们在这里。

## 为什么用 Harness + Dynatrace？

Harness 帮助客户掌握 CD，以便他们能够快速自信地将新应用和服务部署到生产中。

Dynatrace 帮助客户管理这些新应用和服务的性能。

对于每个应用程序/服务，客户通常有一个或多个部署管道。典型的管道有几个反映环境的阶段(如开发、质量保证、试运行、生产)，用于在生产部署前测试/验证代码。

现在，将 Harness 与 Dynatrace 集成后，客户可以自动验证其部署管道中的应用程序性能。

## 简单的部署管道示例

假设我们有一个名为“我的微服务”的 Docker 微服务，我们的持续集成(CI)工具 Jenkins 创建了一个新版本(#101)，为我们带来了一个新的工件版本。

利用 Harness，我们可以获得新版本，并立即触发一个 4 阶段部署管道，如下所示:

每个管道阶段都将我们的新微服务部署到不同的环境中，运行一些测试，在进入下一阶段之前验证一切正常。

你可以从上面的截图中看到，第 1 到第 3 阶段(开发/质量保证)成功了，变成了绿色。这通常是好的，这意味着工件通过了所有的测试，并且已经为生产和客户做好了准备。

坏消息是，第四阶段:生产变红，我们的管道状态是“失败”。

## 利用线束自动执行部署运行状况检查

在 Harness，我们将 CD 向前推进了一步，称为持续验证。

我们的早期客户之一，Build.com，曾经用 5-6 个团队领导手动分析监控数据和日志文件来验证生产部署。这个过程需要每个团队领导 60 分钟，每周进行 3 次。这相当于团队在验证上花费了 1080 分钟或 18 个小时的时间。借助 Harness，Build.com 将验证时间缩短至仅 15 分钟，并且[使自动回滚能够在生产](https://harness.io/2018/01/how-build-com-automated-ci-cd-rollback/)中发生。

有了 Dynatrace，Harness 能够在每个环境中即时部署和验证工件的性能。一旦部署了新的工件，Harness 将自动连接到 Dynatrace，并开始分析应用程序/服务性能数据，以了解每个部署的实际业务影响。

Harness 应用无监督的机器学习(隐马尔可夫模型和符号聚合表示)来了解关键业务交易的绩效是否偏离，并相应地标记绩效回归。

让我们看看用 Dynatrace 进行验证是什么样的。

## 使用 Dynatrace 进行连续验证

以下部署工作流与上述失败的管道相关，特别是生产阶段 4。您可以看到 canary 部署的第一阶段成功了，但第二阶段失败了。升级集装箱的部署取得了成功，与 Jenkins 和 ELK 相关的验证和测试也取得了成功。但是，Dynatrace 验证失败了，这意味着发现了新的性能退化。在这种情况下，最终的动作是自动回滚(这是 Harness 提供的安全网)。

单击 Dynatrace 失败步骤(红色)向我们展示了验证失败的原因:

我们可以看到，在部署了新的微服务版本后，一个关键业务事务“requestLogin”出现了响应时间性能回归。将鼠标悬停在红点上，我们可以获得更多详细信息——部署后，响应时间实际上增加了 58%,从 840 毫秒增加到 1330 毫秒:

该验证的默认时间段为 15 分钟，但该数字可以自定义。一些部署管道和工作流可能需要几个小时才能完成，因为并非所有事情都是自动化的(手动检查/批准等。).

## 配置动态跟踪连续验证

使用标准的 Dynatrace API 构建我们的集成非常简单。

你需要做的第一件事是**设置>连接器>添加新的验证提供者**:

然后输入您的 Dynatrace URL 和 API 令牌详细信息:

您可以从 Dynatrace 设置菜单中获取生成您的 API 令牌:

## 将动态跟踪验证添加到部署工作流中

首先，在 Harness 中添加或编辑现有工作流。只需点击**添加验证**并从菜单中选择 Dynatrace。

接下来，选择您的 Dynatrace 连接器实例，并添加除了验证时间段(默认为 15 分钟)之外您想要验证的每个服务方法(关键业务事务)。

**注意:**我们正在与 Dynatrace 团队合作[更新他们的 API](https://www.dynatrace.com/support/help/dynatrace-api/) ，这样您只需选择一个应用程序或服务名称，它就会自动验证默认关联的所有关键业务交易。

单击提交，您的部署工作流现在将使用 Dynatrace 自动验证应用程序性能。

## 还会有更多

正如你可能想象的那样，我们可以用 Dynatrace 做更多的事情。以下是未来几件值得期待的事情:

*   Dynatrace 用户的线束展开标记(右移)
*   在 Dynatrace 业务事务的上下文中利用向下钻取(右移)
*   支持 Dynatrace 日志非结构化事件数据(类似于我们的 Splunk、ELK 和 Sumo 逻辑支持)

特别感谢我们的客户、工程团队和来自 Dynatrace 的 [Andreas Grabner](https://twitter.com/grabnerandi) 为我们提供支持。

干杯！
史蒂夫。