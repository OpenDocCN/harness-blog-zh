# CLR vs JVM:C #和 Java 之间的战争如何延伸到 VM 级|利用

> 原文：<https://www.harness.io/blog/clr-vs-jvm>

Java 和 C#之间的战争永远不会结束。了解虚拟机级别的差异如何影响这场辩论。

我们已经写了很多关于 C#和 Java 之间的区别，涵盖了我们最喜欢的特性，这些特性在另一个中没有对等的。随着关于哪种语言比另一种语言更好的激烈争论的进行，我们将深入战场，看看它们各自的虚拟机(VM)之间的差异和相似之处。 *‍*

## TL；DR:CLR 和 JVM 之间的五大相同点和不同点

CLR 和 JVM 之间的主要相似之处包括:

*   两台虚拟机(VM)
*   两者都包括垃圾收集
*   两者都采用基于堆栈的操作
*   两者都包括运行时级别的安全性
*   两者都有异常处理的方法

CLR 和 JVM 之间的主要区别包括:

*   CLR 被设计成语言中立的，JVM 被设计成特定于 Java 的
*   CLR 最初只与 Windows 兼容，JVM 可以与所有主流操作系统兼容
*   CLR 使用 JIT 编译器，JVM 使用专门的 JIT 编译器，称为 Java HotSpot
*   CLR 包括闭包、协程和指针声明/操作的指令，而 JVM 没有
*   JVM 与更健壮的错误解决和生产监控工具兼容

既然我们已经确定了 5 个最大的相似性和差异，让我们来看看所有这些都意味着什么。从基础开始，然后深入了解所有这些意味着什么。

## 什么是虚拟机？

不难猜测，虚拟机(VM)是计算机操作系统的虚拟仿真。除此之外，这种系统抽象还有两种不同的实现。
***系统虚拟机*** 作为全功能操作系统存在，通常被创建为使用物理机器的替代品。这样，多个环境可以同时在同一台机器上运行。但是，这听起来不像我们钟爱的 CLR 和 JVM。
公共语言运行时(CLR)和 Java 虚拟机(JVM)都是 ***进程虚拟机*** 。这意味着它们不是执行整个操作系统，而是专门设计来运行一个进程或程序，而不依赖于平台环境。

## 仔细看看 CLR 和 JVM 之间的相似之处

CLR 和 JVM 都是虚拟机，它们都执行独立于平台的操作，即执行编译后的源代码。本质上，这些虚拟机都充当程序员源代码和系统机器代码之间的中间步骤，允许各种类型的处理器具有更高的可用性。在下图中，您可以看到两者的高级功能实际上是相同的。

除了它们的基本功能，它们还包括垃圾收集、运行时安全和异常处理的方法。最后一个相似之处是，两者都采用基于堆栈的操作，这是存储和检索操作数及其结果的最常见方法。
‍

但是，当然，对于这些虚拟机共享的每一个相似之处，都可以发现实施上的差异。然而，就像编程语言一样，这些虚拟机的开发以一种类似蛙跳的方式前进。其中一个实现了类似“标记-清除-压缩”的垃圾收集方法，另一个很快也会实现。

## 现在一些主要的区别

### 语言和平台兼容性

CLR 和 JVM 之间一个潜在的表面差异(尽管这可能影响了它们的开发方式)是，JVM 是专门为与 Java 一起工作而创建的，而 CLR 是被设计成语言中立的。相反，CLR 最初被设计成只能在 Windows 操作系统上运行，而 JVM 总是与操作系统无关的。众所周知，时代已经变了，现在有了运行在 Linux 和 Mac 上的 CoreCLR，并且开发了更多的语言来支持 JVM。这导致了一个事实，在很大程度上，CLR 和 JVM 之间的差异也是使用它们的语言之间差异的标志。或者，你可以说语言之间的一些最重要的差异(为了便于讨论，让我们说 [C#和 Java](http://blog.overops.com/c-vs-java-5-irreplaceable-c-features-wed-kill-to-have-in-java/) )实际上是在 VM 级别实现的。

### JIT 编译

我们在 VM 级别看到的一个很大的区别是，尽管两者都使用 JIT(实时)编译，但编译器并不是同时运行的。当 CLR 在运行时被调用时，它将所有 MSIL 代码编译成机器码。JVM 使用名为 HotSpot 的专用性能引擎将 Java 字节码 JIT 编译成机器可读的代码。它的不同之处在于它编译和优化了代码中最常用的“热点”。这些编译策略在性能方面都有自己的权衡。因为 CLR 在运行时调用时编译所有的机器码一次，所以在某些情况下执行时间可以缩短。但另一方面，如果在高频率下需要一小部分代码，Java 的 HotSpot 编译器可以通过额外的优化来提高效率。

### 语言功能的实现

另一个较小的区别是，CLR 是用处理泛型类型和在运行时对这些类型应用参数化专门化的指令构建的。基本上，这意味着 CLR 能够识别 List <int>和 List <string>之间的区别，而 JVM 不能(Java 将泛型实现为编译器的一部分)。CLR 还允许用户以结构的形式定义新的值类型，而基于 JVM 的语言中的值类型是固定的(byte、short、int、long、float、double、char、boolean)，尽管 T2 正在计划改变这一点。</string></int>

### 生产监控和异常处理

尽管两者都包括异常处理方法，但两者之间的总体差异会影响与不同异常和错误监控工具的兼容性。这进而会影响故障排除策略和工作流程。

## 性能和采用

剑桥大学的 Jeremy Singer 在 2003 年进行了一项研究，研究了 CLR 和 JVM 之间的性能差异，发现至少在当时，它们的性能实际上是相同的。

研究发现，Java 编译器生成的字节码更小，这可能会对 VM 性能产生影响。然而，当运行代码时，执行时间几乎是一半一半，CLR 和 JVM 各有一半的时间执行得更快。基于这个研究，当谈到 Java 和。NET 用户，看起来虚拟机本身在区分功能方面发挥的作用比它们直接影响应用程序效率的作用更大。

在考虑收养时，这也是有意义。在企业公司中，开发人员同时使用基于 CLR 和基于 JVM 的语言并不少见。这尤其可能发生在有许多不同部门从事不同项目和应用程序的大公司中。例如，埃森哲同时使用 C#和 Java，Intuit 也是如此。

## 社区

说到竞争，我们知道。NET 和 Java 都有强大的社区支持它们。在这些社区中，开发人员在 StackOverflow 这样的网站上提出问题并进行深入的讨论。快速搜索每个虚拟机的名称会发现，CLR 被标记了 3250 次，而 JVM 被标记了 8628 次。

在 StackOverflow 之外，还有由微软和 T2 甲骨文自己开发的广泛的社区。在那里，用户可以找到除了 CLR 和 JVM 之外的其他信息和资源。其中的主题包括云中的实现、故障排除问题等等。
然而，除此之外，这些社区肯定更多地围绕着个人语言和平台，比如[。NET](https://twitter.com/dotnet) 、 [Java](https://twitter.com/java) 、C/C++、Scala 等。

## 最后的想法

从最高层次来看这些虚拟机，CLR 和 JVM 之间的差异几乎可以忽略不计。然而，在许多(如果不是大多数)情况下，VM 级别的差异反映了使用它们的语言之间的关键差异。由于这些虚拟机及其相应语言的构建方式，每个虚拟机的功能都略有不同，以便提供其创建者想要提供的功能。