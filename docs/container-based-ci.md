# 基于容器的配置工具的威力

> 原文：<https://www.harness.io/blog/container-based-ci>

像 Jenkins 这样的传统工具导致基础设施难以维护。幸运的是，Harness CI 的设计与众不同:使用容器！了解基于容器的 CI 如何提供帮助。

本文由尤里·席耐尔和迪内什·加格合作撰写。

传统的 CI 工具(例如 Jenkins)的设计方式迫使用户确保客户端(执行步骤的客户端)包含运行步骤所需的所有库。例如:如果该步骤正在执行一个 HTTP 请求，则必须安装一个 HTTP 客户端。如果 step 部署到 K8s 集群，那么就需要一个 kubectl，等等。

这种架构很难维护。CI 的大型实施很容易失控，原因有几个:

1.  用户必须确保所有客户端(或“从属端”)都是最新的。如果您想使用新版本的 CLI，您就必须将新版本推广到所有客户端。
2.  您可能对在不同的机器上使用不同版本的 CLIs 感兴趣(例如，不同版本的 [Terraform](https://harness.io/blog/terraform-201-tutorial/) )。但是因为你不能在同一台机器上安装同一个 CLI 的不同版本，你需要有不同的机器，不同的版本，你必须确保每次执行都选择正确的版本，否则，构建将会失败...

这是每个 CI 团队的噩梦，导致大量时间浪费，失败，主要是挫败感。

幸运的是，Harness CI 的设计与众不同。Harness CI 是基于容器的，它真正消除了在 slaves 中管理库的所有负担，并让您可以完全控制和查看每个执行中需要哪些库和 CLI。

## 它是如何工作的？

让我们看看当您在 Harness 中创建 CI 管道时会发生什么。

在将构建阶段添加到管道之后，您可以开始添加将在构建被触发时执行的步骤。

对于每一步，您只需要定义几件事情:

1.  步骤名称(将显示在管道中)。
2.  启动容器时使用的图像(您应该已经烘焙了所有库)。
3.  容器启动后要运行的命令。

你已经准备好了！

当执行管道时，Harness 管理每个步骤的完整生命周期:

*   在您选择的基础设施上开发容器。
*   运行所有的命令。
*   存储日志并将结果填充到 UI 或 HTTP 响应中。
*   在执行结束时拆除容器。

因为容器是短暂的和不可变的，所以您不必担心更新库。如果您想使用新版本的 CLI，只需将步骤设置为使用不同的映像。对使用同一个库的不同版本感兴趣？只需指定要在运行时提取的图像的标签。

为了节省资源消耗，Harness 根据您的管道配置无缝地确定最佳 pod 规格。例如，在下面的屏幕截图中，内存和 CPU 的分配如下:

马克斯(S1，S2，{S3+S4+S5})

最大值(2GB & 1CPU、3GB & 1CPU、{(4GB & 1 CPU)+(2GB & 1 CPU)+(2GB & 1 CPU)})

最大值(2GB & 1CPU、3GB & 1CPU、8GB & 3 CPU) -> **8GB & 3CPU**

## 使用基于容器的 CI 产品有什么好处？

在以下情况下，您应该使用基于容器的 CI 解决方案:

1.  容器在您的组织中得到批准。
2.  您熟悉 docker 映像，知道如何创建包含所需库的映像，或者可以访问它们。
3.  你想使用一个超级容易使用和扩展的产品，使用[插件](https://harness.io/blog/write-first-plugin-for-cie/)。

## 结论

在本文中，我们了解了基于容器的 CI 工具，以及它们与 Jenkins 等传统工具的不同之处。世界确实正朝着基于容器的架构发展——看看现在市场上的大量 CI/CD 工具就知道了。大多数都是云原生的，像 Jenkins 这样的旧工具(已经有十多年的历史)已经不再适用了。我们强烈建议您尝试利用自己的优势，[看看 CI 有多简单](https://harness.io/products/continuous-integration/)。

如果你想在 CI 上做进一步的阅读，为什么不读一下关于[测试智能](https://harness.io/blog/test-intelligence/)？这一新功能旨在为您节省大量时间-快速移动，而不损坏东西。