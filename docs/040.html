<html>
<head>
<title>Introducing Harness Custom Deployments - Part One | Harness</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>线束自定义部署简介-第一部分|线束</h1>
<blockquote>原文：<a href="https://www.harness.io/blog/introducing-harness-custom-deployments#0001-01-01">https://www.harness.io/blog/introducing-harness-custom-deployments#0001-01-01</a></blockquote><div><p>Harness最近推出了一项名为定制部署的全新功能。顾名思义，定制部署是用户执行任何类型的部署的一种方式，这种部署可能不是本机支持的，也不是现成的Harness提供的。</p><div fs-richtext-element="rich-text" class="blog-rtf w-richtext"><p>Harness最近推出了一项名为<a href="https://developer.harness.io/docs/first-gen/continuous-delivery/custom-deployments/create-a-custom-deployment/">定制部署</a>的全新功能。顾名思义，定制部署是用户执行任何类型的部署的一种方式，这种部署可能不是本机支持的，也不是现成的Harness提供的。这些技术包括传统技术，如Weblogic、WebSphere、Google Cloud Functions等。与Harness中其他本机支持的部署类型一样，定制部署允许在服务仪表板上跟踪实例(或工作负载),并随着实际底层基础架构的变化而保持更新。这些部署的实例也是受益于我们的<a href="https://developer.harness.io/docs/first-gen/continuous-delivery/continuous-verification/continuous-verification-overview/concepts-cv/what-is-cv/">持续验证</a>集成的候选者。此外，用户可以捕获部署的实例，并在他们选择的CV工具中利用它。</p><h2><strong>让我们看看这是如何实现的</strong></h2><h3><strong>定义定制部署类型</strong></h3><p>部署类型应该像一个可以在一个帐户中使用的模板。因此，我们决定利用帐户级模板库来定义这些部署类型。与模板库中的其他模板类型一样，这些模板也是有版本的。如果以下任何内容发生更改，将生成新版本:</p><ul role="list"><li>基础设施变量</li><li>获取实例命令脚本</li><li>主机对象数组路径</li><li>主机属性</li></ul><p><em>在线束UI中创建自定义部署模板</em>:</p><figure class="w-richtext-figure-type- "/><h2>字段说明</h2><p><strong>显示自定义部署类型的名称</strong>基础设施变量帮助识别基础设施的变量。示例:。项目、集群名称、名称空间、秘密令牌、密码等。这些就像一个模板，值可以在以后提供。可以在此指定默认值。Fetch Instances命令脚本脚本需要查询基础结构以获取实时实例。CV可以使用这些实例进行验证，服务仪表板也可以使用这些实例。主机对象数组路径包含实例信息的JSON数组的完整路径。在下面的例子中，他的值应该是“items”。如果这是一个嵌套字段，我们可以使用“.”作为分隔符来指定完整路径。示例:" foo.bar.items . "每个JSON对象中的Host AttributesKey可用于存储实例属性。主机名是一个强制属性，因为它是跨平台标识实例的基础。示例:主机名应设置为<em>列表地址</em>，我们可以设置另一个属性，如分段模式。字段名可以设置为更容易阅读的字符串，比如staging_mode，JSON路径应该设置为<em> Mode.staging. </em></p><p><em>主机对象数组路径配置示例:</em></p><p>{ <br/>"项目":[ <br/> { <br/>"模式":{ <br/>"分期":" nostage" <br/> }，<br/>" listen address ":"<br/>}，<br/> { <br/>"模式":{ <br/>"分期":" external_stage" <br/> }，<br/>" listen address ":" 172 . 17 . 0 . 3 "<br/>}，<br/> {。</p><p>现在，我们已经创建了部署类型，可以跨应用程序使用它进行部署了。</p><h3><strong>定义服务</strong></h3><p>在线束中，我们考虑“您正在部署什么？”被称为服务。类似于在Harness中配置任何其他服务的方式，他们可以为自己的定制部署创建服务。只需从<em>部署类型</em>下拉列表中选择新部署类型的名称，就可以开始了。您可以添加任何种类的工件并配置服务配置变量。</p><h3><strong>定义基础设施</strong></h3><p><em>使用自定义部署类型在线束中创建基础架构定义</em>:</p><figure class="w-richtext-figure-type- "/><h2>字段说明</h2><p><strong>自定义部署类型的显示名称名称</strong>云提供商将此设置为自定义，因为在这种情况下没有专用的云提供商。部署类型选择帐户中存在的自定义部署类型之一。VersionDeployment类型是模板库中的模板。它是有版本的。基础结构定义可以引用静态版本或最新版本来获取最新的更改。该版本的变量将显示在这里。变量为基础设施变量设置值，以定义具体的基础设施。值可以使用任何内置的线束表达式。示例:服务变量、机密、配置文件等。</p><h3><strong>设置工作流程</strong></h3><p>可以创建多阶段(Canary)和单阶段(Basic)工作流。在<strong> <em>部署</em> </strong>环节步骤中，有一个名为<strong> <em>获取实例</em> </strong>的步骤被默认添加到工作流中。让我们详细讨论一下这一步，因为这是整个定制部署流程中最关键的部分。</p><p><em>带有基本步骤设置的示例自定义部署工作流</em>:</p><figure class="w-richtext-figure-type- "/><p>该步骤将运行与基础设施定义中配置的版本相对应的<strong> <em>获取实例命令脚本</em> </strong>，并替换定义的值。这将在代理上运行，响应将被发送到线束管理器，在那里响应将使用自定义部署模板中定义的<strong> <em>主机对象数组路径</em> </strong>和<strong> <em>主机属性</em> </strong>进行解析。实例对象将被创建，并通过表达式<strong><em>$ { instance . hostname }</em></strong>供后续步骤使用。在随后的部分中，步骤如下:</p><ul role="list"><li>命令过程</li><li>服务命令</li><li>日志分析(ELK，Google Operations等。)</li><li>度量分析(AppDynamics，Datadog，NewRelic等。)</li></ul><p>可以添加以在已部署的实例上执行所需的操作。通常，用户希望验证他们部署的实例是否成功接收流量，或者运行负载测试以确保应用程序能够处理大量流量。</p><p><em>注意:这些工作流程是可定制的。阶段步骤，如部署、验证等。，可以根据需要添加、删除和重新排序。</em></p><h3><strong>维修仪表板</strong></h3><p>服务控制面板允许我们的用户查看他们部署的实例，并跟踪已经部署的实例、部署时间以及部署位置。Harness存储了<strong> <em>获取实例命令脚本</em> </strong>，以便能够在后台运行它，从而更新服务仪表板。例如，如果脚本调用API获取基础设施的当前状态，并以所需的JSON格式将其转储，则服务仪表板将反映对已部署实例/工作负载的任何更新。</p><p>如果需要更新脚本，可以重新运行工作流来更新后台脚本。</p><h3><strong>该收尾了</strong></h3><p>我们的Harness团队已经开始创造性地使用我们的定制部署特性，并提出了一些非常简洁的部署用例。我们的一些用户已经在他们的遗留工作负载中使用这个特性，比如Websphere和Weblogic。查看Harness社区，我们的团队在那里与我们的用户分享这些实现。以下是最近的一些例子:</p><p><strong>谷歌功能</strong><br/><a href="https://community.harness.io/t/google-cloud-functions-with-harness-custom-deployment/598">https://community . harness . io/t/Google-cloud-Functions-with-harness-custom-deployment/598</a></p><p><strong>谷歌云运行</strong> <br/> <a href="https://community.harness.io/t/google-cloud-run-workloads-with-custom-deployments-in-harness/597"> https://community。挽具。io/t/Google-Cloud-Run-workloads-with-custom-deployment-in-harness/597</a></p><p><strong> AWS弹性豆茎</strong><br/><a href="https://community.harness.io/t/aws-elastic-beanstalk-with-harness-custom-deployment/619">https://community . harness . io/t/AWS-Elastic-Beanstalk-with-harness-custom-deployment/619</a></p><p>我们迫不及待地想看看你们在使用定制部署时都有什么想法。请随时与社区分享反馈。看到我们的用户提出的很酷的想法是令人兴奋的！</p></div></div>    
</body>
</html>