<html>
<head>
<title>Drone and AWS App Runner - Better Together | Harness</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>无人机和AWS应用程序Runner -一起更好| Harness</h1>
<blockquote>原文：<a href="https://www.harness.io/blog/drone-aws-app-runner#0001-01-01">https://www.harness.io/blog/drone-aws-app-runner#0001-01-01</a></blockquote><div><p>开始使用Drone来处理构建和发布部分是轻而易举的事情，然后允许AWS App Runner部署到AWS基础架构中。</p><div fs-richtext-element="rich-text" class="blog-rtf w-richtext"><p>随着越来越多的开发者资源转向公共云，亚马逊网络服务最近发布了<a href="https://aws.amazon.com/apprunner/" target="_blank"> AWS App Runner </a>。AWS App Runner的前提是工程师可以只关注源代码，不需要具备底层基础设施的知识。AWS App Runner似乎是AWS首次尝试提供针对AWS平台的<a href="https://harness.io/blog/continuous-delivery/what-is-paas/" target="_blank">平台即服务</a> (PaaS)。</p><p>AWS App Runner酷似<a href="https://harness.io/blog/continuous-delivery/rancher-rio-vs-harness/" target="_blank">牧场主里约</a>；通过为部署创建可公开访问的路由，消除服务的网络/路由复杂性。开始使用Drone来处理构建和发布部分是轻而易举的事情，然后允许AWS App Runner部署到AWS基础架构中。</p><figure class="w-richtext-align-center w-richtext-figure-type-image"/><h3>入门指南</h3><p>有几个活动部件可以开始使用。第一个将是<a href="https://www.youtube.com/watch?v=kZmOCLCpvmk" target="_blank">需要安装一个无人机</a>如果你没有进入<a href="https://cd.foundation/blog/2020/08/20/your-first-drone-installation-and-build/" target="_blank">无人机安装</a>。在这个例子中，我们将使用<a href="https://docs.drone.io/server/provider/github/" target="_blank"> GitHub </a>作为源代码管理平台。接下来，将创建一个<a href="https://aws.amazon.com/ecr/" target="_blank"> Amazon ECR </a>注册表/存储库，用于存储最终将由App Runner部署的Docker映像。</p><h3>亚马逊ECR配置</h3><p>无人机有一个<a href="http://plugins.drone.io/drone-plugins/drone-ecr/" target="_blank">插件，方便亚马逊ECR发布</a>。如果您以前没有创建过Amazon ECR注册中心，那么配置很简单。您可以登录您的AWS帐户，前往ECR - &gt;创建存储库。</p><figure class="w-richtext-align-center w-richtext-figure-type-image"/><p>在这个例子中，我们将给出私有的ECR注册中心，然后是库名“sample-apprunner-ecr”</p><p>当您点击提交时，私有ECR存储库就准备好了。</p><figure class="w-richtext-align-center w-richtext-figure-type-image"/><p>有几种方法可以让<a href="https://docs.aws.amazon.com/AmazonECR/latest/userguide/registry_auth.html" target="_blank">以编程方式访问</a>您的私有ECR存储库，比如向注册中心认证。现成的无人机插件使用访问键。您可以使用创建ECR存储库的帐户的访问密钥，也可以创建一个专门的IAM帐户。对于这个例子，我创建了一个Drone-ECR帐户，并附加了一个ECR策略[也称为Drone-ECR]。</p><p>AWS IAM -&gt;创建策略，然后选择适当的权限。对于这个例子，我向新策略授予了所有权限。在你自己的环境中，你可以更恰当地锁定。</p><figure class="w-richtext-align-center w-richtext-figure-type-image"/><p>创建后，您可以通过IAM组将IAM策略附加到IAM用户。<br/></p><figure class="w-richtext-align-center w-richtext-figure-type-image"/><p>如果这是一个新用户，请确保记下该用户的访问和密钥。随着ECR权限的取消，是时候去GitHub了。</p><h3>GitHub项目</h3><p>您可以<a href="https://github.com/ravilach/drone-ecr" target="_blank">派生这个示例项目</a>，它将有一个无人机的示例配方发布到ECR。Drone确实需要实例化项目(例如，代表您创建一个webhook来监视更改)。</p><p>在Drone中导航到您想要构建的GitHub项目。点击激活存储库。</p><figure class="w-richtext-align-center w-richtext-figure-type-image"/><p>如果您正在利用示例项目，无人机配置称为“drone.yaml ”,您可以在设置的底部进行配置。</p><figure class="w-richtext-align-center w-richtext-figure-type-image"/><p>一旦你点击了Save，你的GitHub项目应该有一个webhook安装到你的安装URL:</p><figure class="w-richtext-align-center w-richtext-figure-type-image"/><p>现在，您可以更深入地了解无人机设置了。</p><h3>无人机设置</h3><p>如果利用<a href="https://github.com/ravilach/drone-ecr" target="_blank">的例子</a>，有5个项目是敏感的，可以作为无人机秘密共享:AWS IAM用户的秘密和密钥、ECR存储库名称、ECR注册地址和ECR区域。</p><p>Drone.yaml:</p><figure class="w-richtext-align-center w-richtext-figure-type-image"/><p>进入<em>库</em> - &gt;设置- &gt;秘笈，即可连线秘笈，创建五大秘笈。</p><figure class="w-richtext-figure-type- "/><p>需要创造的秘密及其价值:</p><ul role="list"><li>aws_access_key:用户帐户的IAM访问密钥</li><li>aws_secret_key:用户帐户的IAM密钥</li><li>aws_ecr_repo : AWS ECR Repo名称，例如“sample-apprunner-ecr”</li><li>aws_ecr_registry : AWS ECR注册表地址例如"<em> your_unique_id。</em>dkr . ECR . us-east-2 . Amazon AWS . com "</li><li>aws_region : AWS区域ECR位于例如“美国东部-2”中</li></ul><p>每个都连接到:</p><figure class="w-richtext-figure-type- "/><p>为了模拟变化，您可以修改drone.yaml文件，例如更改标签并在GitHub中提交。这将启动一个构建。</p><figure class="w-richtext-figure-type- "/><p>构建应该是成功的。</p><p>成功:</p><figure class="w-richtext-figure-type- "/><p>您可以通过在ECR中查找新图像来验证发布步骤。</p><figure class="w-richtext-figure-type- "/><p>既然您已经能够轻松地构建和发布映像，下一步就是配置AWS App Runner。</p><h3>你的第一个AWS应用跑步者</h3><p>配置AWS App Runner很简单，尤其是在遵循他们第一个发布的例子时。</p><p>第一步是在您的AWS帐户中导航到AWS App Runner。</p><figure class="w-richtext-figure-type- "/><p>点击创建一个应用程序运行服务。然后，选择Container Registry和Amazon ECR作为提供商。</p><figure class="w-richtext-figure-type- "/><p>你可以点击浏览，选择无人机上传的图片。</p><figure class="w-richtext-figure-type- "/><p>单击Continue，对于这个例子，只需利用一个手动触发器。</p><p>如果您没有合适的服务角色，向导可以为您创建一个通用角色。</p><figure class="w-richtext-figure-type- "/><p>单击“下一步”配置服务。GitHub repo中的示例应用程序通过端口3000发送流量，您可以将该端口配置为App Runner中的端口。</p><p><em> main.go </em></p><figure class="w-richtext-align-center w-richtext-figure-type-image"/><figure class="w-richtext-figure-type- "/><p>您可以利用所有默认设置来部署这个“AwesomeApp”</p><figure class="w-richtext-figure-type- "/><p>单击创建和部署。该服务需要一些时间来创建和部署适当的基础设施。</p><figure class="w-richtext-figure-type- "/><p>通过点击默认域，您现在可以访问您的第一个AWS App Runner服务。</p><figure class="w-richtext-figure-type- "/><p>导航到URL:</p><figure class="w-richtext-figure-type- "/><p>就这样，您拥有了一个已部署的容器，该容器带有一个可通过AWS App Runner公开访问的路径！</p><h3>Harness和AWS App Runner更好地结合在一起</h3><p>如果您需要对规定的AWS应用程序运行者意见进行更多的控制，将Harness添加到组合中是一个很好的选择，可以利用两者的功能。AWS App Runner是AWS最新的类似PaaS的服务，旨在简化来自<a href="https://aws.amazon.com/elasticbeanstalk/" target="_blank">弹性豆茎</a>的用户体验。并非所有工作负载都适合在AWS App Runner上运行。有了<a href="https://harness.io/platform/">驾驭平台</a>，你可以自由构建和部署非常异构的技术。某些工作负载可以在其他AWS服务中表现得更好，例如<a href="https://aws.amazon.com/fargate/" target="_blank"> Fargate </a>或者只是一个普通的<a href="https://docs.harness.io/article/wfk9o0tsjb-aws-ami-deployments" target="_blank"> AMI </a> /EC2实例。无论你部署在哪里，安全带都会保护你。</p><p>干杯，</p><p>拉维</p></div></div>    
</body>
</html>