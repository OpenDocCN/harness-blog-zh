# 线束连续验证解密|线束

> 原文：<https://www.harness.io/blog/continuous-verification-demystified>

让我们深入挖掘持续验证，了解更多关于技术方面的知识——希望能稍微揭开这个过程的神秘面纱！

利用连续验证(CV)允许您在机器学习(ML)的帮助下验证新部署。它可以快速检测退化或异常，并帮助快速回滚失败的部署。CV 提供了许多好处，但是在本文中，我们将把重点放在技术方面。

## 简历的流向

一旦在工作流中设置了验证步骤，Harness 就会对验证提供程序进行 API 调用，并依赖验证提供程序返回数据。然后，Harness 在配置的分析持续时间内收集数据。ML 算法开始将收到的数据与选定的验证类型(以前的/金丝雀)进行比较，并相应地将交易标记为有风险/无风险。这有助于在最终部署之前隔离问题，并允许您在出现异常时回滚。

您可以在执行过程中的 API call 选项卡下看到对提供者进行的所有 API 调用，其中对其他提供者进行了类似的调用。在定制 APM 的情况下，它将根据您配置的查询。以下是 appdynamics 的请求/响应示例。

在这里，您可以看到为 node1234 返回的数据，其指标为每分钟调用次数 BT - > _APPDYNAMICS_DEFAULT_TX。因此，在分析期间会进行多次这样的调用，以获得不同指标的响应。

Harness 还提供了配置定制查询的灵活性，因此您可以完全控制定制指标和日志验证。

### 样品申请

https://<verification-provider>/控制器/rest/应用程序/11/metric-data？output = JSON&time-range-type = BETWEEN _ TIMES&metric-path = Business % 20 transaction % 20 performance | Business % 20 transactions | app | _ app dynamics _ DEFAULT _ TX _ | Individual % 20 nodes | node 1234 | *&start-time = 1636710979679&end-time = 1636711279679&roll up = false</verification-provider>

### 样本响应

[{ " metric name ":" BTM | BTs | BT:8571397 | Component:128319 |每分钟调用数"，" metricId":13，" metricPath ":"业务事务性能|业务事务|动态| _ APPDYNAMICS _ DEFAULT _ TX _ |单个节点| node1234 |每分钟调用数"，"频率":" ONE_MIN "，
" metric values ":[{ " startTimeInMillis ":163671096000，"值":6

## 了解节点

节点是在服务实例下标识的。“New”指的是新部署的实例，“Previous”指的是 canary 的旧节点(如下图所示)。这是在先前执行的情况下从旧的执行中提取的，显示为基线。您可以选择这三个点来查看所有已识别的节点。

一旦分析开始，请确保在分析运行时，正确的节点被识别，并且数据以正确的值返回。

## 了解数据点和比较

在接收到所收集数据的平均后，在图上标记数据点((x-1)+x+(x+1))/3)。这意味着没有必要按照数据收集周期查看数据点的确切数量，或者在 API 调用中收到的响应数量。例如，在下面的执行中，收集了五分钟的数据，但是只标记了两个数据点。

一旦数据点被标记，它将与控制主机数据进行比较，并被标记为风险/无风险。如果您想查看单个节点的比较，那么您可以选择度量名称后面的信息图标，这样您就可以通过节点比较查看所有节点。

## 解决纷争

如果验证步骤没有按预期运行，则可以检查和验证以下内容:

1.首先，从工作流阶段测试和验证它是否看起来不错，并确保它可以对提供者进行 API 调用并获得正确的响应。

2.接下来，一旦开始执行，检查第三方 API 调用选项卡，并验证 API 请求和响应。在定制 APM 的情况下，您必须确保您的查询是正确的，并且在分析运行时返回相应节点的有效数据。

3.确保在分析期间，按照与相应的新/先前节点匹配的配置，返回正确的 BT/查询/度量数据。

4.执行日志选项卡将提供更多信息(数据收集、分析完成等的时间戳。).它还可以标记问题，例如没有找到以前的节点数据或没有找到基线。

5.您可以利用自定义阈值来避免任何故障或异常。

## 结论

在本文中，我们探索了线束连续验证的基础。Harness 支持主要的 APM 和日志供应商，还提供了添加定制 APM 的选项，您可以在这里查询定制指标。

如需进一步阅读，请阅读[持续验证的重要性](https://harness.io/blog/importance-of-continuous-verification/)以及[应用 ML 和线束](https://harness.io/blog/applying-ml-ci-cd-pipelines/)。