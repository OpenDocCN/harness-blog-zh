# 带特征标志的代码切断开关|线束

> 原文：<https://www.harness.io/blog/kill-switch-code>

kill switch 既可以控制应用程序中的精细功能或特性，也可以作为影响整个应用程序的长期操作开关。让我们来探索如何利用断路开关。

如果你最近才接触到[功能标志](https://harness.io/products/feature-flags/)，你可能不知道功能标志作为一个概念已经存在了相当长的时间，并且可以很容易地被看作是应用配置系统的一种演变。但是首先，如果你需要复习特性标志，请到我们的“[什么是特性标志？](https://harness.io/blog/feature-flags/what-are-feature-flags/)“文章现。

使用功能标志的 kill switches 最少使用但最强大的用例之一[可以用于 Ops 和 SRE 团队。许多人从来没有想过这种潜力，但是它可以是特性标志最能改变你的工程组织的一种方式。它们是在](https://harness.io/blog/feature-flag-use-cases/)[软件开发中提高速度和降低风险的好方法。](https://harness.io/blog/devops/software-development-life-cycle/)

Kill switches 在控制应用程序中的粒度功能或特性以及作为影响整个应用程序的长寿命操作开关方面具有巨大的潜力。虽然功能标志被直观地认为会影响前端或面向客户端的应用程序，但它们也可以用在后端。让我们来探索如何利用 kill switches 来改变团队交付软件的方式。

## **用例 1:生产中的控制功能切换**

考虑这是使用特征标志实现删除开关的基本情况。这个概念很简单:你可以用一个开关，或者一个终止开关，来操纵任何和所有被推送到产品(或者任何环境)的特性和变化。特性标志本质上允许团队将特性隔离在他们的应用程序中，这样它们就可以被单独处理，而不是作为一个部署包。Kill switches 本身就是团队可以创建一个控件来随时禁用生产中的代码的方法。

*Use toggles to ensure users don’t have bad experiences.*

这个基本的 kill switch 功能使团队能够在功能未就绪时将其关闭。“未准备好”可能意味着两种情况:

1.  这是一个未完成的功能。
2.  这是一个破碎的特征。

### 未完成的功能

没有准备好的第一个条件是在部署过程中减慢许多团队的速度。特别是，由于许多团队在不同的应用程序上开发不同的特性，集成和部署需要很长时间。没有所有的东西，发布团队和构建它们的软件开发团队都会发现他们自己变慢了。

在这种情况下，使用特性标志作为终止开关允许团队将新特性作为不完整的特性推向生产，这可以导致更快的开发周期。它只需要被实时推送，但要激活终止开关(关闭该功能)，这样它实际上不会影响任何东西。

### 破碎的特征

这是一个开发人员最喜欢的:它在所有预生产环境中都能工作，然后发现了一个影响生产的 bug。如果不使用功能标志，影响生产的坏功能现在将需要完全回滚部署——没错，所有好功能也必须下架，生产切换回上一个工作版本。

另一方面，给每一个新的特性或者变化加上一个特性标志，可以让团队在发现问题的时候立即停止工作。现在，所有有效的特性都保留在 prod 中，而坏的特性被隔离出来，并根据需要进行处理。

## 用例 2:事件管理

当由于特性发布被破坏而导致生产中出现严重问题时，会发生什么？或者当一些基础设施故障波及所有生产时？事实证明，kill switches 可用于缓解这些事件，并提高负责团队的 MTTR(平均解决时间)。谈谈压力管理。

*Incident management doesn’t have to be a nightmare.* [*Source.*](https://constanttech.com/incident-management-centers/)

### 场景 1

在场景 1 中，一个损坏的新特性导致了生产中的一个事故。好消息是，如果新功能被绑定到一个功能标志上，则可以触发终止开关，该功能可以在生产中立即关闭，从而产生最小的影响。不仅该特性不再影响生产，而且突然之间不再需要组建大规模的响应团队来处理问题，这通常意味着整个部署不得不被取消。相反，该特性被关闭，负责该特性的团队负责修复它，并且当它准备好时，该特性修复可以向前滚动。

### 场景 2

在场景 2 中，基础设施故障是生产中可能发生的情况的一个例子。但是，生产中断可能会因各种问题而发生。通常，运营团队会有后备选项或“全部关闭”操作手册，这里也可以使用 kill switches。如果是全新的基础架构更改，则整个更改可以包含在功能标志中，并且可以触发一个终止开关，当出现问题时，该开关将故障转移到旧的设置。一些团队还创建了长期的操作标志，例如，可以将整个站点或应用程序置于“维护模式”，有效地触发整个应用程序的终止开关。这在 P0 场景中很有用，在 P0 场景中，事物完全被破坏，并且首选是不允许任何访问。

## 用例 3:应用负载管理

假设你的企业是一家电子商务公司。相对于一年中的其他时间，假期期间你会经历高负荷。现在，企业比以往任何时候都更不希望出现停机或客户体验问题！事实证明，特征标记是解决这个问题的一个非常低成本的方法。

解决这个问题的一个方法是简单地关闭一些可以减少负载的功能，这是使用 kill switch 的一个很好的地方，但它可能不是最有效的。另一个解决方案可能是取消某些在非高峰时间有用的负载平衡器或服务器，转而使用专为高负载设计的基础设施。

*Wire up a complex infrastructure cutover or failover behind a single switch.*

### 真实世界的例子

在以前的工作中，我们有需要从短期缓存进入存储的日志数据，所以我们有一个系统来收集和存储它们。在高峰负荷或其他不稳定时期(特别是上游有 AWS)，我们经常会看到这种存储变得非常昂贵或非常不可靠。因此，我们会在这些期间关闭该服务，但这是手动的，并且涉及一系列 AWS 命令和数据库更改，以便稍后禁用和重新启用。通过将它连接到一个特性标志，我们能够以一种更加轻量级、可见和易于管理的方式立即关闭和打开这个特性。

## 用例 4:生产中的测试

*Once a joke, now a common use case.* [*Source*](https://twitter.com/mipsytipsy/status/1034904230916763654?lang=da)*.* 

团队进行特性标记最常见的用例之一是在生产中进行测试。简而言之，这是一个特定特性(或一组特性)需要根据实际生产数据进行测试的地方。毕竟，生产前环境只能测试这么多东西！我们在这里看到了两种使用情形:

1.  使用实时数据测试功能或变更，以确保其行为符合预期
2.  将实现放在真实用户面前，看看他们实现目标的情况如何

这里使用特性标志作为终止开关非常简单:在测试运行之前让它保持活动状态，然后关闭它。也有可能某个功能在测试过程中会失败，需要将其关闭以最小化影响。在这篇专门的博客中，你可以更深入地了解生产中的测试[。](https://harness.io/blog/feature-flags/testing-in-production/)

## 用例 5:渐进式交付

这里，让我们假设一个关于[进行性分娩](https://harness.io/blog/feature-flags/progressive-delivery/)的基本知识。它正在成为一种越来越受欢迎的特性发布方法，非常类似于在连续交付中用于 [canary 发布](https://harness.io/blog/feature-flags/canaries-and-feature-flags/)的方法。

随着渐进传输，对断路开关的需求略有变化。是的，主要的用例仍然是在东西坏了或者不需要的时候把它们关掉，但是在这里，我们必须加入自动化。就其本质而言，渐进式交付是团队以自动化的方式运行的东西。要做到这一点，他们需要预先定义在哪些场景中打开标志，为谁打开，以及在什么条件下更多的用户可以访问。相反，他们必须定义失败标准，在这个标准中，终止开关被触发，新功能被关闭，或者用户基础被缩减。

在利用特性标志中，我们通过管道自动执行渐进交付。团队可以安排发布，强制批准，与插件集成，创建触发事件，以及模板化发布——然后自动化它。

## 用例 6:个性化

个性化是一个热门话题。使用特征标志的断路开关在大规模应用中具有巨大的价值。我们可以看三个不同的场景，在这些场景中，您可以使用 kill switches 来提高您为客户提供个性化体验的能力。

### 合规与监管

就监管而言，能够“个性化”某些东西(如移动应用程序版本)以遵守各个国家的法律，或满足特定垂直行业(如政府、金融)客户的需求是一个不容讨价还价的问题。其中最常见的是数据隐私——具体来说，遵守 GDPR。

考虑到这一点，在一个地方显示一个按钮，而在另一个地方不显示，这可能会很混乱。将关键功能作为永久功能标志连接起来，可以让您轻松地为所有北美用户打开某些功能，但不能为欧洲用户打开，因为欧洲用户必须遵守 GDPR 法规。它不仅仅是创建一个在给定环境下关闭欧洲数据收集的 kill switch，它还能够为任何决定退出的用户终止数据收集。这比拥有一个试图解决所有不同场景的配置文件要容易得多。

### 用户定义的个性化和管理设置

可以把这想象成让用户控制他们想要删除的特性。这与让他们访问应用程序上的管理设置没有什么不同，因此他们可以选择黑暗模式或选择他们收到的通知。

在前端，用户将根据他们在应用程序上的个人体验来定义他们想要什么和不想要什么，在后端，它只是向最终用户公开部分功能标志模式，让他们决定保留什么和删除什么。

这里的另一个考虑因素是使用屏幕时间或家长控制等功能，可以根据用户设备上其他地方的设置，触发一个终止开关来限制用户对特定应用程序的访问。当然，让用户承担定义他们将使用这种能力做什么的责任是另一个需要解决的问题。

*Reddit and many other apps allow users to self-personalize!* [*Source.*](https://mods.reddithelp.com/hc/en-us/articles/360022692051-Community-settings)

## 使用线束特征标志实现断路开关

这里有一个插件:使用[线束特性标志](https://harness.io/products/feature-flags/)让你能够实现所有这些开箱即用的用例。当您在 Harness 中设置功能标志时，您可以在可视 UI 中工作，也可以完全通过代码来管理您的 kill switches。当您最终希望利用内置的治理、合规性和安全性考虑因素，以及与 CI/CD 的关键集成(持续集成和持续交付)来扩展 kill switches 或其他功能标志用例的使用时，您也可以高枕无忧。

毕竟，你不希望建立一个与软件交付过程的其余部分完全分离的伟大特性标记系统。它使您在访问控制、安全性、治理和集成维护方面的工作加倍。你最终在你的特性标记平台上获得的回报越来越少，而这个平台本应*加速*软件交付。

如果你想了解 Harness 如何融入你的组织，你可以[永久免费注册](https://app.harness.io/auth/#/signup)，或者[联系我们](https://harness.io/company/contact-sales)进行个性化的产品演示。