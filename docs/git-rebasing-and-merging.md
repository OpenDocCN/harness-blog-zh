# Git 基础和合并:你应该使用什么，什么时候使用？装具

> 原文：<https://www.harness.io/blog/git-rebasing-and-merging>

对于 Git 的重新基础和合并，以及何时使用什么，存在混淆。我们提供了一些例子来阐明每种策略的适用范围。

我们很多人都熟悉 Git，所以我们理解开发者复制、分支等概念。在这篇文章中，我将重点介绍 Git 重定基础和合并之间的区别，以及不同场景的最佳策略。在我们最近的发布过程增强和分支策略实现中，我们使用了重定基础。我也会解释背后的原因。

## Git 合并示例

为了解释合并，我从终端执行了几个命令。接下来，我将添加那些图，并解释在合并中发生了什么。

在上图中，我创建了一个 new_branch，添加了两个提交，并展示了 Git 日志。

在这个图中，我展示了 Git 日志图，以阐明 master 和 new_branch 是如何偏离的。

在下一段中，我切换回 master 并创建了一个 commit，然后我使用递归 Git 合并策略将 master 分支合并到 new_branch 中。

现在，当我们研究 Git 日志时，它显示另一个新的提交被添加到 new_branch，这是由于合并而生成的。

最后，当我们看到 Git 日志时，它会像这样显示在提交图上。

从上面的选项中，很明显合并是有用的，因为它是非破坏性的操作。唯一的缺点是创建了一个额外的 **Merge commit，**,这对于遍历提交历史来说是很烦人的。

**缺点**:如果主服务器太活跃，那么遵循这种策略将会创建太多的合并提交，并且在大多数情况下历史会变得不干净。

## Git 重置示例

让我们重新考虑同样的例子。策略是移动特征分支的整个尖端。此外，通过这种方法，我们在主分支中有效地引入了所有新的提交。然而，通过为原始分支中的每个提交创建新的提交，rebasing *重写了项目历史，而不是使用合并提交。*

**优势:**重新设定基数有助于保持我们分行的历史更加清晰。此外，它避免了引入额外的合并提交。最后，从上图中，我们可以看到它有助于保持分支历史的线性。

交互重定基础:这是关于重定基础的一个重要特性，因为它赋予开发人员在他们的特性分支中选择提交的权力。例如，我在我的 Feature 分支中从事 Feature-X 开发，一些提交进入了影响 Feature-X 的 master 分支。master/main 分支也可能包含针对其他特性/bug 修复的多个提交。这就是交互式重定基础的用武之地:它允许您有选择地挑选您想要的提交，并且在有大量提交时比挑选更有效。

**分支镜像和重置:**这是我在 android 项目中遇到的问题。谷歌发布一个分支，芯片组公司，如高通，接管这个分支，并决定一个不同的长期战略来管理它并最终发布。合并/重定基础的策略是最终确定发布策略的关键。基于先前发布分支中可用的修复，以及变更的复杂性，他们决定是否选择重新构建基础和合并。任何其他从芯片组公司获得发布分支的第三方移动公司都遵循类似的策略。对于那些将其他公司的发布作为其开发基础分支，并从它们那里发布产品的公司来说，这是一个至关重要的过程。理想情况下，这一过程应该是自动化的，并在较少的人工干预下进行管理。

## 线束重置基础和分支策略

我们最近在 Harness 引入了一个新的分支策略，以保持主分支的干净并简化我们的发布过程。对于我们的 Harness-core repo，我们有一个开发分支，作为默认分支。开发人员必须从开发中生成特性/bugfix 分支，PR 检查在开发分支上运行。然后，所有的开发变更被合并到开发分支。

这个分支概念是为了在开发阶段早期捕捉 bug。这就是为什么我们每天都要构建开发分支，并将其部署到我们的预 QA 环境中。不同的团队在预 QA 环境中运行他们的自动化套件，如果一切顺利，那么我们将开发分支变更移植到主分支。重定基础在这里起着重要的作用。

选择重置基础而非合并有两个原因:

1.  保持主分支的分支历史干净。
2.  避免引入合并提交，从长远来看，合并提交会变得难以恢复。

在下图中，我提供了关于我们的分支和自动化策略的高级概念:

## 结论

从历史上来说，Git 的重定基础和合并，以及何时使用什么，一直存在混乱。我希望上面的例子阐明了在什么情况下重基础和合并是合适的，并且这篇文章帮助你决定在不同的开发阶段使用什么策略。

关于 Git 的话题，我们最近发表了关于 [Git 同步体验](https://harness.io/blog/git-sync-experience/)和 [Git 分支](https://harness.io/blog/git-branching/)的文章。如果您想扩展您的 Git 知识，请随意阅读这些内容！