# Kubernetes 服务说明|线束

> 原文：<https://www.harness.io/blog/kubernetes-services-explained>

本教程将解释四种 Kubernetes 服务类型之间的区别，以及如何为您的应用选择最好的一种。

## 了解集群 IP、节点端口、负载平衡器和入口

Kubernetes 已经成为管理和扩展云原生应用的强大工具。组织需要快速部署其软件，利用高度可扩展且始终可用的功能来保持零停机时间。随着越来越多的应用程序被容器化和部署，任何组织管理这些容器都变得越来越复杂。因此，缩放成为一个问题。这就是 Kubernetes 大放异彩的地方。使用 Kubernetes，您可以轻松地自动化、部署、扩展和监控您的应用程序。

如果您读过任何关于 Kubernetes 服务和网络的文档，您可能会遇到术语 ClusterIP、NodePort、LoadBalancer 和 Ingress。围绕这些术语似乎有很多混淆，在开始构建下一个基于 Kubernetes 的应用程序之前，您必须理解其中的区别。

本教程将解释这四种 Kubernetes 服务类型之间的区别，以及如何为您的应用程序选择最好的一种。

## 了解应用的网络需求

Kubernetes 网络和服务是一个复杂的话题。为了在 Kubernetes 上成功部署应用程序，您需要了解应用程序的需求。这意味着了解您想要提供的服务类型、集群的大小和位置，以及您希望您的应用程序接收哪种流量。

Kubernetes 支持四种类型的服务: **ClusterIP、NodePort、LoadBalancer 和 Ingress** 。每一种都有自己的一套要求来支持您的应用程序，因此您必须在部署之前了解您需要哪一种。

例如，节点端口允许同一个节点中的吊舱在没有分配 IP 地址的情况下相互通信。您的 Kubernetes 群集必须至少有两个节点，这种类型的网络通信才能正常工作。此外，节点端口仅在从集群内部访问时才工作，这与允许外部访问的负载平衡器或入口相反。让我们逐一了解它们是如何工作的。

### **集群 IP**

ClusterIP 是默认服务，支持群集中多个 pod 之间的通信。默认情况下，如果没有手动定义，您的服务将在 ClusterIP 上公开。外界无法访问 ClusterIP。但是，Kubernetes 代理可以用来访问您的服务。这种服务类型用于您的工作负载之间的内部联网，同时调试您的服务、显示内部仪表板等。

## **节点端口**

节点端口是最简单的网络类型。它不需要任何配置，只是将主机上随机端口的流量路由到容器上的随机端口。这适用于大多数情况，但也有一些缺点:

*   您可能需要使用反向代理(如 Nginx)来确保 web 请求被正确路由。
*   每个端口只能公开一个服务。
*   每次 pod 启动时，容器 IP 都会不同，这使得 DNS 解析变得不可能。
*   容器不能从 pod 外部访问本地主机，因为没有配置 IP。

然而，您可以在实验期间和临时用例中使用 NodePort，例如演示、POC 和内部培训，以展示流量路由是如何工作的。建议**而不是**在生产中使用 NodePort 来公开服务。

## **负载均衡器**

负载平衡器是 Kubernetes 网络最常用的服务类型。它是一种标准的负载平衡器服务，在每个 pod 上运行，并建立与外部世界的连接，可以连接到互联网等网络，也可以连接到您的数据中心内。

负载均衡器将保持与运行中的 pod 的连接，并关闭与运行中的 pod 的连接。这类似于 AWS 上的 ELBs，或者 Azure 上的 Application Gateway。上游为 HTTP(S)流量提供第 4 层路由，而下游为 HTTP(S)流量提供第 7 层路由。

您可以根据目的端口号、协议和主机名来路由流量，或者使用应用程序标签。您几乎可以向这种服务类型发送任何类型的流量，例如 HTTP、TCP、UDP、Grpc 等等。使用这种方法直接公开您的服务。

## **入口**

Ingress 不被认为是官方的 Kubernetes 服务，但是它可以用来公开服务。您可以通过创建规则来定义哪些入站连接应该到达哪些服务，从而配置入口服务。

入口是一个 Kubernetes 对象，位于多个服务的前面，充当智能路由器。它定义外部流量如何到达群集服务，并配置一组规则以允许入站连接到达群集上的服务。

入口规则通常由注释定义。入口控制器读取这些注释，并相应地配置 iptables 或 NGINX。有许多类型的入口控制器拥有不同的能力。你可以在这里找到入口控制器列表。

Ingress 是用于公开服务的最强大的服务类型，它只需要您维护一个负载平衡器，这比使用负载平衡器服务类型更便宜。

**这里有一个简单的对照表，帮助您快速了解服务类型。**

***Image credit:*** [***StackOverflow***](https://stackoverflow.com/questions/41509439/whats-the-difference-between-clusterip-nodeport-and-loadbalancer-service-types)

## 结论:Kubernetes 在云原生世界中是必须的

Kubernetes 是自动化和管理 IT 基础设施的强大工具。它使您能够对基础架构的相关部分进行分组，在集群中为它们提供自己的“节点”，使它们更易于管理、监控和更新。

随着 Kubernetes 的采用率飙升，它已经成为开发人员和企业在云原生空间中保持竞争力的必备平台。

[Harness Platform](https://harness.io/products/platform) 具有轻松增强 Kubernetes 部署的所有功能。Harness 有一个直观的仪表板，您可以在其中轻松配置您的部署阶段、目标基础设施和执行策略。[今天就请求您的演示](https://harness.io/demo/)。

我们很乐意成为您旅程的一部分，因为我们在 Harness 大量使用 Kubernetes。想开始吗？我们在 Kubernetes 上有一个快速入门指南，可以帮助你[使用 Harness CD](https://docs.harness.io/article/7in9z2boh6-kubernetes-quickstart) 部署你的第一个应用。