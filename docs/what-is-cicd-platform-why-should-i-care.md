# 什么是 CI/CD 平台，我为什么要关注它？装具

> 原文：<https://www.harness.io/blog/what-is-cicd-platform-why-should-i-care>

了解全面的 CI/CD 平台的组件以及在整个软件交付生命周期中的优势。

简而言之，CI/CD 平台是一套全面的工具，可以帮助您的开发人员、工程师和 DevOps 从业者将软件打包并交付给最终用户。如果您不采用 CI/CD 平台和最佳实践，您(和您的公司)很快就会全军覆没。你的竞争对手将能够在灵活性、效率和治理方面胜过你。这篇文章将帮助你理解 CI/CD 的基础知识，并提供一些流行工具的例子。

## 我为什么要关注 CI/CD 平台？

如果 CI/CD 不会对他们的日常工作生活产生积极影响，谁会关心它呢？根据角色的不同，CI/CD 平台具有不同的优势。

***开发人员/软件工程师:*** 虽然编写一堆 CI/CD 脚本来管理软件的构建和交付很有趣，但是维护这些脚本一点也不有趣。随着范围越来越大，维护几十个、几百个或几千个脚本成为重要的[辛劳](https://landing.google.com/sre/sre-book/chapters/eliminating-toil/)的来源。CI/CD 平台消除了大部分繁重的工作，让您有时间做您和您的公司最喜欢的事情——创建业务功能。

以下是更多关注使用 CI/CD 平台的理由:

*   按需部署
*   自动验证和回滚
*   降低变更失败率
*   提高软件质量

***DevOps 从业者:*** 作为一名 DevOps 从业者，你可能要负责确保所有的软件构建和交付管道都是可用的、自助服务的、高性能的，并按预期运行。你还可能负责生产中应用程序的健康和性能，就像一个 [SRE](https://harness.io/blog/sre-vs-devops/) 经常做的那样。一个好的 CI/CD 平台将使您的工作生活变得更加轻松，因为:

*   为工程师提供自助服务能力
*   降低构建和部署管道的脆弱性
*   更容易的管道维护
*   所有管道的标准化
*   新服务更快上线
*   在构建和部署期间更快地发现问题
*   错误部署的自动回滚

***安全/审计:*** 在让团队走得更快和确保企业安全之间有一个平衡。管理 [CI/CD 管道](https://harness.io/blog/ci-cd-pipeline/)的传统方法只有最低限度的安全和审计能力。使用具有粒度 RBAC 和完整审计跟踪的 CI/CD 平台将确保安全性和敏捷性之间的适当平衡。

***管理:*** 少花钱多办事，讨便宜。这是一项艰巨的任务，但使用现代 CI/CD 平台也可以实现。使用标准化的构建和部署管道，您的团队将:

*   更快地提供新服务
*   减少维护脚本的时间
*   构建更多业务功能
*   按需部署新软件
*   将更少的缺陷发布到生产中
*   这样做可以省钱

## CI/CD 已定义

***CI 是持续集成的缩写。*** 持续集成是开发人员将代码签入代码库(repo)后开始的过程。开发人员不会一次处理一个项目的全部源代码，他们会处理从 repo 中签出的一部分源代码。

***很好，但是什么是代码库呢？代码库是保存所有源代码文件的地方。流行的代码库有 [GitHub](https://github.com/) 、 [GitLab](https://gitlab.com/) 和 [Bitbucket](https://bitbucket.org) 。***

回到 CI 讨论…在他们完成变更后，开发人员签入代码，以便更新可以合并到主源代码中。合并应该依次启动一个构建过程，该过程创建可以运行和测试的工件。理想情况下，新的构建会被自动测试，并向开发人员提供反馈，这样他们就知道更改是否破坏了任何东西。当所有开发人员为任何应用程序或服务编写代码时，这个过程会一遍又一遍地重复。

One possible example of a Continuous Integration pipeline.

***CD 是首字母缩略词，有两种不同的意思。*** CD 代表连续交货。CD 也代表持续部署。

***什么是连续发货？持续交付是打包您的软件工件(在持续集成过程中创建的)并使它们处于准备交付到 QA、UAT 或生产环境中的过程。***

***什么是持续部署？*** 持续部署是将打包软件(来自持续交付流程)部署到一个或多个环境中的过程，无需人工干预(例如批准)，通常由提交或新构建触发。

One possible example of a Continuous Delivery pipeline.

## CI 和 CD 有什么区别？

CI ( [持续集成](https://harness.io/blog/what-is-continuous-integration/))是开发人员用来创建准备构建到可用软件中的工件的过程。CD ( [连续交付](https://harness.io/blog/what-is-continuous-delivery/))是将那些工件准备好交付给生产中的客户的过程。CD(连续部署)是将软件构建(工件)部署到测试或使用环境中的过程。

在本文的其余部分，我们将认为 CD 包括连续交付和连续部署。

## 持续交付和持续部署有什么区别？

这真的非常简单:连续交付为部署准备工件，由人类决定是否/何时/何处部署。连续部署自动化了软件工件的部署，而不需要人工干预。

## 持续集成的优势

采用持续集成的要点是加快合并和验证代码更新的过程。持续集成通常包含单元测试，以查看代码的修改部分在隔离状态下是否如预期那样工作。在单元测试之后，执行集成测试以确保更新的代码在更大的软件构建的上下文中如预期的那样运行。一些常见的 CI 工具包括 Jenkins、Drone、GitLab 和 BitBucket。

简而言之，CI 的主要优势如下:

*   更快的开发人员迭代
*   更好的发布质量
*   提高开发人员的效率
*   更一致的构建流程
*   降低用户体验不佳的风险

## 持续交付和部署的优势

成功实现持续交付和持续部署的公司比成功实现持续集成的公司要少。CI 是比 CD 更成熟的学科。然而，重要的是要注意，实现 CD 有很多好处。

CD 是软件交付组织遇到困难的地方。它是所有构建和维护软件的艰苦工作交付到最终用户热切手中的地方。

部署软件的过程容易出错。CD 传统上是一个由一系列 shell 脚本控制的进程。通常，有 15-20 个不同的 shell 脚本，由许多不同的工程师手工创建和维护。当需要更新时，更新并确保没有错误会耗费大量时间。部署过程中的人为错误会导致以下问题:

*   嘿，生产服务器正在使用一个测试数据库
*   哎呀，应用服务器内存不足，因为我们使用了错误的配置
*   哦，我们刚刚将新服务部署到了错误的 Kubernetes 集群，导致性能下降

总而言之，CD 的主要优势是:

*   速度-自动化部署比手动部署更快
*   一致性——没有机会忽略一些重要的东西
*   通过错误配置降低安全事故的风险
*   降低成本/提高开发人员效率
*   使用自动回滚加快 MTTR(平均修复时间)

## CI/CD 平台的组件

一个完善的 CI/CD 平台支持从代码检入到部署后验证等自动化软件交付流程。

具体来说，一个基本的 CI/CD 平台需要以下模块:

*   持续集成——减少新构建的交付时间
*   持续交付——总是有一个功能性的新版本可以部署
*   持续部署——随意部署新版本

这些是构建、打包和部署新软件版本的基础。虽然基础知识是一个很好的起点，但是在构建自动化软件交付管道时，还需要考虑更多。

除了上面列出的基本功能之外的重要考虑事项:

*   管道有多脆弱？
*   建立一条管道并提供一项新服务需要多长时间？
*   改变容易吗？或者说管道的维护比没有管道更麻烦吗？
*   谁可以执行管道？
*   是否有监管或其他审计的审计跟踪？
*   每次变更或新服务的成本是多少？典型的过度供应是否正在发生并浪费利润？
*   发现和解决不良部署的速度有多快？

考虑到上述因素，CI/CD 平台应包括以下内容:

*   持续集成——减少新构建的交付时间
*   持续交付——总是有一个功能性的新版本可以部署
*   持续部署——随意部署或回滚新版本
*   [持续验证](https://harness.io/2019/08/continuous-verification-machine-learning-to-safeguard-your-deployments/) -立即了解新版本的运行状况
*   [云成本管理](https://harness.io/continuous-efficiency/)——了解每个版本的财务影响
*   [持续治理](https://harness.io/2020/05/automating-enterprise-governance-within-delivery-pipelines/)——实现粒度访问控制，知道谁执行每一个管道动作

### CI/CD 平台如何支持更频繁的代码部署

不是每个公司都需要每小时部署多次，但每个公司都需要能够在几分钟内按需部署新版本，并确信新版本不会对客户满意度产生负面影响。

CI/CD 平台旨在帮助您自动化开发人员检入代码和将代码发布到产品之间的步骤。如果没有 CI/CD 平台，DevOps 从业者通常会将执行所有必要步骤的 shell 脚本串在一起。这些 shell 脚本的治理很弱，并且对变化很敏感，这使得它们很难管理。

CI/CD 平台极大地简化和标准化了管道创建和管理流程，新管道可以在几小时内创建，维护只需几分钟。CI/CD 平台提供可重复使用的模板和自助服务模型，允许软件工程师构建自己的管道并自行部署。一个完善的 CI/CD 平台还包含强大的治理，因此您可以控制谁有权访问和审计所有执行的操作。

### 使用 CI/CD 平台提高软件部署的质量

测试，测试，更多的测试。测试必须在软件交付生命周期的早期进行。

CI 管道应该执行单元测试、集成测试、OSS 安全测试、依赖测试和许可测试。

CD 管道应该执行冒烟测试、回归测试、漏洞测试、浏览器测试、负载测试、性能测试、可用性测试、质量测试等。

一旦软件被部署，测试就不会停止。监控软件发布以了解质量是绝对重要的。一个强大的 CI/CD 平台将集成所有主要的监控解决方案，并解释数据以验证部署的质量。如果发现重大问题，CI/CD 平台应建议或启动适当的措施，如回滚。

### 治理在软件交付过程中的重要性

治理是 CI/CD 平台最重要的考虑因素之一，但经常被忽视。自动化带来了一种新的风险，即任何人都可以在未经授权或不知道自己真正在做什么的情况下，轻易地破坏数字业务。无论自动化是通过脚本还是通过更健壮的软件平台来完成，问题都是一样的。使用软件平台比使用脚本更容易实现治理。一个好的 CI/CD 平台将具有细粒度的基于角色的访问控制(RBAC ),可以控制每个用户的身份验证和授权。在这个高度公开的安全漏洞时代，仔细分析任何 CI/CD 平台的 RBAC 功能是非常必要的。

另一个重要的治理功能是集成的机密管理。在任何配置文件中以纯文本形式保存机密是一种反模式。许多公司已经开始使用像 AWS Secrets Manager 或 Hashicorp Vault 这样的秘密管理器。CI/CD 平台也可以包含自己专有的 secrets manager，如果你还没有的话。

最后但同样重要的是，审计(这个可怕的词)发生在最糟糕的时候。从来没有真正适合审计的时候，但是如果您的 CI/CD 平台跟踪并记录所有主要活动、执行时间以及执行人，那么它可以使您的下一次审计更快、更容易。

对于许多 CI/CD 平台来说，治理是一项挑战。我们创建了另一篇博文，更详细地探讨了这一点和其他 [CI/CD 挑战](https://harness.io/blog/ci-cd-challenges/)。

### 使用 CI/CD 平台简化 Canary 部署和蓝绿色部署

蓝/绿和淡黄色部署可能难以实施。它们是高级部署模式，需要一定的专业知识才能成功实现。

***蓝/绿部署:*** [蓝/绿部署模式](https://harness.io/blog/blue-green-canary-deployment-strategies/)依赖于两个尽可能相似的独立生产环境(一个标为蓝色，另一个标为绿色)。到了更新软件的时候，您将新版本部署到绿色环境，然后指示您的路由器/交换机将所有流量发送到新更新的绿色环境。如果出现任何问题，您可以通过告诉您的路由器/交换机回复到将所有流量发送回已经运行先前软件版本的蓝色环境，从而几乎立即回滚。

***金丝雀部署*** : [金丝雀部署模式](https://harness.io/blog/blue-green-canary-deployment-strategies/)使用单一生产环境。当需要更新软件时，您可以将新版本部署到全部节点的子集，并指示路由器/交换机将一小部分流量发送到更新的节点，而大部分流量继续使用旧版本。假设在更新的节点上运行的流量一切顺利，您逐渐将更新滚动到更多的节点，同时向更新的服务发送更多的流量。随着时间的推移，您要么将所有节点更新到新版本，要么回滚到以前的版本。

这些部署模式非常适合通过 CI/CD 平台实现自动化。因为这些都是众所周知的模式，所以如何执行这些部署的知识被整理并在平台内可重复。这消除了开发人员或 DevOps 从业者的专业知识负担，并将负担放在了生产 CI/CD 平台的公司身上。没有必要重新发明轮子，只需重复使用已经创造出来的东西。

## 使用持续验证发布更好的软件

当您考虑一个完整的 CI/CD 平台可以访问的所有信息时，很明显 CI/CD 正在成为软件世界的中心。CI/CD 平台可以访问以下数据:

1.  更改事件
2.  服务可用性
3.  资源分配和消耗
4.  功能质量
5.  交易性能
6.  安全细节
7.  云成本

对于任何负责确保软件平稳运行和生产中业务连续性的人来说，这是一个异常丰富的数据集。通过将 ML(机器学习)算法应用于这个丰富的数据集，CI/CD 平台能够并且应该提供可操作的见解，从而带来以下好处:

*   更稳定的版本
*   更少的生产缺陷
*   更快地识别影响客户的问题
*   减少开发人员审理事故的工作量
*   降低云支出

## 我的 CI/CD 管道应该有多快？

[DORA (DevOps 研究&评估)](https://www.devops-research.com/research.html)根据发送给 DevOps 从业者的调查发布年度报告。该报告包含基准信息，有助于比较您自己的 DevOps 功能的成熟度。

开发运维状况报告列出了每个组织都应该跟踪的 4 个关键指标:

1.  部署频率-“您的组织多久部署一次代码？”
2.  变更的前置时间-“从代码提交到代码成功地在生产中运行需要多长时间？”
3.  平均恢复时间(MTTR) -“发生服务事故时，恢复服务通常需要多长时间？”
4.  变更失败率-“有多少百分比的变更会导致服务降级或随后需要补救？”

该报告还将成熟度分为 3 个类别(低绩效、中等绩效、高绩效),并使用度量范围来帮助确定您属于哪个类别。以下是详细情况:

1.  部署频率
2.  低绩效者:每月一次到每 6 个月一次
3.  中等表现者:每周一次到每月一次
4.  高绩效:按需(每天多次部署)
5.  研制周期
6.  低绩效者:1 个月到 6 个月之间
7.  中等表现者:一周至一个月
8.  高绩效者:不到一小时
9.  MTTR
10.  低绩效者:不到一天
11.  中等表现者:不到一天
12.  高绩效者:不到一小时
13.  故障率
14.  表现不佳者:31-45%
15.  中等表现者:16-30%
16.  高绩效者:0-15%

正如你从上面的衡量标准中所看到的，成为一名优秀的员工需要付出真正的努力。它推动了对简单而强大的 CI/CD 平台的需求，但也需要对人员和流程进行投资。

***成为一个高水平的执行者有什么影响？*T5[2017 年发展状况报告](https://services.google.com/fh/files/misc/state-of-devops-2017.pdf)中有总结:**

“我们发现，高绩效员工实现或超过以下目标的可能性是普通员工的两倍多:

*   产品或服务的数量。
*   运营效率。
*   客户满意度。
*   提供的产品或服务的质量。
*   实现组织和使命目标。
*   向外部证明组织是否正在实现预期结果的措施。"

## 流行的 CI/CD 平台解决方案

***Harness***-[Harness 是一个现代 CI/CD 平台](https://harness.io/products/platform/)，目前提供持续集成、持续部署、基于机器学习的自动化部署验证和回滚、功能标志、细粒度 RBAC、全面审计跟踪、专有和集成机密管理，以及带有建议的云成本监控。它是为云原生技术而构建的，但也能很好地与传统技术配合使用。

Harness 作为 SaaS 平台提供，但也为需要它的公司提供内部服务。Harness 是一家商业软件供应商，但也提供其持续集成模块的开源版本。

***詹金斯*** - [詹金斯](https://www.jenkins.io/)已经存在多年，因此，它面向传统技术，但也支持更新的云原生架构。Jenkins 提供持续集成、持续交付、脚本化部署验证和回滚、粗粒度 RBAC、通过插件的审计跟踪以及集成的机密管理。

Jenkins 是开源的，但是也可以从 Cloudbees 购买。目前，Jenkins 仅在本地提供，不在 SaaS 提供。

***git lab***-[git lab](https://about.gitlab.com/)与这里列出的其他 CI/CD 平台有点不同，因为它也是一个流行的代码库。GitLab 提供持续集成、持续部署、手动部署验证和回滚、细粒度 RBAC、全面审计跟踪和专有机密管理。

*需要注意的是，GitLab CI/CD 平台只能与 GitLab 代码库和专有机密管理器一起使用，这与此处列出的其他平台不同。*

GitLab 在内部和 SaaS 均可用。

***Azure devo PS***-[Azure devo PS 是微软的 CI/CD 平台](https://azure.microsoft.com/en-us/services/devops/)。这个平台有许多不同的模块，包括代码库(Azure Repo)、CI/CD 管道(Azure 管道)、工件管理(Azure 工件)、社区扩展、测试工具(Azure 测试计划)和看板(Azure 板)。正如对微软产品的预期，Azure DevOps 提供了细粒度的 RBAC、审计跟踪和带回滚的部署验证。Azure DevOps 与云原生技术配合良好，也支持遗留技术，但遗留支持主要属于微软软件范畴。

Azure DevOps 作为 SaaS 解决方案提供，但也有一个名为 Azure DevOps Server 的本地版本。

## 深入了解 CI/CD 平台

本文旨在提供 CI/CD 平台所能提供的高级概述。下一步，我建议阅读 [CI/CD 购买者指南](https://harness.io/learn/ebooks/buyers-guide-for-ci-cd-ebook/)，其中提供了 CI/CD 工具的深入比较。它应该有助于您就使用哪种工具做出明智的决定。