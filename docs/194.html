<html>
<head>
<title>Getting Started with Cloud Cost Optimization | Harness</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>云计算成本优化入门|利用</h1>
<blockquote>原文：<a href="https://www.harness.io/blog/cloud-cost-optimization#0001-01-01">https://www.harness.io/blog/cloud-cost-optimization#0001-01-01</a></blockquote><div><p>如今，您可以利用云成本管理来实现无风险旋转，从而消除围绕云成本优化的挑战。从今天开始获得洞察力和节省！</p><div fs-richtext-element="rich-text" class="blog-rtf w-richtext"><p>随着<a href="https://harness.io/platform/cloud-cost-management/" target="_blank">云成本管理</a>的推出，以及现在的云成本管理试用，每个人都有机会接触到云成本优化。如果您对如何开始感到好奇，即使您是Harness平台的新手，我们也能满足您的需求。</p><p>在这个例子中，我利用了Amazon Elastic Kubernetes服务，并可以访问AWS中的计费模块。让我们开始着手进行云成本管理。像往常一样，你可以关注博客和/或观看视频。</p><figure class="w-richtext-figure-type-image w-richtext-align-center"/><h3>入门-注册线束</h3><p>如果你还没有，注册一个<a href="https://harness.io/try-continuous-delivery-as-a-service-for-free/">线束账户</a>。对于这个例子，我们将利用Harness CD平台的免费社区版。</p><figure class="w-richtext-figure-type- "/><p>一旦你<a href="https://app.harness.io">登录到</a>你的账户，你会看到一个Harness仪表盘。</p><figure class="w-richtext-figure-type- "/><p>利用Harness要做的第一件事是安装一个<a href="https://developer.harness.io/docs/platform/delegates/get-started-with-delegates/delegate-installation-overview/"> Harness委托</a>，它是一个代表您执行操作的worker节点。</p><p>切换齿轮很快，我有一个等待<a href="https://aws.amazon.com/eks/">亚马逊EKS集群</a>。所以谨慎的驾驭委托应该是Kubernetes委托。</p><figure class="w-richtext-figure-type- "/><p>回到Harness平台，安装委托很简单。</p><p>设置-&gt;线束代理-&gt;安装代理。选择Kubernetes YAML，并给出一个像“保持低成本”的名称。</p><figure class="w-richtext-figure-type- "/><p>下载完TAR后，展开TAR，然后进入展开的文件夹。</p><figure class="w-richtext-figure-type- "/><p>在Delegate文件夹中，有一个包含KubeCTL指令的自述文件。运转</p><p><em>ku bectl apply-f Harness-Delegate . YAML</em>将安装线束代理。</p><figure class="w-richtext-figure-type- "/><p>几分钟后，可以在代理UI上验证线束代理已连接。</p><figure class="w-richtext-figure-type- "/><p>利用代表离开后，让我们准备好开始被云成本管理观察的EKS集群。</p><h3>Kubernetes集群准备</h3><p>云成本管理使用<a href="https://docs.aws.amazon.com/eks/latest/userguide/metrics-server.html"> Kubernetes Metric Server </a>作为数据点。根据您的Kubernetes提供者的不同，在您实例化一个集群时，它可能会也可能不会为您安装。就EKS而言，默认情况下不存在这种情况。</p><p>您可以通过运行"<em>kube CTL apply-f https://github . com/Kubernetes-sigs/metrics-Server/releases/download/v 0 . 3 . 6/components . YAML</em>"来安装Kubernetes Metric Server。</p><figure class="w-richtext-figure-type- "/><p>可以通过运行“<em> kubectl top nodes </em>”来快速测试Kubernetes度量服务器是否正在运行。</p><figure class="w-richtext-figure-type- "/><p>准备好您的Kubernetes/EKS集群后，是时候启动您的云成本管理试验了。</p><h3>激活您的云成本管理试用</h3><p>激活<a href="https://developer.harness.io/docs/first-gen/cloud-cost-management/new-to-ccm-get-started-with-a-trial/setup-ce-harness-editions/">云成本管理试验</a>非常简单。在左侧导航窗格中导航。点击“持续效率”，可以报名参加平台内部的云成本管理试用。</p><figure class="w-richtext-figure-type- "/><p>一旦你点击开始免费试用，可以开始在配置布线。如果您需要回到设置，可以导航回持续效率-&gt;设置。</p><figure class="w-richtext-figure-type- "/><p>随着Kubernetes代表运行布线在EKS集群是轻而易举的。从云成本管理设置菜单中选择Kubernetes集群。</p><p>分两步将Kubernetes集群添加到Harness平台。首先将Kubernetes集群命名为“Big Money Cluster”，单击Test，然后单击Next。</p><figure class="w-richtext-figure-type- "/><p>单击下一步后，在持续效率启用菜单上，选中启用持续效率。</p><figure class="w-richtext-figure-type- "/><p>单击Submit，您就可以监控Kubernetes的使用情况了。</p><figure class="w-richtext-figure-type- "/><p>云成本管理需要2-3个小时来完成其初始评估。当云支出数据可用时，您将收到一封电子邮件。</p><figure class="w-richtext-figure-type- "/><p>如果存在现有工作负载，也将开始报告使用数据。不过，如果这是您第一次与Kubernetes集群交互，或者第一次浏览这个示例，您可以很容易地用Harness CD播种一些工作负载。</p><h3>播种Kubernetes工作负载</h3><p>如果您的Kubernetes集群像示例中我的集群一样是空的，那么利用Harness CD来<a href="https://github.com/harness-training-dept/KubernetesCDWorkshop">部署一个示例工作负载</a>是一个很好的下一步。Harness在一个<a href="https://developer.harness.io/docs/first-gen/starthere-firstgen/harness-key-concepts/"> CD抽象模型</a>上工作，该模型是Harness应用程序的基础。</p><p>通过转到以下页面添加<a href="https://developer.harness.io/docs/getting-started/learn-harness-key-concepts/">线束应用</a>:</p><p>设置-&gt;应用程序+添加应用程序</p><figure class="w-richtext-figure-type- "/><p>可以添加一个名为“不贵App”的应用。</p><figure class="w-richtext-figure-type- "/><p>一旦您点击提交，就可以开始填写抽象模型的各个部分。</p><figure class="w-richtext-figure-type- "/><p>第一部分是建立一个<a href="https://developer.harness.io/docs/getting-started/learn-harness-key-concepts/">线束环境</a>来部署。</p><p>设置-&gt;不贵的应用-&gt;环境+添加环境。创建一个名为“沙箱”的非生产环境。</p><figure class="w-richtext-figure-type- "/><p>我们可以让Harness知道，作为“沙箱”环境的一部分，我们刚刚用一个<a href="https://developer.harness.io/docs/first-gen/continuous-delivery/model-cd-pipeline/environments/infrastructure-definitions/">基础设施定义</a>连接了Kubernetes集群。</p><figure class="w-richtext-figure-type- "/><p>点击+添加基础设施定义。可以将定义“K8s集群”命名为Kubernetes集群类型，并将成为Kubernetes部署。</p><figure class="w-richtext-figure-type- "/><p>单击Submit，现在是时候通过创建一个<a href="https://developer.harness.io/docs/getting-started/learn-harness-key-concepts/#services">线束服务</a>来定义您实际部署的内容了。</p><p>设置-&gt;不贵的应用-&gt;服务+添加服务</p><figure class="w-richtext-figure-type- "/><p>一旦点击添加服务，可以添加一个名为“Nginx”的Kubernetes服务。</p><figure class="w-richtext-figure-type- "/><p>一旦在服务中，可以为Nginx连接一个工件源，这将是公共Docker Hub添加工件源。线束预先与公共Docker集线器连接，作为电源。</p><figure class="w-richtext-figure-type- "/><p>连接“library/nginx”作为工件源并点击Submit。</p><figure class="w-richtext-figure-type- "/><p>一旦点击Submit，您的图像就被连接到默认的脚手架上，这对于这个例子来说已经足够了。</p><figure class="w-richtext-figure-type- "/><p>在您部署之前，将需要创建一个<a href="https://developer.harness.io/docs/getting-started/learn-harness-key-concepts"> Harness工作流</a>来指导Harness如何处理您的应用程序。</p><p>设置-&gt;不贵的应用-&gt;工作流+添加工作流</p><figure class="w-richtext-figure-type- "/><p>添加一个名为“Deploy Nginx”的工作流作为滚动部署。选择之前创建的环境、服务和基础结构定义。</p><figure class="w-richtext-figure-type- "/><p>单击提交后，您就可以开始部署了。</p><figure class="w-richtext-figure-type- "/><p>单击部署。选择一个标签，如“最新”并点击提交。</p><figure class="w-richtext-figure-type- "/><p>几分钟后，您无畏的Nginx将被部署到您的K8s集群！</p><figure class="w-richtext-figure-type- "/><p>完成第一次部署后，您也可以坐下来等待最初的2-3小时播种期。</p><h3>了解您的第一个集群成本明细</h3><p>一旦您收到数据准备就绪的电子邮件，就该回到云成本管理了。</p><figure class="w-richtext-figure-type- "/><p>返回到Harness平台，然后在左侧导航中转至云成本管理。预算和浏览器链接将被激活。可以点击Explorer来查看您的第一组Kubernetes集群支出。</p><figure class="w-richtext-figure-type- "/><p>仔细看看“大钱集群”的效率，我们可以看到云成本管理如何分解<a href="https://harness.io/blog/kubernetes-containers-cost/" target="_blank"> Kubernetes容器使用</a>。</p><figure class="w-richtext-figure-type- "/><p>总的来说，肯定有一些方法可以调优这个集群。对于我们的示例工作负载和利用代表，我们过度配置，如果这是一个长期运行的集群，我们可以调整Kubernetes集群的大小并重新部署工作负载。对我自己来说，我为AWS上的团队维护了几个其他服务，我们也可以将云成本管理连接到AWS本身。</p><h3>获得更多资金——云提供商布线</h3><p>我的Kubernetes工作负载成本只是云成本管理所能提供的一部分。您可以获得更多关于将云提供商计费API接入云成本管理的见解。这将真正有助于云成本优化。</p><p>您的AWS帐户必须是<a href="https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_create.html">组织</a>的一部分。可以在AWS组织控制台中进行验证。</p><figure class="w-richtext-figure-type- "/><p>查看<a href="https://developer.harness.io/docs/cloud-cost-management/onboard-with-cloud-cost-management/set-up-cloud-cost-management/set-up-cost-visibility-for-aws/">文档</a>和/或导航到持续效率- &gt;设置- &gt;连接到您的AWS帐户，从AWS导出使用数据需要几个步骤。云成本管理向导将引导您前进。</p><figure class="w-richtext-figure-type- "/><p>第一步是在您的AWS帐户中创建一个成本和使用报告。可以启动AWS控制台或利用云成本管理中的按钮。</p><figure class="w-richtext-figure-type- "/><p>在AWS控制台中，单击创建报告。</p><figure class="w-richtext-figure-type- "/><p>可以给出当前报告的名称，例如“my-cur-report”。确保选择包括资源id和自动刷新。</p><figure class="w-richtext-figure-type- "/><p>点击下一步后，创建一个S3存储桶来存储当前报告。</p><figure class="w-richtext-figure-type- "/><p>可以给新桶起个名字。虽然<a href="https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-s3-bucket-naming-requirements.html"> S3桶</a>在整个可用性区域必须是唯一的，但是我的桶名“bigmoney-cur-bucket”不会是唯一的，因为我正在利用。</p><figure class="w-richtext-figure-type- "/><p>点击“下一步”后，默认策略就可以了。回到交付选项菜单，将报告路径前缀改为“ce”，将时间粒度改为每小时，将报告版本改为覆盖现有报告，将GZIP改为压缩。</p><figure class="w-richtext-figure-type- "/><p>点击查看并完成。一旦设置完成，您的第一个CUR将在24小时内由AWS交付。</p><figure class="w-richtext-figure-type- "/><p>同时，可以将新的报告和存储区连接到云成本管理设置中。</p><figure class="w-richtext-figure-type- "/><p>下一步是授予云成本管理对CUR报告的访问权限，以分析其中的内容。这将通过身份和访问管理[IAM]角色来完成。</p><figure class="w-richtext-figure-type- "/><p>通过点击启动模板按钮，您将进入AWS云形成模板创建向导，例如快速创建堆栈。</p><figure class="w-richtext-figure-type- "/><p>默认值就可以了。确认并创建堆栈。</p><figure class="w-richtext-figure-type- "/><p>云形成堆栈将被创建。在堆栈的输出部分，复制CrossAccountRoleARN值。</p><figure class="w-richtext-figure-type- "/><p>ARN值和您的帐户名称将是您需要连接到云成本管理AWS设置向导的最后两个连接。</p><figure class="w-richtext-figure-type- "/><p>完成后，您应该已经连接了CUR和IAM细节。</p><figure class="w-richtext-figure-type- "/><p>单击保存并继续，退出确认提示，现在一切就绪。</p><figure class="w-richtext-figure-type- "/><p>云成本管理需要24小时来分析您的云支出。你现在已经开始省钱了！</p><h3>线束平台——提升您的体验</h3><p>云成本管理是Harness平台中的一个支柱。云成本管理的起源是支持和解决我们自己的<a href="https://www.finops.org/what-is-finops/">财务运营</a>挑战。正如我们在<a href="https://harness.io/saas-cloud-spend-survey-2020/"> 2020年关于SaaS云支出的报告</a>中所报告的，控制云成本对于各种规模的组织来说都是一项挑战。借助云成本管理和新的试用能力，证据就在布丁中。请务必<a href="https://harness.io/platform/cloud-cost-management/" target="_blank">注册</a>，立即开始节省云成本！</p><p>您想了解更多关于其他工具的信息吗？我们制定了要考虑的顶级<a href="https://harness.io/blog/cloud-cost-management-tools/" target="_blank">云成本管理工具</a>。</p></div></div>    
</body>
</html>