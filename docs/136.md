# CI/CD 管道的 service now-RBAC 职责分离|线束

> 原文：<https://www.harness.io/blog/servicenow-ci-cd-pipelines>

Harness 可以管理 ServiceNow 的多个实例，并具有完整的基于角色的访问控制(RBAC)以实现职责分离。利用光盘即服务。

昨天，我们[宣布了我们的 B 轮融资](https://techcrunch.com/2019/04/23/harness-hauls-in-60m-series-b-investment-on-500m-valuation/)，IVP、谷歌和 ServiceNow 都参与了这一轮融资。

正如您所料，Google 和 ServiceNow 都在 CI/CD 中扮演着重要角色，特别是在云/容器编排和变更管理方面。

早在一月份，Harness 宣布集成 Atlassian 吉拉，以帮助开发团队自动化部署的标签/审计和管道阶段的批准。今天，我们非常高兴地宣布对 ServiceNow 提供同样的支持。

在一个典型的企业中，我们看到吉拉往往是开发团队(生产前)的记录系统，而 ServiceNow 是 IT Ops(生产)的系统记录。

为了使[连续交付](https://harness.io/blog/what-is-continuous-delivery/)在这些企业中扩展，需要利用来支持两个记录系统，以便可以跨所有团队、环境和系统简化和自动化变更。

Harness ServiceNow 支持支持两种主要使用情形:

1.**使用 ServiceNow 票证跟踪/审核生产部署**(和管道)的进度。
2。**批准/拒绝部署管道阶段**或使用 ServiceNow 票证的工作流。

这里有一个关于新集成的 3 分钟快速入门:

## 将 ServiceNow 与 Harness 集成

Harness 可以管理 ServiceNow 的多个实例，并为职责分离提供了完整的基于角色的访问控制(T2)。

只需几分钟就可以将其集成到您的部署管道中。

转到:**设置>连接器>协作提供商> +添加协作提供商**

## 使用 SNOW 票证跟踪部署管道

现在，Harness 使您能够在执行管道、阶段或部署工作流期间，根据需要多次创建或更新票据。

例如，让我们在 Harness 中编辑一个现有的部署工作流，以便在部署工作流执行开始时创建一个票据，并在该工作流成功完成时更新同一个票据。

为此，让我们**打开**，**编辑一个现有的部署工作流，**和**将 ServiceNow 任务**添加到我们的预部署和后部署步骤中:

为了**创建一个票**，我们简单地配置**预部署步骤**如下:

注意，我们可以使用线束变量(使用$ pre-fix)来用工作流、工件和管道上下文填充标签。

我们还可以从输出中创建一个名为“snow”的新变量，这样我们就可以在工作流中再次引用同一个 ServiceNow 票据，以便进行更新。

为了**更新相同的 ServiceNow 票证**，我们可以在部署工作流中配置一个**部署后步骤**，如下所示:

请注意，我们使用变量 **${snow.issueNumber}** 作为键来引用我们在**预部署步骤**中创建的同一个 ServiceNow 票证。这意味着我们可以以增量方式向同一个 ServiceNow 票证添加活动，而无需记住票证 id 或标识符。

现在，当我们下一次运行我们的部署工作流时，我们看到我们的 ServiceNow 步骤完全可视化(下面的屏幕截图)。请注意我们刚刚在屏幕截图的右下角创建的 ServiceNow 票证的深层链接:

单击上述部署工作流中显示的深层链接，我们将直接进入 ServiceNow 票证，并显示我们在部署前和部署后步骤中记录的所有活动:

这样，您就有了:在单个 ServiceNow 票证中对您的部署管道进行全面的进度跟踪！
现在来看第二个用例...

## 使用 ServiceNow 票证批准管道阶段

到目前为止，我们的客户只能使用我们的 Harness UI 中闪亮的大按钮来批准/拒绝管道阶段或工作流执行:

或者使用吉拉(如果运行 ServiceNow 的话会有点烦人)。

如今，客户只需更新预定义的 ServiceNow 票证属性的值，即可在 ServiceNow 票证中完成所有这些工作。

例如，将 ServiceNow 票据的**状态属性**更改为“已解决”或“已批准”可以自动批准执行管道阶段或部署工作流。

同样，这实际上需要几分钟的时间来配置，您就可以开始了。

## 为管道阶段添加 ServiceNow 批准

假设我们有一个简单的三阶段部署管道，包括开发、QA 和生产。

现在，假设我们需要一个新的 ServiceNow 批准阶段来管理代码如何从 QA 提升到生产。

点击 QA 和生产阶段之间的“ **+** ”符号。现在，让我们定义一下我们的 ServiceNow 批准标准应该是什么样的:

选择 **ServiceNow 实例和票据类型**(事件、变更或问题)。

最后，定义票证**发行号**，它将批准/拒绝您的管道阶段(您可以使用您的 snow 管道会话变量)。

在上例中，将工单**状态**更改为**完成**将批准流水线阶段，将工单**状态**更改为**完成**将拒绝流水线阶段。

一旦我们的批准被配置，我们的管道现在有 4 个阶段:

我们开始了:只需 5-10 分钟，您就可以在 ServiceNow 中全面审计线束部署管道。此外，您还可以使用 ServiceNow 来推动管道阶段批准。

想试试马具吗？您还有两分钟就要开始我们的[审判](https://harness.io/try-for-free-continuous-delivery-as-a-service/)。

干杯，
史蒂夫。
@伯顿说