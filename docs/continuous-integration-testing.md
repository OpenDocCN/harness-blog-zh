# 持续集成测试的分解

> 原文：<https://www.harness.io/blog/continuous-integration-testing>

持续集成测试是在 CI 过程中关注和执行的测试。CI 过程中的测试允许快速的反馈，并且通过设计，如果没有满足最低质量，就停止工件的进展。

软件是一次迭代之旅，创新伴随着大量的试验和错误。随着我们向生产进军，我们的信心增强了。[持续集成](https://harness.io/blog/what-is-continuous-integration/)是通过允许系统构建和将部署工件发布到工件库中来允许迭代的核心部分。在传统的团队中，可部署的工件标志着他们的工作产品完成的一个重要里程碑。

软件交付生命周期(SDLC)是一个建立信任的练习。随着所有权的增加，软件开发团队想要生产高质量的特性和工件，并且质量工程步骤继续向左推进以增加信心。您的[持续集成(CI)管道](https://harness.io/blog/ci-cd-pipeline//)是开始运行某些建立信心的步骤并确保变更的质量和一致性的一个自然点。

[持续集成和持续交付](https://harness.io/blog/what-is-ci-cd/)是有区别的。关于在哪里运行测试覆盖的一个很好的界限是是否需要部署。将应用基础设施/环境考虑在内，例如[浸泡测试](https://en.wikipedia.org/wiki/Soak_testing)——那些测试最好在管道的连续交付过程或连续部署部分(即 CD 管道)中运行。欲了解更多关于 CD 工具的信息，请访问我们的 [DevOps 工具](https://harness.io/devops-tools/)对比。

## 什么是持续集成测试？

在创建和构建软件时，可重复性是一个至关重要的概念。拥有在任何时间点创造或再创造的能力增加了自信。持续集成的[大好处之一](https://harness.io/blog/what-is-continuous-integration/)是可重复性；将构建外部化，而不是锁定在开发人员的机器上。第二是与其他团队成员并行运行构建或测试的能力。本地运行的测试覆盖是通向持续集成管道的绝佳候选。就像 DevOps 将开发和运营团队聚集在一起一样，CI 管道中的测试可以帮助 QA 团队以系统的方式向开发团队转移。

持续集成测试是在 CI 流程中关注和执行的测试，由 CI 工具(如 CircleCI、Travis CI 和像 [Drone 或 Jenkins](https://harness.io/jenkins-vs-drone/) 这样的开源工具)编排，负责构建、打包和发布工件。当构建一个/多个工件时，当它们穿越到发布候选的旅程时，有一个期望的质量水平。CI 过程中的测试允许快速的反馈，并且通过设计，如果没有满足最低质量，就停止工件的进展。通常，CI 测试在部署到第一个集成环境之前关注工件。

持续集成测试在 CI 支柱、构建、打包和工件发布的每一个过程中充当质量关口。在 JAVA 示例中，这可能是在 JAVA JAR 构建发生之前运行单元测试。然后，在打包阶段继续围绕从该容器中产生的 Docker 映像进行某种一致性测试。最后，在发布到 Docker 注册表之前，对要发布到注册表中的许可或漏洞进行飞行前检查。所有这些措施都有助于提高软件质量。

### CI 测试的重要性

持续集成测试允许在本地环境之外的另一个严格级别的迭代和反馈。尽管新编写或修改的特性与应用程序/服务的集成是从构建开始的，但是在提交之前，生产、本地开发的旅程可能会导致许多本地构建/周期。通过持续集成测试不仅意味着工件有能力被一致地构建，而且在发布之前工件的质量水平也已经达到。

失败的构建远没有失败的部署严重。有一种预期是，带有继承的质量检查的构建可能第一次就通不过，因为这是第一次将来自工程师机器的外部因素结合在一起。在 CI 测试中发现错误和修复是完全正常的。这些测试被编排在一个管道中，分为两类:过程上的和过程外的测试。

## 过程中与过程外测试

持续集成管道是持续集成测试的指挥者。CI 中完成的任务是 CI 过程中创建的工件的构建、打包和发布这三件事。

持续集成管道中的测试可以在由 CI 流程直接调用和控制的流程以及那些在 CI 流程外部的流程上进行描述。这类似于在开发人员的本地机器上运行的流程与必须扩展的流程。如果您将集成开发环境(ide)视为本地构建的纽带，则项目会像单元测试一样在 IDE 内部运行，并与 IDE 外部的第三方工具(如容器扫描器)进行交互。

### 论过程测试

可以在构建代理/运行器中执行的测试代表流程测试。过程中测试通常通过执行语言特定的构建过程理解的语言特定的测试步骤来完成。运行测试所需的基础设施作为依赖项包含在内；例如，Maven POM 中包含的 [JUnit 依赖项](https://junit.org/junit5/docs/current/user-guide/#running-tests-build)。尽管出于健全性和安全性的考虑，这些依赖关系应该在发布之前从最终的工件中移除。

### 进程外测试

随着对项目向工程师左移的大力推动，例如 DevSecOps 运动，帮助传播和解锁关键数据以及对开发团队的反馈的工具大量涌现。过程外测试关注非功能性需求，这是单元/功能测试(例如，在过程中运行的测试)所涵盖的。过程外测试的一个标志是向持续集成过程之外的第三方提交数据、代码或工件。例如扫描集装箱，图像将由外部过程(例如集装箱扫描软件)进行内省。

不管测试是在过程中还是在过程外，测试覆盖都是为了给产生的工件注入信心。有几种测试方法可以在持续集成管道中运行，并且值得实现。

## 不同类型的 CI 测试

从 CI 过程的开始(即，它由代码签入触发)到发布的工件，在自动化构建期间有几种类型的 CI 测试要运行。

### 代码质量测试

根据正式 CI 流程的起点，如果检查或合并代码的质量关口已经到位，而不是在事后，代码质量测试可以成为 CI 流程的一部分。代码质量工具，如[sonar cube](https://www.sonarqube.org/)和 [Checkmarx](https://www.checkmarx.com/) ，专注于静态代码分析，在代码变更期间保持谨慎。代码本身并没有运行，也没有考虑到支持软件运行的所有基础设施和环境变量，尽管代码分析可以推断质量。寻找死块(从未调用或到达的代码)、语法质量/标准和潜在的安全问题都是代码质量测试的一部分。尽管代码质量并不关注代码的实际功能，而这正是单元测试的切入点。

### 单元测试

用新特性运行或编写或更新的典型测试是单元测试。单元测试关注于改变的代码块/方法。如果从头开始构建一个新的项目，这些将覆盖应用程序的功能。单元测试通常是过程测试，其中创建模拟对象并验证断言。JAVA 世界的 JUnit 和 NPM 世界的 [Mocha](https://mochajs.org/) 。单元测试被设计成细粒度的，并作为一个套件运行。例如，如果您正在编写一个计算器应用程序，并添加一个整数除法的新特性，那么单元测试可能是如何处理被零除，或者执行该除法的预期结果。如果用例需要外部方法/团体来调用，单元测试覆盖将不够，集成测试将接管。

### 集成测试

随着多项功能的构建，它们很少生活在真空中。计算器应用程序不仅仅有除法，而且除法可能很复杂(例如小数、精度等)。根据测试中设定的界限，集成测试可以有很宽的范围。对于持续集成环境中的集成测试，它将集中于测试应用程序的跨模块。回到计算器的例子，集成测试会同时进行除法和乘法运算(还记得你的运算顺序吗？).现代单元和集成测试工具有很多重叠。JUnit 可以用于单元和集成测试，因为 JUnit 可以追踪/跟随/调用可以链接在一起的方法调用。集成测试延续了信心的连续性，因为新的特性/新的代码变化被认为是一起工作的。

### 安全性/许可证测试

俗话说软件的老化更像牛奶而不是葡萄酒，这是真的——特别是在依赖第三方开源的现代软件中，工程团队很少是进入最终发行版的 100%位的作者。在“开发的迷雾”中，对于一个工程师来说，知道所有可传递的依赖关系(调用其他依赖关系的依赖关系)是不合理的。安全/许可测试的目的是发现使用某些包的暴露和风险。安全/许可证分析工具，如 [Blackduck](https://www.blackducksoftware.com/) 、 [Snyk](https://snyk.io/) 、 [StackHawk](https://www.stackhawk.com/) 等，有不同的自省方法。一些工具需要成品来运行，例如 docker 映像。其他工具在代码级集成，用于内省构建文件。

在 CI 管道中运行测试的一个额外好处是它们运行得更频繁，从而支持连续测试。如果您是从零开始，或者处于持续集成和集成测试覆盖的早期，那么将您的第一组测试转移到 CI 管道中是一个谨慎的举动。

## 将您的第一个测试转移到 CI 管道中

具有讽刺意味的是，持续集成曲线的一部分是获得构建、测试和打包运行所需的依赖关系。例如，如果您正在编写一个将打包到 Docker 中的 JAVA 应用程序，请确保 CI 平台能够支持 JAVA 构建(具有 JDK、Maven/Gradle)和 Docker 依赖项(Docker 运行时)。

测试如何影响构建？如果其中一个测试覆盖没有通过或者没有找到可接受的结果，那么构建、打包和发布步骤会继续吗？惯例是:他们不会。虽然如果第一次进入 CI 测试，提升 CI 管道上本地创建的内容将是建立 CI 流程信心的一种方法。

*样本线束持续集成 Kubernetes 管道调用 Maven 测试。*

上图:以 JAVA 为中心的例子。测试由构建工具调用。在这种情况下 [Maven 测试](https://maven.apache.org/surefire/maven-surefire-plugin/examples/single-test.html)。

下图:NodeJS 示例，运行 [npm 测试](https://docs.npmjs.com/cli/v7/commands/npm-test)。

*样本线束持续集成 Kubernetes 管道调用 npm 测试。*

无论这是您对 CI 平台的第一次测试还是第一千次测试，Harness 都能帮您完成。

## 持续集成测试:驾驭之道

Harness 持续集成平台允许您快速启动并运行测试自动化，并且还可以帮助您磨练——并改进——您的测试策略。要克服的第一个障碍是“CI 依赖”问题(持续集成服务器/工具 Jenkins 的常见问题)。使用现代方法，我们可以以 Docker 的方式解决依赖性。只需在简单的配置中声明需要什么，并利用持续集成就能解决需要什么。

大规模运行测试的一个问题是覆盖范围的不可见性。这增加了执行时间，并可能产生重复的测试覆盖。拥有一个适当的测试覆盖和执行的方法在规模上是至关重要的。

*可视化流水线执行时间*

## 利用线束改进 CI 测试

软件开发实践的速度越来越快。对于微服务/敏捷开发，CI 的重要性随着更小、更频繁的构建而变得显著。无论这是您第一次利用持续集成来开始自动化测试执行，还是您已经这样做了几十年，Harness 平台都可以帮助您快速一致地实现您的目标。

随着新技术和测试方法的出现，拥有一个强大而灵活的平台，允许您将这些技术和方法添加到管道中并衡量其影响，可以建立信心并帮助实现敏捷性。如果您想了解更多信息，请查看我们为开发人员举办的 [CI 网络研讨会](https://harness.io/continuous-integration-101-for-devs/)，并确保立即注册[线束平台](https://harness.io/platform-free-trial-lp)！

干杯，

拉维