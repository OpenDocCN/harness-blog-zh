# ShipTalk 播客-来自运营部门的 DevOps 健身中心的 Chris Jowett | Harness

> 原文：<https://www.harness.io/blog/ship-talk-podcast-devops-from-the-ops-side-chris>

DevOps 工程师没有一条路可走，请向 Chris 学习运营团队的发展如何转化为 DevOps。例如，支持的服务数量与基础设施支持。Chris 谈到了现代方法，例如永远不要修补系统。

在本期 ShipTalk 中，我们将与 ABC Fitness 的 DevOps 架构师 Chris Jowett 进行交流。Chris 拥有丰富的系统工程经验，并在不同组织的多个运营团队中工作过。DevOps 是开发规模的运营焦点，例如工程效率。

DevOps 工程师没有一条路可走，请向 Chris 学习运营团队的发展如何转化为 DevOps。例如，支持的服务数量与基础设施支持。Chris 谈到了现代方法，例如永远不要修补系统。这一集还有更多！

## 副本

**拉维·拉赫曼** 00:07
大家好！欢迎回到 ShipTalk 播客的另一集。很高兴能与我们的一位来自 ABC Fitness 的朋友 Chris Jowett 交谈，他是 DevOps 的工程师。克里斯，你为什么不给不认识你的听众介绍一下你自己呢？

克里斯·乔维特 00:20
是的，我一直在做 DevOps 的事情，在它被称为 DevOps 之前。我一直在做计算机自动化。但正式来说，我拥有 DevOps 头衔大概有三到五年了。我正式成为 DevOps 建筑师已经有六个月了。

拉维·拉赫曼 00:40
太棒了。所以有一点背景——我可以作弊，看看克里斯的 LinkedIn——这是克里斯真正让我兴奋的地方:通常有两个阵营的人最终会从事 DevOps 职业。就像 DevOps 的名字一样，有些人来自开发部门，他们现在专注于开发管道的操作化。还有像 Chris 这样的人——Chris 的背景[来自]作为一名系统工程师的漫长而稳定的职业生涯，从系统工程的角度来关注开发管道。

真正有趣的是，我认识的大多数人都有开发背景——(假设)Chris 和我在同一家公司工作，十年前，Chris 和我在工作之外会是好朋友，但我们会在办公室里相互竞争，因为作为工程师，Chris 会被视为不让我部署的人。

但是克里斯，我们为什么不谈谈系统工程的一些原理呢？这在 DevOps 世界中有什么重要的？

**Chris Jowett**01:35
是的，既然我们在谈论开发人员和工程师的互动方式，开发人员非常热衷于“把代码装在盒子里，让它运行起来”显然，他们更关注代码——他们编写代码。工程师更关注实际系统和系统的健康状况。我们倾向于不太关心代码，只要它运行并且不破坏我们的系统。

你会经常看到这种情况，所以我们围绕这一点做了一些设计实践。也就是说，不让人们登录盒子是防止人们破坏盒子的一个重要方法，甚至到了我们不再登录自己的盒子的地步。

拉维·拉赫曼 02:19

太棒了。事实上，这将是 10 年前我和你之间真正的互动，这是如何演变的。

因此，我曾经因为在我们的 Linux 机器上丢弃策略而臭名昭著。从我的角度来看，我参与的大多数项目，从一开始我就不在那里。我工作过的应用程序有很多细微差别，但当我们开始深入微服务架构并分解事物时，我会说，“我不知道这两个服务通过哪个端口相互交流。”所以我会放弃 iptables 或 SE Linux，然后我会得到运营团队中其他人的严厉批评，“为什么在您的部署脚本中放弃所有这些东西？为什么这里有这么多伪电话？我们会被审计的”。但仅此而已；有人会跟我说话，然后[就像是]好吧，我们得去解决问题。

但是现在，我们一起工作。你如何开始实施护栏和开发实践来协调这两个阵营呢？

**Chris Jowett**03:25
是的，我们现在拥有的最好的东西之一就是集装箱化的基础设施。也就是说 Kubernetes 是一种大狗。[现在]，开发者不再有能力做像 drop iptables 这样的事情，因为你只能影响你自己容器内部的东西。通常现在，我们甚至已经将应用程序的安装从服务器转移到了第一位置，因此 CI/CD 系统构建了一个不在部署系统上的容器。所以当它被部署时，它在技术上已经安装好了。它应该已经过验证和测试；你现在只是在经营它。您只需执行它，因此过去发生的所有疯狂安装都不会再在目标系统上发生了。

即使你想，你甚至没有权限这样做，因为通常情况下，我们不允许人们访问主机系统。您只能影响容器内部的内容，并且是在正确设置的基础设施中。您有安全策略，限制容器本身可以做什么。

拉维·拉赫曼 04:29
是的，我知道了；很有道理。假设我是你们公司的开发人员。我的 kubectl 访问在哪里结束？当 Kubernetes 启用自助服务时，这总是一个非常热烈的讨论。但是我想听一个系统工程专家说:你在哪里停止我的 kubectl 访问？

**Chris Jowett** 04:47
所以这个问题的答案现在在 ABC 内部发生了很大的变化。在 2021 年之前，作为 DevOps 团队，我们的主要工作是构建、部署和运行应用程序。这是一个正在大力开发的全新应用程序。我们没有让开发者进入这个平台——不是因为我们不需要他们，也不是因为我们不信任他们。但是仅仅因为我们没有足够的带宽来开发这个功能。

这实际上是我们在 2021 年努力的核心原则:实现更多的自助服务，并让开发运维团队不再碍事。因为按照我们的运营方式，我们在很多地方被打断，为了通过下一步，你必须联系 DevOps。我们希望尽可能地将自己从这个循环中解放出来，并允许开发人员在有意义的地方为自己做事。

实际上，我们现在已经找到了这个问题的答案。我们倾向于——具体来说是 Kubernetes 分离应用程序，获得它们自己的名称空间。然后负责该应用程序的开发人员就可以访问该名称空间。尤其是底层环境，比如开发和 QA 环境(我们底层的两个环境)，我们尽量不干涉。我们允许他们删除 pod 或进行重新启动、提取日志、查看服务和入口配置。他们基本上可以查看名称空间中的任何内容。

他们甚至有一些有限的能力来改变事情。但是我们不让他们做某些事情，比如查看秘密，因为你不应该对能够查看秘密感到舒服。您将失去这种访问权限，就像下一个环境一样，它已经不存在了，为什么还要在这个环境中给你这种权限呢？然后，很明显，随着您进入部署管道，您可以访问的人越来越少，直到最终在生产集群上，基本上只有开发人员可以访问该集群。

拉维·拉赫曼 06:54
有道理。这是一个非常务实的回答。我感到非常欣慰的是，一些非常好的工程原理正在渗透进来！

我给你讲一点背景知识。我很乐意在 2015 年开始关注 Kubernetes。我的背景是 Java——像 J2EE 一样，Java 开发。所以当我第一次听说 Docker 的时候，我觉得它就像一条裤子。就像，“哦，我去科尔买了多克裤，”所以我就想，这是什么鲸鱼？我真的对我的经理这么说了，他说，“你疯了。”

但是开发团队的任务实际上是在我们的系统工程团队之前查看 Kubernetes，因为我们(系统工程)在 RHEL 上运行。我们[有] CloudFront 和 CloudFormation，我们让所有这些虚拟机都由卫星管理。但是 Kubernetes 是一个新的世界，作为一名开发者，他们所有的严格性都消失了，就像“我们就是要做。”所以没有那种僵硬感。

因此，随着技术的不断成熟，实践也随之发展，这是一件非常有趣的事情。我很喜欢你的解决方案，因为它有两个收音机转盘。我想听听你们是如何做到这一点的——因此有一个允许创新的无线电拨号，还有一个商业控制的无线电拨号。听起来你有一个非常好的模型:较低的环境，让开发人员工作和解决问题，然后你开始增加严格性。但是你如何平衡呢？你如何平衡创新和控制？

克里斯·乔维特 08:23
是的，所以每个人都希望能够说，“嘿，让我们推动最大限度的创新——我们将让每个人都能获得一切。”这有点类似于零信任网络模型。在一个假设的完美的零信任网络系统中，所有的东西都在公共互联网上，所有的东西都被认为是不可信的。所有的东西都可以互相交流，但前提是它们经过适当的认证和授权。因此，您可以将这一点与您部署基础架构的方式进行比较。

这在理论上是很棒的，但是在实践中，这有问题。这就是为什么，除了极少数例外，没有企业真的做零信任网络。他们混合了零信任和网络安全的洋葱模型。这也是您的基础架构最终更常见的情况。你试着尽可能敞开心扉。你试着尽可能信任你的开发人员，让他们能够创新，让他们能够快速工作，基本上不妨碍他们。

但是在某些时候，您需要说，“好吧，开发人员，您可能不应该能够登录到生产环境并删除 pods，”尽管您的 Kubernetes 集群应该构建为自动从该环境中恢复。从务实的角度来看，他们没有必要这样做，那么你为什么要允许他们这样做呢？但是接下来在开发和 QA 中，尽可能多地移除防护栏。只要确保有一个良好的分离，以便当他们试图快速移动和打破东西(你总是听到的咒语)。当他们试图快速行动并打破常规时，您应该以一种他们不可能对面向客户的环境产生负面影响的方式进行设计。

如果他们对自己的环境有负面影响，那也没关系。如果他们对客户产生负面影响，现在你有一堆问题要回答。

**拉维·拉赫曼** 10:25
[ *咯咯笑*一个事件；为什么会这样？

Chris Jowett 10:28
这就是你凌晨 2 点从你岳母的客厅通过 VPN 连接工作的原因——这让太多的人进入生产。

**Ravi lach man**10:38
对于传统基础设施来说，这是常态，对吗？在我的大部分角色中，我从未接触过 UAT 或以上的角色。就像一堵墙。然后突然，这种新奇的 Kubernetes 出现了，[它就像]，“哦，是的，你去那里。”所以需要一段时间。克里斯刚才说的所有这些原则都非常好。适应新的基础设施只是需要时间。这是我的老观点:技术是周期性的。

**Chris Jowett** 11:16
其发展的部分原因是因为在更多的传统基础设施上，一台服务器不仅仅运行一件事情；这是非常低效的。因此，即使在传统的基础设施中，您也会有一台服务器运行着大约 8 到 10 个不同的 web 应用程序。它不是应用程序“x”的服务器；它是一个运行多个应用程序的 web 服务器。而且你有不同的团队负责不同的应用程序，所以如果你允许一个开发者进入那个服务器[并且]对他们的应用程序有那种访问权—管理许可变得非常困难。

以这样一种方式管理权限并不是不可能的，即它们不能与其他应用程序混淆；您只是在权限和安全解决方案上增加了更多的复杂性。而在 Kubernetes 中，它是从底层开始设计的，用名称空间构建了这种级别的隔离。

我时常听说有人使用 Kubernetes 而不使用名称空间。比如，他们只是在默认名称空间中部署所有东西；比如他们可能使用 kube 系统，然后其他一切都默认了。这让我感到困惑。为什么不使用名称空间呢——它们太棒了。尤其是如果你希望允许开发者访问，这是第一步——开始部署名称空间。我们从每个环境一个名称空间开始，实际上我们正朝着每个环境应用程序组合一个名称空间的方向发展。就像应用程序“x”一样，我们在应用程序“y”中有一个命名空间，而 dev 有一个不同的命名空间。仅仅是因为它使得允许不同的开发团队访问他们需要访问的内容变得更加容易。

Ravi lach man13:00
这是一个非常好的答案。你说得很有说服力。它触动了我的心灵；当我第一次开始部署时——嗯，我没有直接进行部署——但是当我们第一次为我编写的 Java 应用程序拥有应用程序拓扑时，我们曾经拥有应用程序服务器模型。因此，您说得完全正确，就像一个应用程序服务器将服务于五六个不同的应用程序。

随着时间的推移，就在 Kubernetes 革命之前，我们部署的是一对一。它是一个轻量级的应用服务器，为一个应用服务。就是这样。所以当我们开始反思它时，它打开了我的思维，就像，“哦，是的，这就是我们所做的。”当我们第一次开始使用 Kubernetes 时，它是默认的。默认有一个很好的环，所以我们开始做同样的事情，像“这个 Kubernetes 集群，或小集群将处理我们所有的 10 个服务。”猜猜他们都去了哪里？默认。

**克里斯·乔维特** 13:55
在那里很容易部署东西。只是不要给它命名空间，这就是它去的地方。

是的，它模仿了我们在 2008-2009 年的部署方式。2015 年，我们在 2014 年的做法直到 2018 年才赶上我们。我们过去在旧系统中做的事情和我们在新系统中的工作方式有所不同。所以你说的很有道理。

有点改变了——克里斯经验丰富。对于一个年轻的系统工程师来说，作为一个进入系统工程游戏的人，你是如何将演进或革命(取决于你如何看待它)到 DevOps 中的？你是怎么做到的？

克里斯·乔伊特 14:41
是的，所以我觉得有点有趣。我在一家提供云服务器的公司工作，他们有一个托管层，就像“解雇你的 IT 团队，你让我们成为你的 IT 团队。”我们会安装你的网络服务器和一切。这是一个[平台即服务](https://harness.io/blog/what-is-paas/)，但我们会帮助您启动并运行 Jenkins，我们会安装 Apache，我们会帮助您配置 web 服务器，帮助您配置数据库等一切。你要为很多顾客做这件事，一天之内安装 50 个灯堆真的很繁琐。

所以你开始写脚本，因为你想少做你的工作，这样你就可以多做工作以外的事情。我喜欢称之为正确的懒惰。这就是它开始的地方。就像“我需要为随机的 WordPress 博客设置 50 个 LAMP 服务器。”所以你开始自动化这个过程。正常的发展是你写一个 bash 脚本，然后从那里开始，你继续做一些像 masterless Puppet 或 Ansible 这样的东西——一些稍微高级一点的东西。随着时间的推移，2014 年的神奇一天到来了，Kubernetes 出现了。它彻底改变了整个事情。大概就在那个时候，人们开始真正谈论 DevOps 这是因为现在我们有了一个非常好的平台来进行所有这些自动化部署。

但是在那之前，肯定有很多关于 DevOps 的工作，只是人们编写脚本——这就是我发现大多数系统工程师如何进入其中的。这只是因为他们希望能够持续快速地完成工作。轻松显然是另一个激励因素，能够运行脚本并在另一端获得一致的结果。这是工程师来到这个世界的动力。

**拉维·拉赫曼** 16:45
完美。是的，自动化水平似乎总是在提高。我们可以沿着记忆之路再走一段路，它实际上会显示出对这种程度的自动化的需要。我想说的一个常用或曾经常用的指标是工程负担率。克里斯有多少箱子？在这一点上，这可能是一个 20 年前的争论[或者]想到这一点是愚蠢的，但是让我们看看，比如说，当你走出大学或你的第一份工作时的演变。您维护了多少台机器，而一个普通的系统工程师现在需要维护的是什么样的？

克里斯·乔伊特 17:26
是的，问题是随着时间的推移，这个问题已经发生了变化。以前是你维护了多少个盒子。我可以说，我在 Linux 世界的第一次真正工作中，我维护了数千个，但不是一次全部。就好像顾客可以打电话进来，而我必须跳上他们的箱子，做他们需要的任何事情。但现在，话题已经从你管理多少个盒子转移开了；这几乎是一个毫无意义的指标。现在，问题是您管理多少种类型的系统，因为您已经实现了一切自动化。在我们的例子中，我们的基础设施是用 Spring Boot 和 NodeJS 构建的，所以先用 Java 构建 Spring，然后用基于 React 的前端构建 NodeJS。我只关心:是 Spring 微服务，还是 NodeJS 微服务？因为所有的 Spring 微服务都以完全相同的方式构建和部署。它们都是 Gradle 构建，都使用相同的测试运行程序，都经过 SonarQube，都用相同的标准化 Docker 文件构建。因此，我不在乎我部署的是 5 个还是 500 个 Spring 微服务，我所关心的是它们都以相同的方式工作，并且我与它们的交互完全相同。

所以现在的问题是，你要维护多少种类的东西？为了扩大规模，单个工程师可以做多少工作——您希望保持低类别数量。因此，我总是告诉人们，对于 DevOps 基础架构，从历史上看，需求是从应用程序流向系统工程师的:我构建了这个应用程序，它是如何工作的，为我构建一个满足我的应用程序需求的机器。现在，它是双向的。基础设施也有需求；如果你想让你的应用程序进入这个系统，它必须符合这种标准化的操作方式。在某种程度上，这几乎就像是满足一个 API 契约。需求是双向的，现在我维护多少机器已经不重要了。我大概有 30 或 40 个 Kubernetes 宿主，每个宿主大概有 20 或 30 个豆荚。因此，您有一个中等规模的 Kubernetes 基础架构，但它很可能是 500 个，这实际上不会改变任何事情。或者可能是 10，但这不会改变任何事情，因为它仍然是相同数量的系统类别。

拉维·拉赫曼 19:56
这是我听到的最现代的说法。现在一切都在于提供的服务。正如您刚才提到的，用户扩展的工作量从 10 扩展到 500，甚至 15，000，这在数量之间是微不足道的，因为让自动化支持这一点并满足您设定的 SLA 的所有后台工作都是一样的。基础设施更便宜，更有弹性，因此您不必担心如何配置某些东西，以及如何为内部客户提供他们需要的工具。

另一个问题，因为你有很长的职业生涯并喜欢系统工程，你今天做的事情在 10 年前或 15 年前会让你大吃一惊吗？所以我们有一点点预呼叫(对于听众)；克里斯和我确实谈到了他们今天做的一件事，这件事在 10 年或 15 年前的人看来是愚蠢的。

Chris Jowett 20:51
我的意思是，我今天做的几件事对我来说是疯狂的。就像，我们允许开发人员如此多的访问集群，这一直是一个禁忌，就像“不要让开发人员进入机箱，因为他们只会破坏东西。”现在我们鼓励自助服务。

我现在做的很多事情都让我大吃一惊。我记得有一次，像 Puppet 和 Chef 这样的配置管理系统——那是你如何大规模维护系统的顶峰。现在我们已经超越了这一点，甚至不再使用配置管理系统，因为我们不再维护系统。我已经三年没有做过任何系统修补了，因为我们有一次性的基础设施。当一个容器不再适用时，我们构建一个新的容器映像并替换它。当一个主机系统不再适用时，我们建立一个新的 AMI 并更换所有的主机系统。所以我们从来不喜欢登录到机器中安装更新，我们只是不时地用已经安装了所有更新的机器替换它们。

这样做的好处是，它给了你一个不登录你的盒子的非常好的理由，因为防止人们登录盒子和破坏东西的第一个方法是首先阻止他们登录盒子。如果他们没有登录到机器，那么他们就不能向您投放 iptables。

拉维·拉赫曼 22:20
[ *开玩笑地* ]我会放弃它，仍然有办法。

Chris Jowett22:24
*笑*这就是为什么我们不使用 root 权限运行你的容器！

**Ravi lach man**22:27
我最喜欢的一点是，你可以随时重建基础设施。所以实际上，这从发展世界得到了很多线索。在我们容器化应用程序之前，我们可以登录到应用服务器。(我们会)登录生产，或者我们正在查看各种具体的东西。我们可能会在运行的应用程序中动态地更改某些属性，或者进行调试，而不是切换到容器化技术——无论如何，如果您做出了更改，您就在构建一个新的映像。你没有登录到容器，你没有登录到 pod 你要重建。但我真正喜欢的是，作为一名软件工程师，这些原则已经融入了你的整个基础设施。这就是为什么我之前真的很兴奋。

Chris Jowett 23:22
这是每个人都想拥有的神秘的一次性基础设施。一些处于领导地位的人认为一次性基础设施和零停机部署。他们就像，“他们只是神话。”实际上，有一次我的首席技术官[告诉]我，零停机部署是虚构的，不存在，我一直在骗他，直到我向他证明我们可以实现零停机部署。然后他走开了。

**拉维·拉赫曼** 23:48
这是一个应用架构。我只会说英语，而且我很少听到新单词。我记得几年前我听到过短命这个词，我甚至不会拼写它。我就像拼字比赛中的一个孩子，看起来很傻，就像，“我可以用这个句子吗？”所以回到短暂的基础设施，你体现了它，对不对？

对于那些不知道短命是什么意思的人来说，比如几年前的我，它的意思是某物是可传递的或者是短暂的。还有另一个概念。我同时学到了两个词。一个是幂等的，也是短暂的。幂等性这是一个数学概念，无论你对一个等式做多少次，你都会得到相同的结果。因此，建设基础设施来支持这一点实际上非常具有挑战性。

克里斯·乔维特 24:44
这需要正确的心态。就像，很奇怪。对有些人来说，这真的很难做到。但是对于其他有正确心态的人来说，这是你知道的方式。所以这真的取决于你的心态。但是，它确实有好处，可以说，“我只是想部署这个 pod，您可以根据需要多次重新运行该部署。它已经部署好了，这并不是说我要部署两个吊舱，然后我会再得到两个并有四个，然后再得到两个并有六个“你只需说，“我想要两个吊舱。”

有些人把这称为陈述性的，你说你想要什么样的最终状态，然后你不说如何到达那里。但你不能忽视这样一个事实，即有些东西必须给出如何到达那里的指示。

Ravi lach man25:40
是的，我认为这是今年的热门词汇:声明式基础设施。就像，“我们给你我们想要的状态，然后某种系统会去调和差异。”但这也是一个具有挑战性的架构。【*开玩笑地*】试图像这里的 sat 一样在同一个句子中使用幂等和转瞬即逝。对于幂等系统，结果必须是一致的——但这违背了短暂性的原则，因为短暂性意味着事物会消失。因此，必须保持一致并为即将消失的事物而构建—我认为这是与所有这些新的云原生体系结构斗争的顶峰。这与传统工程学教你如何解决的完全相反。

所以还有一个问题。我总是喜欢用这个特殊的问题来结束播客。比方说，你走在大街上，遇到了一个年轻的克里斯，他刚从学校毕业或者刚找到第一份工作。对于现在的克里斯(也就是说，你们两个都见过面)，你会给以前的自己什么建议？它可以是任何一组建议。[ *戏谑*不要坐牢之类的。

**克里斯·乔维特** 26:52
*【开个玩笑】*是的，当那个家伙在街上出价时，走开就是了。

我很幸运在我的生活中，我已经取得了许多相当不错的职业发展。但有几次，如果我告诉自己“相信你的直觉，多相信你的直觉”，尤其是在我职业生涯的早期，结果可能会好一点。我可能还会鼓励自己更多地参与开发。这实际上是我们团队面临的一个挑战。

在播客之前，我们讨论了人们如何通过两种方式进入 DevOps 一个来自开发端，一个来自系统工程端。DevOps 大部分人大概都是从开发端过来的。他们进入 DevOps，因为他们需要部署他们的代码，也许他们的公司没有部署代码的人。所以他们想出了开发人员如何部署代码，然后，你就有了 DevOps。我的整个团队都是进入 DevOps 的系统工程师——据我所知很少——尽管对我来说，我认识的每个人都是 DevOps 的工程师。我们需要一个更关注开发者的人。

所以我知道如何用多种语言编程，但我不会说我在这方面很出色。我可能会告诉自己，嘿，多学一点编程知识。达到你不只是还好的程度，而是你实际上很擅长的程度。这将是我给自己的最大建议:不要害怕写代码。

拉维·拉赫曼有时会让人害怕。这不是你如何写你写的东西的问题——在我做软件工程师的这些年里，这归结于那个交叉点。我几乎可以写任何东西，但是你需要写的总是等式中最难的部分。

克里斯·乔伊特 28:52
是的。还有，时间管理。参加一些关于时间管理的课程，因为这是每个人的问题。每个人都有时间管理的问题；我肯定，在这场斗争中，我不是一个人。如果你要进入这种职业，时间管理课程真的会有很大帮助，特别是当你开始进入经理角色或者像我一样进入建筑师角色时——特别是一旦你开始达到高级工程师级别或者在管理或建筑领域，时间管理就变得非常重要。

拉维·拉赫曼 29:30
完美。好了，克里斯，非常感谢你在播客上花的时间。你是一位出色的客人，希望在下一期 ShipTalk 播客中与大家见面。

**克里斯·乔维特** 29:39
感谢邀请我。