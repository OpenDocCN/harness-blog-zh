<html>
<head>
<title>Building &amp; Releasing to Deployment Environments | Harness</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>构建和发布到部署环境|利用</h1>
<blockquote>原文：<a href="https://www.harness.io/blog/deployment-environments#0001-01-01">https://www.harness.io/blog/deployment-environments#0001-01-01</a></blockquote><div><p>代码质量非常重要，对吗？了解如何利用部署环境来保持高质量并避免风险。</p><div fs-richtext-element="rich-text" class="blog-rtf w-richtext"><p>“牛仔编码”这个术语是本着在生产环境中直接进行有争议的风险变更的精神创造出来的。这意味着代码不会首先进入较低的部署环境，而是直接交付给最终用户。这当然是有风险的，因为自动化测试和手动测试都被扔出了窗外。</p><p>就这一点而言，许多公司都有一系列生产前环境，他们的开发和运营团队利用这些环境来验证更改，然后再将其“完全投入”生产。在本文中，我们将讨论如何利用多种环境来确保一定程度的代码质量，以免潜在的错误、中断或其他混乱的场景打扰客户。</p><h2>什么是部署环境？</h2><p>在部署环境中，工程师、产品负责人、QA 团队和自动化可以用来了解新代码版本的行为和执行情况，以及从 UI 角度看它的外观和感觉。有时，每个应用程序的 SDE 数量会因应用程序生产环境的任务关键程度而异。此外，对于具有几个附加依赖项的复杂应用程序，如 AWS RDS 实例、Redis 集群或其他基础设施，更常见的是拥有一组标准环境，以便可以隔离测试更改(在需要时)。</p><p>我们在公司看到的一些常见环境是:</p><ul role="list"><li>发展</li><li>暂存，也称为“生产前”</li><li>生产</li></ul><p>根据工程团队的规模，所实施的开发方法(敏捷、瀑布等。)，无论 PR 或特定功能环境自动化是否到位，您都可能会看到大量其他 SDE，例如:</p><ul role="list"><li>质量保证</li><li>UAT 一号..普通</li><li>负载、性能和混乱测试</li><li>演示</li></ul><p>这些环境的最终目标是使团队能够独立地构建和测试基础设施和应用程序代码，并最终交付在生产中执行的高质量软件。</p><p>既然我们已经强调了一些在将代码转移到生产环境之前可以用来系统地测试代码的环境，那么让我们更深入地了解一下如何以及为什么要使用这些环境。</p><figure class="w-richtext-figure-type- "/><h2>开发环境的目的</h2><p>在大多数组织中，最新版本的代码可以在开发环境中找到。</p><p>因此，您已经通过本地开发环境对代码进行了一些修改，并在本地进行了测试(对吗？对吗？)，并提交了一份针对你上游分公司的 PR。这可能是您的开发分支，潜在的不稳定代码在这里被合并。CI 启动测试，并有希望为合并开绿灯。</p><p>开发环境的目标是允许软件开发人员批量修改代码，并通过 CD 将它们部署到远程开发环境中。如果你是一个 AWS 商店，这可能是在亚马逊 ECS，EKS，或在其他地方的简单 EC2 实例或虚拟机。也许你正在利用 Azure AKS 或 Azure 虚拟机。</p><p>此时，开发人员可以看到他们的代码更改在类似生产的环境中是否按预期工作。我这样说并不严格，因为环境的规模可能不同，但底层技术应该是相同的。这是为了避免“<a href="https://harness.io/blog/the-engineer-types/" target="_blank">它在我的机器</a>上有效，但在同事和客户可能会与之交互的实际部署环境中无效”的陷阱。这是 DevOps 团队关注的关键领域之一，因为它比我们希望的发生得更频繁，因为有大量的环境变量和配置文件条目可能是特定于环境的。</p><p>一旦在这个环境上的最终开发人员 QA 测试完成，代码可能会被合并到另一个上游分支，以便部署到下一个环境，通常是 staging。如果您的团队订阅了切割语义版本，那么接下来代码可能会被合并到 Git 的主分支中。此时，CI 可能会启动另一个构建管道来为登台环境重新构建资产，或者将之前构建的 VM 或 docker 映像提升为发布候选。这里的方法可能因应用程序和使用的编码语言而异。</p><p>例如，如果静态资产需要通过 Webpack、Gulp 等将特定于环境的 URL 嵌入到 JS/HTML 中，那么可能需要额外的构建步骤。出于调试目的，您可能还需要在较低的部署环境中安装不同的 npm 包或可选模块，但不是在生产环境中。</p><h2>试运行环境的目的</h2><p>既然我们已经有了用于登台的构建工件，工程师就可以通过他们的部署管道将代码部署到登台。一种常见的模式是用一个管道将代码从开发阶段运送到测试环境，然后运送到生产阶段。拥有一个统一的管道是有帮助的，因为它允许人们容易地将提交、部署、测试和推广新代码到产品中的端到端过程可视化。</p><p>在新代码投入使用后，人们可能会针对环境运行一套测试。这可能包括通过 Cypress 的端到端测试、集成测试、OWASP 安全扫描，如果没有专门的负载测试环境，甚至包括负载测试。</p><p>在我们的代码问题成为我们的客户之前，这是捕捉 bug、性能退化和安全问题的最后机会。作为一个最佳实践，即使测试已经完成，在产品化阶段手动检出特性总是明智的。测试信心需要时间来建立，我们真的能 100%确定我们的自动化测试覆盖了所有的情况吗？“信任但要核实”这句话在这里很适用。</p><p>在理想情况下，试运行环境应该尽可能接近生产环境。</p><p>所有数据库连接字符串变量都应保持与生产的奇偶校验，即指向暂存中的副本的副本/读取器 URL。就我个人而言，我见过很多本地副本数据库 URL 指向单个 Postgres 或 MySQL 数据库实例的情况，因此“写入”副本 URL 会被忽略。这也可能破坏 CI 中的检查，因为大多数团队没有在 CI 中运行多节点设置(有一个主节点和一个副本节点)。这种代码进入生产环境的业务影响因公司和应用程序而异，但在适当的情况下会导致重大的生产中断。</p><p>尽量不要在试运行和生产之间存在特定于环境的偏差，因为这可能会影响或破坏环境的效能。</p><h2>结论</h2><p>在将变更推向生产环境之前，利用多个部署环境彻底验证变更。确保从基础架构和配置的角度来看，您的生产前或试运行环境与生产环境尽可能相似，以减少遗漏问题的可能性。</p><p>如需进一步阅读，请查看我们关于<a href="https://harness.io/blog/ci-cd-best-practices/" target="_blank"> CI/CD 最佳实践</a>的文章，以及我们关于<a href="https://harness.io/learn/ebooks/ebook-pipeline-patterns/" target="_blank">部署管道模式</a>的电子书。</p></div></div>    
</body>
</html>