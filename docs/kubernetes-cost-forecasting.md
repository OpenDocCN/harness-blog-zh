# Kubernetes 成本管理策略:成本预测|利用

> 原文：<https://www.harness.io/blog/kubernetes-cost-forecasting>

现在我们已经有了很好的 Kubernetes 成本可见性，并且我们已经实施了成本节约，让我们进入最后一部分:成本预测。

在你对你的成本有了很好的了解之后，你可以利用这些数据来预测你未来的成本。但是这是不可避免的:准确的成本预测是关于统计分析的。因为它本质上是对未来的预测，所以你能做的最好的事情就是利用你对现有数据的了解来预测它会是什么样子。

成本预测通常有两种形式:

1.  预测你在未来某个时候的花费
2.  预测当前成本模式是否会超出预算支出

您可以使用历史数据来预测您在某个时间点的花费，通过这种方式，您可以执行以下操作:

*   避免超支和成本意外
*   简化预算和容量规划
*   实施更好的治理(例如，预算是软限制，配额是硬限制)

*这篇文章摘自我们的电子书《Kubernetes 的成本管理策略》。如果你喜欢你看到的内容，坚持到最后，我们会为你链接完整的电子书。它是免费的——最棒的是，没有栅门。*

## 您将看到的示例

凭借良好的成本预测能力，您将能够更好地规划未来，并在 Kubernetes 成本管理策略的三个步骤之间创建一个强大的反馈循环，该循环几乎可以独立运行。当您可以预测时，您可以执行以下操作:

*   预测 Kubernetes 的成本，以准确地为未来的发展做预算
*   通过预测成本波动(如季节性)并相应地调配资源，主动避免预算超支
*   根据 Kubernetes 对云资源的消耗来规划和执行预算
*   将成本映射到拥有成本的团队，以便他们知道他们将负责什么，从而提高透明度、可见性和责任性
*   通过创建沟通渠道，使团队围绕可能导致预算超支的成本变化保持一致，从而避免意外的退款

## 策略一:软硬限制

这是没有好的方法来预测成本的组织使用的主要策略，尽管它肯定被所有组织使用。限制花费是一种简单的方法，可以限制资源的使用，并确保你不会意外破产。然而，这可能是一种非常被动且不准确的方法，与业务现实脱节。

假设您使用一个简单的 Kubernetes autoscaler 来随着需求的增加提供更多的资源，或者从用户的角度来说，随着更多用户的加入提供更多的资源来运行应用程序。然而，突然有比计划更多的用户加入进来。您在控制平面中定义了硬限制，如[资源配额](https://kubernetes.io/docs/concepts/policy/resource-quotas/)，以将成本控制在预算内，现在您被阻止增加更多资源。会发生什么？你的应用崩溃，或者某些用户无法访问该应用。这从来都不是一个好结果。

在理想情况下，您希望能够设置这一限制，但要智能地设置，以便有效地利用基础架构，而不会像本例中那样碰壁。当您设置更智能的界限时，您就有更多余地来应对意外开销，同时仍将基础架构和成本问题保持在最低水平。

设置更智能界限的一种方法是使用一种工具，如 Harness Cloud Cost Management，它可以分析您的历史使用模式数据，并让您知道要为您的工作负载设置哪些请求和限制。

### 风险

如上所述，您希望避免设置太低的限制，这可能会给用户或基础设施的平衡带来问题。如果没有良好的预测，您将倾向于将限制设置得过高，从而无法优化性能，最终会错失提高效率的机会。

### 最有用的时候

通过[资源配额](https://kubernetes.io/docs/concepts/policy/resource-quotas/)设置限制对所有组织都有用。限额是一个很好的方法，可以确保你不会超出自己的支付能力，并且保持在合理的预期之内。但是，注意不要仅仅依靠限额来管理和预测成本。

## 策略二:回归分析

一种更高级的统计方法叫做回归分析。现在，你进入了实际预测成本所需的杂草中，所涉及的变量，以及它们如何相互作用以提供对未来成本的准确预测？

通常，使用回归分析，您最终会得到一个方程，该方程涵盖了影响您成本的大多数用例，并且您能够将值插入到该方程中，这将有助于您预测某个时间点的成本。要做到这一点，你需要深入了解是什么造成了成本，是什么影响了这些因素，如果你不是分析师或统计学家，这是一个不小的壮举。您通常需要召集一个团队来进行这种分析，并创建“即插即用”等式或成本预测的可视化。

这里的关键是回归分析是强大的，但它通常会将您限制在某个时间点——您可以对将要发生的事情做出离散的预测，并做出相应的调整，但您无法持续地回来查看预测是如何变化的。做分析本身需要很长时间，而且因为你有一个手动方程式，所以每次你想预测你的成本时，你都需要回来重新计算。

### 风险

在回归分析中，你总是要承担出错的风险。如果你用错误的方法关联了错误的变量，而你的预测却差得很远，该怎么办？如果你按照这些计划行动，你可能会突然对即将到来的时期预算过高或过低，这两种情况都不理想。预测的目标是描绘一幅未来的准确图景，以便你能为它做好计划。通常，这在至少 80%的准确度范围内，但是越高越好。

您面临的另一个风险是，进行分析是一个时间点练习。通常的做法是委托一个项目，一个团队带着一个数字回来，然后你根据这个数字做计划。但是，如果一些重大事件发生，完全改变了预测，会发生什么呢？你可以做一个最好的、最坏的、一般的案例分析，但是它仍然不能捕捉到事物每天是如何变化的全貌。为了弥补这一点，您可以创建一个运行的电子表格，您可以每天或在任何其他时间参考，但除非您可以吸引需要查看它的人和需要采取行动的人，否则这可能会成为徒劳的努力。

### 最有用的时候

归根结底，当您的主要用例是一次性的未来预测以支持规划时，回归分析是最有用的。最典型的是，我们已经看到当组织处于开始规划未来和提前计划的位置时，他们关心回归分析。这通常是在组织的中端市场到企业阶段，尽管它不排除任何其他可能需要相同功能的人。可以说，所有组织都需要在某个时候使用这种方法。

虽然正确地进行回归分析可能需要大量的前期投资，但它在任何时候都非常有用，因为您可以预测某个时间点的成本，并能够相应地调整预算。当它与有效的可视化和行动机制相结合，根据分析结果工作时，它将是最有效的。

## 策略三:机器学习

把利用机器学习想象成给回归分析注入类固醇。机器学习为您提供了创建令人难以置信的精确回归模型的能力，这些模型可以找到所有的影响因素、影响它们的因素以及它们对最终结果的影响。所有这些都可以在最少的人工干预下持续完成。

想象一下，如果你能看到预测每天是如何变化的，那么你就可以在遇到问题之前调整资金分配。想象一下，如果你可以只通过查看仪表板而不是臃肿的电子表格来做到这一点，这一切都基于你确切的业务环境。这就是用于成本预测的机器学习让你做到的。

然而，实现机器学习成本预测模型并非易事。大型组织有时会投入整个团队来解决问题，至少，你需要一个强大的 ML 工程师来设计、构建和验证系统。有很多好的开源 ML 模型专门用于预测，但是你需要针对成本预测对它们进行调整，并根据你的具体业务环境对它们进行训练。

因为它如此强大，提供了如此多的价值，所以 Harness 包括了开箱即用的基于机器学习的预测。只需连接您的计费数据，让引擎做剩下的工作。您可以将与您相关的资源组合在一起，设置预算，并查看您的预测成本和预算。这使您能够更积极地控制预算，并帮助您更好地为未来周期进行容量规划和预算。

### 风险

这就是你的预测需要有多准确，需要多长时间运行一次，以及它们是否是你的组织需求的核心部分的问题。投资构建基于 ML 的成本预测解决方案是否值得，或者您能否接受另一种预测策略？当然，您可以购买能够做到这一点的解决方案，但是您需要确保它们能够适用于您的业务环境。您还需要考虑能够预测成本的粒度。

除了开发解决方案本身，您将如何使用它？会是纯粹的预测成本，做预算规划，还是可以延伸做其他有持续预测能力的事情？例如，您能否设计出一种方法，在预测显示团队即将超出预算时主动向团队发出警报？考虑一下没有充分利用你在机器学习上的投资的风险，特别是因为投资回报率低的解决方案最终被废弃的情况并不少见。

### 最有用的时候

当您将基于机器学习的成本预测与有效的可视化相结合，并且将行动机制与预测联系在一起时，基于机器学习的成本预测是最有用的。想想看:对于不断吐出投影的东西，最容易直观地看到那些变化；当事情不断变化时，您需要能够调整与原始分析相关的输出。更确切地说，您可能想要一个与您的相关上下文和期望粒度相关联的仪表板；你需要一种方法来做出改变，或者至少提醒决策者有些事情已经改变了，他们需要采取行动。

虽然 ML 解决方案所提供的能力和细节水平似乎只有最大或最复杂的组织才能利用，但 ML 软件的美妙之处在于它可以被任何规模的组织使用——它只是一种以最有洞察力的方式利用大量数据的方法。任何希望以数据为导向并创建准确成本预测的组织都会发现这一策略非常有用。

## 结论

Kubernetes 和云的可预测成本是许多参与云的财务管理部分的人的圣杯。无论是高层次的财务需求，还是工程团队的预算问题，能够知道自己需要花费什么让每个人的生活变得更轻松。就像组织知道数据中心在基础设施上的支出一样，他们也想确定云成本——这可能是难以捉摸的。

这就是我们关于成本可见性、成本节约和成本预测的小策略。我们还有最后一个电子书节选要复习:用 Harness 简化 Kubernetes 成本管理。然而，如果你不想等那个帖子上线，你可以现在就下载完整的电子书- *它是免费的，不需要电子邮件地址！*立即下载 Kubernetes 的[成本管理策略](https://harness.io/learn/ebooks/ebook-cost-management-kubernetes/)电子书。