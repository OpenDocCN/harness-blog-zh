# 什么是混沌工程？简介、定义和更多|线束

> 原文：<https://www.harness.io/blog/chaos-engineering>

了解更多关于混沌工程学科的知识，以及它如何将您的开发周期提升到一个新的水平。

软件和系统开发是创新和解决未知问题的练习。软件和系统是容易出错的，因为它们是由拥有不同观点和技能的人(很可能是多人)制造的。技术变得越来越分散和复杂，特别是随着微服务的推进。很少有人能够完全了解整个系统的端到端知识。

类似于围绕态势感知的军事术语，战争迷雾，在现代发展中理解变化的总体影响可能是困难的(发展迷雾)。再加上用户对系统在任何时候都可用的期望，测试系统的健壮性和对未知的弹性可能就是:一个未知数。

混沌工程通过在整个应用和基础设施堆栈中注入故障来帮助解决未知问题，然后允许工程师验证行为并进行调整，以便用户不会发现故障。再加上[站点可靠性工程](https://harness.io/blog/sre-vs-devops/) (SRE)实践的兴起，混沌工程试图计算这种不大可能发生的影响。

## **混乱的历史**

网站可靠性工程师的一个流行读物是尼古拉斯·塔勒布的[黑天鹅:极不可能事件的影响](https://en.wikipedia.org/wiki/The_Black_Swan:_The_Impact_of_the_Highly_Improbable) (2007)。塔勒布在他的作品中引入了黑天鹅的比喻。塔勒布将黑天鹅事件归类为突发的自然灾害或在出版他的书《谷歌令人震惊和前所未有的成功》时的商业事件。黑天鹅事件有三个特征:不可预测，影响巨大，当它结束时，我们会想出一个解释，让黑天鹅看起来不那么随机。

当处理开发的迷雾时，我们容易陷入分布式计算的谬误，这是由计算机科学家彼得·多伊奇提出的一组关键主张。一些顶级谬论是:网络是可靠的，延迟是零，带宽是无限的，只有一个管理员。将谬误提炼出来，你的服务将会始终如一，并且随时可用。正如我们所知，系统和服务一直在起起落落——但是当进入开发未知事物的细枝末节时，我们很容易忘记这一点。

例如，假设我们正在构建一些依赖于[亚马逊 S3](https://aws.amazon.com/s3/) 进行对象存储的特性。如果我们正在为一个进行复杂处理的服务构建特性，并且最终输出是在 S3 写或更新一个对象，我们作为工程师可能会假设 S3 会在那里。我们上下测试我们的功能，并为 S3 部分提供不太复杂的测试覆盖。亚马逊网络服务在 2017 年发生了自己的黑天鹅事件，当时 [S3 遭遇了停电](https://aws.amazon.com/message/41926/)。我们认为会有的东西(即使性能/写 SLA 降低了)并没有出现，分布式计算的谬误又回来咬我们了。

[S3 停电](https://techcrunch.com/2017/02/28/amazon-aws-s3-outage-is-breaking-things-for-a-lot-of-websites-and-apps/)确实有助于照亮我们确保接触我们堆栈的所有部分，即使我们接触的部分似乎不明显，这可能是由于我们对分布式计算的谬误的看法/迷雾。混沌工程和混沌实验带来了受控的混沌，因此我们可以摆脱这些类型的事件。

## **什么是混沌工程？**

混沌工程是有意将失败注入系统以衡量弹性背后的科学。像任何科学方法一样，混沌工程专注于实验/假设，然后将结果与控制(稳态)进行比较。分布式系统中典型的混沌工程示例是关闭随机服务，以查看项目如何响应以及对用户旅程的损害。

如果你截取一个应用程序需要运行的部分(计算、存储、网络和应用程序基础架构)，将一个故障或动荡的条件注入该堆栈的任何部分都是有效的混沌工程实验。网络饱和或存储突然变得不稳定/饱和是技术行业中已知的故障，但混沌工程允许对这些故障进行更多受控测试，等等。由于可能受到影响的基础设施范围很广，混沌工程的用户和实践者几乎可以是支持应用程序/基础设施堆栈的任何人。

## **谁用混沌工程？**

由于混沌工程涉及的技术和决策范围很广，因此在混沌工程实验中可能有多个利益相关者。爆炸半径越大(测试和实验所影响的)，涉及的利益相关者就越多。

根据应用程序堆栈的领域(计算、网络、存储和应用程序基础架构)以及目标基础架构所处的位置，这些团队的利益相关者可能会参与其中。

如果爆炸半径很小，并且可以在运行的容器中进行测试，那么应用开发团队就可以不用担心冲出容器进行测试。如果工作负载或基础设施具有更大的爆炸半径(例如，测试 Kubernetes 基础设施)，平台工程团队很可能会参与进来。为未知提供覆盖面是运行混沌测试和寻找弱点的核心原因。

## **我们为什么要做混沌测试？**

开发的迷雾是相当真实的，尤其是对于较大的分布式系统、复杂系统和微服务实现。从应用的角度来看，每个单独的微服务都可能被单独测试，并被确定为按设计工作。正常的监控技术可以认为单个服务是健康的。

使用微服务模式，单个请求可以遍历多个服务以获得聚合响应，从而满足用户或其他服务的请求。服务之间的每个远程请求都要穿越额外的基础设施，跨越不同的应用程序边界，所有这些都容易失败。

如果一项普通或非普通的服务或基础设施没有在服务水平协议(SLA)范围内做出响应，系统的功能和用户旅程会受到怎样的影响？这正是混沌工程正在解决的问题。混沌工程实验的结果将被用来创造一个更有弹性的系统。

## **混沌工程原理**

混沌工程的[原则](https://principlesofchaos.org/?lang=ENcontent)是一个极好的宣言，描述了混沌工程的主要目标和原则。混沌工程的原理进一步分解了四种类似于[科学方法](https://en.wikipedia.org/wiki/Scientific_method)的实践。然而，与科学方法不同的是，假设系统是稳定的，然后寻找方差。稳态越难中断，系统就越有信心和稳健性。

### **首先定义基线(稳态)**

了解什么是正常/稳定是检测偏差/回归的关键。根据您测试的内容，有一个好的度量标准，比如响应时间，或者更高层次的目标，比如在一定时间内完成用户旅程的能力，是衡量正常性的好方法。实验中的稳态是对照组。

### **假设稳态将持续**

违背科学方法的初衷，假设一个假设一直是正确的，并没有留下多少余地。混沌工程旨在针对健壮稳定的系统运行，试图发现诸如应用程序故障或基础设施故障之类的故障。对不稳定的系统运行混沌工程不会提供太多的价值，因为那些系统已经不可靠并且不稳定是已知的。

### **引入变量/实验**

像任何科学实验一样，混沌工程将变量引入实验，以观察系统如何响应。这些实验代表了影响应用程序四大支柱(计算、网络、存储和应用程序基础架构)中的一个或多个支柱的真实故障场景。例如，故障可能是硬件故障或网络中断。

### **试着反驳假说**

如果假设是针对稳定状态的，则稳定状态的任何变化或破坏(对照组和实验组之间的差异)都会推翻稳定性假设。现在有了一个需要关注的领域，就可以进行修复或设计变更，以使系统更加健壮和稳定。

在实施混沌工程实验时，实施混沌工程的原则会导致一些设计考虑和最佳实践。

## **混沌工程最佳实践**

在实施混沌工程或任何测试时，有三个支柱。第一是提供足够的覆盖面，第二是确保经常进行实验，并在生产中模仿/运行，第三是最小化爆炸半径。

### **涵盖故障的预计频率/影响**

在软件中，你永远不会达到 100%的测试覆盖率。构建覆盖范围需要时间，并且考虑每一个特定的场景是一个白日梦。覆盖率致力于制造对测试最有影响的东西。在混沌工程中，这将是对具有严重影响的项目的测试，如存储不可用或可能经常发生的项目，如网络饱和或网络故障。

### **在您的管道中连续运行实验**

软件、系统和基础设施确实在变化——而且每一个的状况/健康状况都可能变化得非常快。运行实验的一个好地方是在您的 CI/CD 管道中。CI/CD 管道在进行更改时执行。衡量变革潜在影响的最佳时机莫过于变革开始建立信心之旅的时候。

### **在生产中运行实验**

在生产中进行测试的想法很可怕，生产是用户所处的环境，流量峰值/负载是真实的。为了全面测试生产系统的健壮性/弹性，在生产环境中运行混沌工程实验将提供所需的洞察力。

### **最小化爆炸半径**

因为你不能以科学的名义搞垮生产，限制混沌工程实验的爆炸半径是一种负责任的做法。专注于小实验，它会告诉你你想要识别什么。关注范围和测试。例如，两个特定服务之间的网络延迟。[比赛日](https://www.gremlin.com/community/tutorials/how-to-run-a-gameday/)规划可以帮助计算爆炸半径和关注点。

有了这些最佳实践，混沌工程是一个不同于负载测试的学科。

## **混沌工程和负载测试有什么区别？**

当然，负荷本身会带来混乱。我们通常将我们的系统设计为在多个部分具有弹性(增加额外的计算、网络、持久性和/或应用程序节点来应对负载)。这是假设所有事情都在相同/适当的时间发生，因此我们可以提前完成负载。

在计算机科学世界里，[雷霆万钧](https://en.wikipedia.org/wiki/Thundering_herd_problem)的问题并不新鲜，但是随着我们向更分布式的架构发展，这个问题变得更加普遍。例如，当大量进程被启动，另一个进程成为瓶颈(处理一个且仅一个新进程的能力)时，一个巨大的群体问题可能出现在机器级别。在分布式架构中，一个令人震惊的问题可能是您的消息传递系统能够一次接收大量的消息/事件，但是处理/保存这些消息可能会成为一个瓶颈。如果你被信息淹没，你好，雷鸣般的牛群。

作为一种压力，负载测试当然可以帮助我们为一群人做好准备，但是如果系统的一部分甚至不在那里，或者在游戏中迟到了呢？这就是混沌工程的用武之地。一个非常难测试的项目是没有混沌工程的级联故障。从历史上看，级联故障更像是电网，即一个部分的故障会引发其他部分的故障。在分布式系统领域，这是我们试图找到单点故障，并确保我们的应用程序/基础设施足够健壮来处理故障。

## **混沌工程工具**

围绕混沌工程已经有了很多进步和工具。你可以在[令人敬畏的混沌工程](https://github.com/dastergon/awesome-chaos-engineering)列表中找到很棒的技术资源，我们已经详细介绍了[顶级混沌工程工具](https://harness.io/blog/chaos-engineering-tools/)。这个列表向构建混沌工程的混沌测试工具致敬，并向使混沌工程更容易使用的新平台致敬。

## **治理混沌工程**

Harness 认识到需要让开发人员主动解决计划外停机问题。我们引入了 Harness Chaos Engineering 作为工程和可靠性团队主动提高可靠性的解决方案。Harness Chaos Engineering 使 DevOps 和软件可靠性工程(SRE)团队能够协作并运行 Chaos 测试，以确定其部署中的可靠性问题。我们的混沌工程工具提供的功能使开发人员能够在他们的管道中进行连续的可靠性验证，而不是在不经常发生的手动游戏日测试中进行单一的可靠性快照。

## **试验您的 CI/CD 渠道**

随着在您的系统中建立信心的新方法开始获得关注，您的 CI/CD 渠道是协调建立信心步骤的好地方。混沌工程实验很适合在你的 CI/CD 管道中运行。

可能的艺术是让混沌实验的结果影响部署，或者如果部署到较低的环境，让 Harness 充当实验和其他自动化测试的指挥者。

## **马具来帮忙了**

Harness [软件交付平台](https://harness.io/products/platform/)是一个非常健壮的平台，专门用于编排建立信任的步骤。像在任何实验中一样，混沌工程的支柱是有一个基线。假设你是一个团队的新成员，比如一个 SRE 团队，这个团队覆盖了几十个不是你自己编写的应用程序。第一次运行 chaos 测试需要隔离或启动一个新的应用程序发行版和相关的基础设施，以便在不影响生产的情况下进行试验。

如果您的应用程序不是通过健壮的管道部署的，那么创建另一个隔离的部署可能会像正常部署应用程序的正常起伏一样痛苦。沿着混沌工程的成熟之旅前进，由于混沌测试被视为强制覆盖，按照惯例，将它们集成到用于判断调用或失败策略的[利用工作流](https://docs.harness.io/article/m220i1tnia-workflow-configuration)中是很简单的。

想了解更多关于[混沌工程工具](https://harness.io/blog/chaos-engineering-tools/)？今天就阅读我们的文章吧！