# 什么是持续集成？装具

> 原文：<https://www.harness.io/blog/what-is-continuous-integration>

持续集成是可以由某种事件触发的自动化构建，例如代码签入、合并或定期进行。构建的最终目标是部署到某个地方，而持续集成的主要目标是构建和发布可部署的单元。

不幸的是，计算机不像人类那样理解单词。为了让你的想法(例如:源代码)进入公众的手中，需要进行某种构建或打包。在构建中，源代码被转换/编译成机器可用的格式。通常，编程语言有特定于构建的工具来帮助编译和打包构建。

在本地开发环境中，在为质量保证准备好特性之前，工程师可能会多次生成一个本地构建，它可能是整个可部署单元的子集。然而，软件不是在真空中编写的。最终，单个工程师的工作将需要整合到更大团队的工作中。于是，持续集成的曙光出现了。

持续集成是可以由某种事件触发的自动化构建，例如代码签入、合并或定期进行。构建的最终目标是部署到某个地方，而持续集成的主要目标是构建和发布可部署的单元。除了持续集成之外，还有其他规程，比如持续部署和持续交付，它们关注于将变更安全地投入生产。

## 持续集成、持续部署和持续交付之间的区别是什么？

当谈到你的开发管道时，一个常见的说法是“ [CI/CD 管道](https://harness.io/blog/ci-cd-pipeline/)”。分解 [CI/CD](https://harness.io/blog/what-is-ci-cd/) ，涉及多个学科。持续集成、持续部署和持续交付的“持续”部分将这些术语绑定在一起。持续方面关注的是一旦变化准备好了就做好准备；基本上是随叫随到。

### 连续累计

简单地说，持续集成就是构建自动化。然而，不仅仅是编译的源代码可以进入构建。持续集成的最终产品是一个候选版本。发布候选是要部署的工件的最终形式。可能会采取一些质量步骤来生产工件，比如发现 bug，并确定它们的修复方法。打包、分发和配置都是发布候选的一部分。

例如，一个 JAVA 应用程序有一个 JAR，这个 JAR 然后被打包成一个 Docker 映像，并且拥有该映像运行所需的所有环境配置。工程师使用工具创建 CI 管道，例如 Jenkins、CircleCI、Travis CI、Bamboo、Gitlab CI 和 Harness 等等。您可以在我们的 [DevOps 工具](https://harness.io/learn/developer/devops-tools/)比较页面上找到工具的完整列表。只需通过左侧的 CI 工具进行筛选。

### 持续部署

部署软件的行为是构建/发布候选的分发和安装。在现代分布式应用程序中，应用程序节点永远不会只有一个目的地或实例。出于性能或可用性的原因，服务通常会安装在一个集群中，或者安装到多个目的地。持续部署是选择阻力最小的路径，并尽可能快地部署您的更改，使它们可用。这是伟大的，尤其是在低环境之前，大量的严格适用。

### 连续交货

交付软件可以被视为连续的决策过程。以一种安全的方式将你的想法投入生产，需要以测试和批准的形式进行信心建设练习，以及安全的部署机制，如金丝雀部署。[持续交付](https://harness.io/blog/what-is-continuous-delivery/)是以自动化的方式向用户交付变更的能力。连续交付是跨学科的，围绕监控、验证、变更管理和通知/ChatOps 引入了自动化实践。尽管没有工件来部署，也不会有部署；持续集成提供了要部署的工件。

## 为什么要使用持续集成？

在今天的软件工程组织中，准备好一个或多个工件以继续被审查(例如，从开发到质量保证环境)是谨慎的。软件工程师工作的主要产出本质上是迭代的。在制定可行的发布候选之前，可以创建几个工件。按需构建并开始集成和质量之旅的能力始于一天中可能发生多次的构建。《持续集成》的合著者 Paul Duvall 认为，简而言之，CI 将提高质量，降低风险。

## 持续集成的优势

拥有一个持续的集成方法将团队从手工构建的负担中解放出来，并且使构建更加可重复、一致和可用。让软件工程团队的主要工作产品(可部署单元)准备好被定期部署，对于整个软件交付生命周期是有益的，并且通过避免常见的瓶颈，允许工程师之间的一致协作。

### 可重复性

将构建外部化，而不是被开发人员锁定在本地，可以将更多的注意力放在构建步骤上。持续集成配置开始有更少的个人雪花方法，可以成为更广泛的团队使用的资产。让一个构建由一个系统执行是可重复的，也是向一致性迈进的一步。

### 一致性

持续构建的能力是持续集成的主要支柱之一。在拥有可重复的构建之后，随着持续集成实践在团队中变得更加成熟，效率和一致性开始介入。有了一致性，就有能力让构建更容易获得。

### 有效性

扩展以满足团队所需要的并发构建需求的能力，以及重新创建构建的能力就是构建的可用性。现代的容器化构建比仅仅构建应用程序二进制文件需要更大的马力。分布式构建系统允许这些构建更加可用。由于构建是可重复的和一致的，现代软件开发的核心原则是在过程的任何一步都是可重复的。只需调用过去的配方，就可以获得旧版本和以前的版本。由于强调构建在任何时候都是可用的，支持大量的技术会带来挑战。

## 持续集成的挑战

因为构建和发布候选版本紧跟开发技术的进步，例如新的语言、包装和测试工件的范例，所以扩展持续集成实现中的能力可能是具有挑战性的。当引入集装箱化技术(了解更多关于 Kubernetes containers 的信息)时，建造所需的火力随着速度而增加。

### 扩展持续集成平台

随着构建速度的提高，以符合“每次提交都应该触发一个构建”的口头禅，开发团队可能每个团队成员一天生成几个构建，如果不是更多的话。与传统的应用程序打包相比，生产现代容器化版本所需的火力已经增加了。

由于繁重的计算需求，运行分布式持续集成平台所需的基础设施可能与他们正在构建的应用程序一样复杂。分布式构建运行程序是一个复杂的领域；管理新构建节点何时启动和关闭可能取决于平台/最终用户。

### 跟上技术发展速度

格言“技术中唯一不变的是变化”是对的。随着技术的进步，新的语言、平台和范例将会出现。对于为一小部分技术设计的更严格的/遗留的持续集成平台来说，在异构构建中包含新技术或接受新的测试范例可能很困难。就为平台构建时企业中的内容而设计而言，自主开发/遗留的持续集成平台非常容易僵化。

### 将 CI 平台过度扩展到 CD 中

作为第一批自动化部分开发管道的系统，有一种自然的趋势是继续构建自动化，将软件一直带到生产。尽管组织很快意识到由于单元测试失败而导致的构建失败不同于处理多个部署和发布策略；失败的部署会使系统处于非运行状态。

创建和测试基础设施和应用程序，同时拥有一个安全的发布策略(比如 canary 发布)是非常严格的，这需要将关于应用程序的知识整理成文，以确定通过/失败的场景。添加额外应用程序的负担可能是巨大的，并且可能违背持续集成的最佳实践，例如保持快速构建。

## 持续集成最佳实践

随着持续集成的不断发展，某些实践暗示了一种更成熟的持续集成方法。一个成熟的持续集成实践应该考虑到速度、敏捷性、简单性，并允许以自动化的方式传播结果。

### 保持快速的自动化构建

因为构建会在一天中发生，所以快速和自动化的构建是工程效率的核心。通过将构建外部化，不要为构建占用工程师的机器或本地环境，这可以允许工程师在构建发生时继续大步前进并进行调整。简而言之，构建越快，反馈就能越快地实现，或者越快地创建一个发布候选来被持续交付解决方案部署。

### 每个提交都应该自动构建

对于软件工程师来说，共享存储库的提交或者合并标志着软件开发生命周期的前进。通过提交，你承诺你已经准备好开始尝试你开发的东西了。持续集成的核心是将每次提交视为潜在的发布候选，并开始构建工件。这将缩短做出部署决策的准备时间。

### 小块

在微服务和持续集成中，较小的部分有助于降低复杂性。通过拥有更小的功能独立的部分，比如构建、测试、打包和发布，识别问题/瓶颈变得更加容易。如果任何一个功能领域发生了变化，它们都可以被修改和调整，持续集成平台中的步骤也可以被更新。对于较小的部分，如果某些部分需要在其他系统上运行，找到提升或迁移功能的界限就更容易了。

### 理解 CI 不是 CD

意识到持续集成和持续交付是两个独立的学科，将有助于在设计 CI 管道时避免陷入反模式。保持小块和快速构建的目标，创建多个流，并在 CI 管道中引入部署信心复杂性可能是繁重的工作。您的 CI 流程通常会比您的交付流程运行得更多，尤其是在开发期间，因为在创建一个成功的发布候选之前会发生多个构建。另一方面，[连续交付](https://harness.io/blog/what-is-continuous-delivery/)被设计成一个带有潜在人工批准和决策步骤的工作流，这在 CI 中可能会适得其反。

### 支持异构技术

组织采用持续集成的核心是拥有支持自动化构建的覆盖面，并推进持续集成实践。新的语言、包装和范例在技术中是不变的。包容性并不是持续集成所独有的，但是作为工程效率和 SDLC 的核心部分，采用是至关重要的。

### 结果透明

反馈在软件开发生命周期中至关重要，最有可能的是，变更第一次离开工程师的本地环境是在持续集成过程/实践中。以清晰、简洁和及时的方式在团队中传播构建和测试结果，有助于工程团队调整并迈向成功的发布候选。随着迭代的进行，初始构建应该运行不止一次。根据持续集成平台的不同，实现会有所不同，尤其是在共享结果方面。

## 持续集成是如何实现的？

像大多数工程效率运动一样，持续集成是过程和平台的一部分。当期望实现持续集成时，有一些移动的部分使源代码事件能够作为触发器，并且有适当的基础设施和测试覆盖。

### 源代码管理集成

由提交/合并触发构建需要与源代码管理/版本控制系统进行某种集成。监听 SCM 事件的能力是关键。现代解决方案将这种集成向前推进了一步，将持续集成配置以声明格式存储在 SCM 的源代码项目中，例如 Git。

### 分布式构建基础设施

在本地机器上运行构建是一项资源密集型的工作，可能会在构建过程中耗尽机器的大部分资源。需要某种分布式的弹性基础设施；想象一下，多个工程师/团队同时攻击构建服务器。只有在实际的编译、构建和打包步骤中，才需要资源紧缩。然后基础设施可以为其他东西重新构建。现代解决方案对分布式构建有很好的支持和实现。

### 适当的测试覆盖率

质量练习应该在您的持续集成管道中运行，即使在管道的后面会有用更合适的测试覆盖来使构建过程负担过重的诱惑(例如，当 QA 环境中发生某种部署时，或者冗余测试)。

## 什么是持续集成测试？

[持续集成测试](https://harness.io/blog/continuous-integration-testing/)应该关注工件，而不一定是环境。测试环境，比如负载测试，需要部署，不太适合持续集成。与多次部署相比，测试在开发周期的早期就需要反馈，在自动化构建期间运行测试是谨慎的。

### 代码质量测试

在构建/打包步骤开始之前，要通过的一个谨慎的质量关是代码质量测试。当为构建收集了所有源代码时，在这一步检查源代码是有意义的。寻找常见的设计、安全性和语法改进，代码质量测试通常出现在 CI 管道中。

### 单元/功能测试

与您的本地开发环境相比，代码覆盖率应该在您的持续集成管道中扩展。由于构建可能代表几个工作流，测试单元/功能测试的组合在一起，每个单独的工程师都致力于在 CI 管道中有意义。将本地的基于 IDE 的测试转移到一个持续集成平台上来调用，这是向自动化测试迈出的坚实一步。

### 开源依赖扫描

在构建过程开始之前，所有的依赖项和可传递依赖项可能都不可用。在您的持续集成过程中，扫描构建和打包中的依赖项是一个非常谨慎的时机，因此二进制发行版可以被标记为健康的。例如，扫描 Java JAR 发行版和外壳 Docker 映像在 CI 管道中是有意义的。所有这些，甚至更多，都可以通过 Harness 实现自动化。

## 利用 Harness 自动化构建和测试过程

无论您处于持续集成之旅的哪个阶段，Harness 都会为您提供帮助。作为处理您所有软件交付需求的首要平台，Harness 可以为您的组织提供行业领先的持续集成和持续交付能力。

了解更多关于 Harness [持续集成平台](https://harness.io/products/continuous-integration/)的功能，并从 Harness 的朋友那里了解整个端到端[软件交付平台](https://harness.io/products/platform/)。

要继续您的 CI 学习之路，请随时下载我们在[上的电子书《持续集成现代化](https://harness.io/learn/ebooks/modernizing-continuous-integration-ebook/)。

干杯！

拉维