# 如何改进您的软件交付管道|利用

> 原文：<https://www.harness.io/blog/software-delivery-pipeline>

了解如何利用这些围绕 CI/CD 和特性标志的最佳实践来改进您的软件交付渠道。

管道是一个自动化的过程，它将您的代码经过所有必要的打包、测试、部署和过程，最终到达您的客户手中。当设计和实现得很好时，管道将所有涉及发布软件的手工劳动从开发人员手中拿走，并允许他们专注于编写更多高质量的功能。让我们来看看当涉及到你的软件交付管道时，你可能会面临什么样的挑战，以及你如何能彻底地改进它。

## 软件交付中的主要挑战

我们讨论了“是什么”,但和大多数事情一样,“为什么”更有趣。对软件交付管道的需求是由良好的工程实践和业务需求驱动的。让我们看看大多数从事软件工作的人都熟悉的一些常见情况。

### 速度:业务昨天就需要功能

您的公司即将签署公司历史上最大的一笔交易，为了签署合同，他们承诺在一个非常积极的时间表内提供几个新功能。你运行数学，你知道你的开发团队可以足够快地构建它，但它会非常紧张。如果你的开发人员在辛苦地浪费时间，或者不能足够快地得到有意义的反馈，你已经为自己的失败做好了准备。

### 质量:你不能有一个“坏苹果”

这句经常被引用的话通常忽略了一个坏苹果毁掉一群苹果的部分。在许多行业，如金融、医疗保健等，一个小小的错误可能会带来灾难性的后果。预防问题从 CI ( [持续集成](https://harness.io/blog/what-is-continuous-integration/))管道开始，在那里，您在代码库接触到您的生产环境之前很久就对其进行严格的自动化测试。

### 治理:他们做了什么？

多年来，我曾经访问过一些系统，在这些系统中，我的一个失误会导致所有常见的嫌疑人发表大量文章，讨论一家财富 500 强公司最近的重大停机事件。这种力量是可怕的，但如果你不知道谁拥有它，为什么他们拥有它，以及他们是否应该从一开始就拥有它，那就更可怕了。部署到生产环境在任何地方都是一件大事。不使用 CD ( [连续交付](https://harness.io/blog/what-is-continuous-delivery/))管道，监视谁被允许做什么变成了管理无数服务器和系统的游戏。

### 效率:现金主宰着我周围的一切

浪费不成规模。无论是金钱还是时间(时间就是金钱)，当你的规模逐年翻倍、增加新的服务或更多的员工时，小问题就会成倍扩大。当您有三个服务并且每周部署一次时，花费一个小时手工构建和部署一个服务是可行的。提升到 10 项服务的日常部署…您可以计算一下。

## 改善软件交付管道的技巧

最后一节击中要害了吗？没事的。我们都经历过。第一步是承认你有问题。让我们来讨论一下解决方案，以及如何扩展您的流程。

### 从源头开始

DevOps 不仅仅是工具，它是一种文化，它始于软件开发——远在你建立一个 Jenkins 盒子或构建基础设施之前。版本控制在软件开发中无处不在，但是其用途应该扩展到不仅仅是为应用程序编写源代码。没有自动化测试，构建自动化的价值将会受到限制。回归测试、集成测试和性能测试是编写好软件的一部分，而不仅仅是事后 QA 的责任。

除了测试之外，拥有一个围绕拉请求、代码变更、分支以及发生在构建过程之前的一切的良好过程，将允许您充分认识到软件交付管道的好处。

### 从您的 CD 中了解您的 CI

持续集成、持续交付和[持续部署](https://harness.io/blog/continuous-delivery-vs-continuous-deployment/)是经常被融合成一个整体术语 [CI/CD](https://harness.io/blog/what-is-ci-cd/) 的概念，在这里我们反对整体。你为什么要在乎？首先，竞争情报是一个封闭的过程。组装和测试最终产品的是工厂。在现实世界中，你不得不与易犯错的人、仁慈的人和最终用户打交道。挑战是独特的，每个流程都需要特定的解决方案，而不是使用 CI 工具进行 CD，反之亦然。

一个好的 CI/CD 过程从 CI 开始，CI 运行您的[测试](https://harness.io/blog/continuous-integration-testing/)，运行安全扫描/分析，打包并运送您的工件。虽然界限确实有些模糊，但这是你从 CI 到 CD 的交接点。您已经准备好了您的最终产品，CD pipeline 将接收该交付产品并与之一起运行。

这里最后要注意的是，交付不同于部署。将代码运送到服务器上并设置障碍就是交付，而持续的部署会将新的特性和错误修复快速送到您的最终用户手中。

每个过程的目的都是截然不同的，所以不要犯混搭的错误。相反，将管道设计成模块化的组件，包括重用和互操作性等问题。

### 你可以建造任何东西；打造你的产品

工程师喜欢制造东西，所以把精力集中在制造东西上，让你的客户生活得更好。生态系统中有 20 多种高质量的 CI/CD 工具，从开源工具到白手套 SaaS 平台，这些工具可以优雅地将您的代码从您的 git 库送到您的用户手中。这些选择比以往任何时候都好，而且在大多数情况下，您可以实现完全自动化的管道，只需很少甚至不需要维护脚本。

### 我宣布！

软件交付管道应该关注什么和为什么。“如何”是每个人都要处理的问题。无聊！我们都必须连接到 GitHub，构建我们的 Java 代码，构建我们的 Docker 映像，连接到我们的工件库，等等。这些都是解决了的问题。出于同样的原因，你不会去餐馆把你的食谱和配料交给厨师，你也不会关注管道的运作。

声明性管道描述了你想要什么，交易工具给你那些结果。对于一个相当简单的结果来说，其中的一些任务实现起来非常复杂，而且每个人以前都已经完成过。声明性管道允许您专注于使您的过程灵活、模块化和可重复。

### 持续部署不是单一工具的工作

当涉及到持续交付时，管道是高于一切的编排。编写一个脚本来把东西放到服务器上并点击开始按钮是很容易的。以一种高效的、可重复的、容错的、零停机时间的方式向您的最终用户交付软件是一项极具挑战性的工作。您的 CD 策略的正确方法是将所有同类最佳的工具整合在一起，并在一个流程下将它们结合在一起。

当一个工件从您的开发[环境](https://harness.io/blog/deployment-environments/)转移到您的试运行环境，再转移到生产环境时，会有大量的自动化测试和验证发生，并且这必须被编排和记录。为此，您需要协调安全扫描工具、测试工具和变更管理解决方案，如吉拉来记录这些工作。最后，一旦一个工件准备投入生产，您可能会被要求有批准门，而这通常是一个手工的过程。这就是能够与 ServiceNow 等解决方案结合使用的地方。

您的工件现已投入生产，并开始成功地服务于流量。

完成了吗？

不。差远了。

如果您的新应用程序版本启动，并立即开始向用户抛出错误，或者 CPU 峰值，您最好尽快知道。你最好也有一个退出计划。向客户交付的最后一英里是通过将 APM 和日志工具与您的部署流程结合起来确保质量。如果没有通过这些最终的质量检查，您的管道就不应该被认为是成功的，它应该能够根据需要回滚到一个稳定的版本。

### 考虑特征标志

当您有许多团队在同一个代码库上并行工作时，分支可能很快变成一场噩梦，尤其是当运营和产品管理的优先级被加入进来时。能够将代码放在一个特性标志后面会使管理竞争优先级变得复杂。

一旦发货，功能标志提供了一个强大的工具集来收集反馈，策划个人客户的体验，并通过[切断开关](https://harness.io/blog/kill-switches/)防止断电。

### 不要忘记治理

组织与组织之间，软件交付过程差别很大。你有你的“快速移动和打破东西”，你有公司每年出货一次，并实行完美主义，我们都有一个自 2009 年以来一直在服务器上运行的 Windows 应用程序，每个人都不敢碰它，因为奇迹般地它仍然工作(不要否认)。除了少数例外，所有这些组织都有法规和审计要处理，这就是治理的用武之地。当所有的信息都存在于一个模糊的“某个地方”时，编辑它会是一件非常头疼的事情。

标准化您的工具和您的过程不仅仅是每天的事情，而是能够知道谁部署了，他们如何部署的，以及更多，所有这些都不需要梳理如此多的日志，以至于您的屏幕看起来像是在矩阵中。

### 摘要

和所有事情一样，从你的基础开始。如果您的源代码控制过程被破坏，那么下游的所有东西也会被破坏。用你在软件工程中对待一切事物的同样方法来设计你的管道。应用干巴巴(不要重复自己)的原则。模块化管道，而不是意大利面条管道。不要重新发明轮子。记住，你建造的一切，都必须有人去维护。

## 我们的软件交付方法

在 Harness，我们身体力行。我们的过程被一丝不苟地记录在这个博客上，我们对如何构建和交付我们的软件非常透明。当编写新代码时，一切都从对主分支的拉请求开始，在合并和启动我们的部署流程之前，我们有一个[工作流来构建协作环境](https://harness.io/blog/pull-request-driven-development/)。

当我们[部署我们的软件](https://harness.io/blog/harness-uses-harness-cd/)时，我们正在利用零停机部署策略，例如 [canary 和 blue-green](https://harness.io/blog/blue-green-canary-deployment-strategies/) ，以便我们的最终用户在接收定期功能更新和新产品的同时获得最佳体验。最后，我们使用我们的功能标志解决方案来推出我们想要的新功能，而不期望开发或运营部门负责时间安排和后勤工作。

## 利用线束简化您的软件交付管道

在 Harness，我们提供工具集，并知道如何解决我们今天讨论的所有挑战。我们已经帮助我们的客户[更频繁地部署](https://harness.io/customers/case-studies/increasing-deployment-velocity-7-x/)，[发布更好的代码](https://harness.io/customers/case-studies/remove-outage-risk/)，[控制他们的流程](https://harness.io/customers/case-studies/governance-and-pipeline-management/)，以及[节省时间](https://harness.io/customers/case-studies/metrikus-commit-to-prod-time/)。

我们能帮助您建立渠道并主导软件交付游戏吗？[立即预订您的演示](https://harness.io/demo/)并了解详情！还没准备好？请参考我们的 [CI/CD 购买指南](https://harness.io/learn/ebooks/buyers-guide-for-ci-cd-ebook/)，开始比较供应商。