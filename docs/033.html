<html>
<head>
<title>Your First Harness CI Installation, Build, and Publish | Harness</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>您的第一个线束配置项安装、构建和发布|线束</h1>
<blockquote>原文：<a href="https://www.harness.io/blog/your-first-harness-ci-installation#0001-01-01">https://www.harness.io/blog/your-first-harness-ci-installation#0001-01-01</a></blockquote><div><p>您的驾驭CI之旅从Drone开始，这是一个流行的持续集成平台。了解如何开始第一次构建和推送。</p><div fs-richtext-element="rich-text" class="blog-rtf w-richtext"><p>我们非常兴奋地向世界介绍线束CI。你的驾驭CI之旅从<a href="https://drone.io/">无人机</a>开始，一个流行的<a href="https://harness.io/platform/continuous-integration/" target="_blank">持续集成平台</a>。如果你不熟悉无人机，无人机是一个现代平台，旨在降低进入连接到你的源代码管理[SCM]平台的持续集成空间的门槛。如果你对<a href="https://harness.io/blog/what-is-continuous-integration/" target="_blank">持续集成</a>不熟悉，不要担心，我们会帮助每个人装备并加强他们的持续集成能力。Harness CI / Drone易于启动和运行，从架构上看，只有几个移动部件。</p><h3>利用CI /无人机架构</h3><p>线束CI / Drone有一个<a href="https://docs.drone.io/server/overview/">服务器</a>到<a href="https://docs.drone.io/runner/overview/">跑步者</a>的模型。服务器协调执行任务的运行程序。</p><p>Harness CI / Drone服务器向您的SCM提供者认证，然后通过一个共享的秘密与运行者通信。连接这些部件非常简单。</p><h3>我们开始吧</h3><p>在本例中，移动的部分将是一个GitHub帐户、一个正在运行的CentOS机器、一个Kubernetes集群和一个Docker Hub帐户。示例GitHub存储库可以在此示例之前在<a href="https://github.com/ravilach/firstdrone">https://github.com/ravilach/firstdrone</a>被克隆/分叉。</p><h3>GitHub / SCM准备</h3><p>Harness CI / Drone服务器需要通过SCM提供商的认证。这是在<a href="https://docs.drone.io/server/provider/github/"> GitHub </a>中通过制作OAuth应用程序来完成的。这是通过导航到设置- &gt;开发者设置- &gt; OAuth应用程序+注册一个新的应用程序来完成的。</p><p>当您注册一个新的OAuth应用程序时，您需要准备好无人机服务器的DNS/IP地址。对我来说，这是34.207.222.178。回调URL在主页URL后附加了/login。</p><p>当您注册应用程序时，请务必记下客户端ID和客户端密码，这是连接Harness CI / Drone服务器所需要的。</p><h3>CentOS/harnesci/无人机准备</h3><p>根据你从哪里获得CentOS，你可能需要安装<a href="https://docs.docker.com/engine/install/centos/"> Docker引擎</a>。假设您已经安装了Docker引擎，那么在安装之前，您在服务器上需要做的唯一准备工作就是生成共享密钥，该密钥将用于服务器到运行程序的通信。确保复制共享机密[RPC机密]。</p><p><em> openssl rand -hex 16 </em></p><h3>线束CI /无人机安装。</h3><p>要在您的机器上获得Harness CI / Drone，只需在图像上运行Docker Pull。</p><p><em> sudo docker拉无人机/无人机:1 </em></p><p>一旦拉动，您可以<a href="https://docs.drone.io/server/provider/github/#configuration">配置Docker运行的属性</a>。准系统需要填写的属性是机密、服务器地址和协议。让我们继续创建一个管理员用户。admin用户使用您的GitHub用户名。</p><p>sudo dock run \<br/>卷=/var/lib/drone:/data \<br/>-env = drone _ github _ client _ id = your client id \<br/>-env = drone _ github _ client _ secret = your pcsecret \<br/>-env = drone _ server _ host = your stop domain \<br/>-env = drone _ server _ proto = http \<br/></p><h3>无人机UI</h3><p>发出带有属性的Docker Run命令，您可以进入Harness CI / Drone服务器的IP或DNS条目。在我的情况下，导航到https://34.207.222.178。你将被提示通过GitHub授权你的用户。</p><p>授权您的GitHub凭证。</p><p>一旦获得授权，Harness CI / Drone将构建一个存储库列表。</p><p>现在您已经准备好部署跑步者了，在本例中是Kubernetes。</p><h3>Kubernetes集群准备</h3><p>在这个例子中，我们将利用Kubernetes跑步者。为了让Kubernetes Runners代表您请求资源，除了Runner部署之外，还需要角色绑定。</p><p>一个简单的方法是构建两个YAML文件，一个用于角色和角色绑定，另一个用于部署。</p><p><em> kube CTL申请-f无人机_ role。YAML〔t1〕</em></p><p>在Runner部署规范中，确保更新Drone服务器、共享机密和协议以匹配您的安装。</p><p>当项目填写好后，就可以部署部署了。</p><p><em> ku bectl apply-f无人机_部署。YAML </em></p><p>您可以选择验证跑步者是否连接到服务器。获取Pod名称，然后运行日志命令。</p><p><em> ku bectl获取pods-all-namespaces </em></p><p><em>kube CTL logs drone-6564 db 8 f9f-949 S2-c runner</em></p><p>成功！现在是时候开始迈向你的第一个建筑了。</p><h3>将CI和SCM结合在一起</h3><p>线束CI / Drone利用<a href="https://docs.drone.io/pipeline/overview/">配置作为代码</a>来描述管道。Harness CI / Drone可以处理来自源代码管理解决方案的webhook请求，以便在需要启动新构建时进行编排。</p><h4>准备存储库</h4><p>可以利用Harness CI / Drone UI来“激活”存储库。在我的“第一无人机”仓库中，网络挂钩是空的。</p><p>在Harness CI / Drone UI中，导航到您选择的存储库，然后导航到活动存储库。</p><p>例如，默认情况下可以激活存储库。如果需要，要修改的配置是要监控的无人机配置文件的名称。在本例中，您将监视存储库中的“Drone.yaml”。</p><p>然后，您可以验证已经在GitHub中成功创建了webhook。</p><p>CI和SCM连线已经完成，接下来的步骤是定义您的第一个管道并开始构建。</p><h3>您的第一个线束CI /无人机项目</h3><p>如果从一个空的存储库开始，你可以利用一个简单的<a href="https://github.com/ravilach/firstdrone">项目结构</a>的例子，或者连接你自己的项目/存储库。</p><p>如果按照这个例子，您连接到Harness CI / Drone来监视“Drone.yaml”。声明性管道格式很容易连接到所需的步骤中，并且不需要担心插件。在示例管道中，我们利用Docker插件进行发布设置，并在执行期间自动下载。</p><p>突出显示的行利用秘密来连接我的Docker Hub凭据。您需要将回购位置更新为您自己的位置，并创建线束配置项/无人机机密来连接。</p><p>回到Harness CI / Drone UI，导航到存储库设置，并添加所需的秘密。</p><p>添加适当的机密以匹配示例的格式。</p><p>有了这些连接，您现在就可以开始您的第一个构建并将其发布到Docker Hub了。</p><h3>您的首次构建和发布</h3><p>布线完成后，剩下的就是提交Drone.yaml进行一些更改，然后就可以开始比赛了。</p><p>一旦点击了Commit changes，CI魔术就开始了，您的构建和发布就结束了！</p><p>成功！祝贺您的第一个线束CI /无人机构建和发布！</p><p>在Docker Hub上验证成功。</p><h3>马具和无人机，一起更好</h3><p>我们很高兴能进一步推动线束CI /无人机社区的发展。如果你想与无人机社区交流，请随时跳上<a href="https://gitter.im/drone/drone">无人机Gitter </a>向所有优秀的人学习。我们有很多很好的计划来提高CI和CD的能力，使它们变得简单和大众化。我们将发布更多更新，敬请关注。欢迎加入线束家族，无人机！</p></div></div>    
</body>
</html>