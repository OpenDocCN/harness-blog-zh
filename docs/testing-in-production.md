# 生产信息和指南中的测试|线束

> 原文：<https://www.harness.io/blog/testing-in-production>

生产中的测试曾经是一个笑话。现在已经不那么好笑了，因为最好学习的测试是那些最符合现实的测试。

大约十年前，“生产中的测试”在软件工程师中是一个常见的笑话。这是一种描述你绝对不会做的事情的简写方式...直到最后，一些工具开始鼓励你这样做。你可以在谷歌上搜索生产测试，你会很快找到“生产测试”迷因。

简而言之，生产中的测试意味着使用实时数据和实时用户来解决问题。它可以是与性能相关的，与用户行为相关的，或者任何你想看到的，从中学习的，以及基于你的应用服务于实时用户时所发生的事情而做出反应的。

[*Source*](https://twitter.com/mipsytipsy/status/1034904230916763654?lang=da)

## 测试应该在生产中进行吗？

玩笑归玩笑，生产中的测试是你绝对应该考虑的事情。考虑一下:尽管做了各种各样的生产前测试，但是您经常会发现在任何测试环境或试运行环境中都没有发现的问题——测试数据并不完美。在没有生产数据的情况下，性能测试和负载测试只能帮到你。集成测试、单元测试、回归测试以及您运行的任何其他软件测试经常会遗漏一些情况，直到真实的生产数据和生产流量通过系统运行时才被意识到。您正在运行测试，但是没有运行真正的测试——这造成了返工并减缓了未来特性发布的速度。

*Testing goes deep into lots of factors - some can’t be tested in pre-production.* [*Source.*](https://edwardmuldrew.medium.com/my-first-experience-with-software-testing-6ddb86e12dd4)

编写测试，良好的质量保证，让项目经理和其他人在部署前评审变更——这些都有助于把事情做好。但是，有些事情很难用模拟数据或不同规模的数据来尝试和学习，例如:

*   你的真实负载对你最近的变化做了什么？
*   用户做了哪些与预期不同的事情？
*   你看到了你希望看到的业绩变化吗？
*   用户的反应是否如你所愿？
*   在各种压力情况下，你的变化会有什么反应？

你可以试着在去 prod 的路上了解一些，但是回答这些问题的最有效的方法，无论是技术上的还是用户上的，都是用实际的用户和实际的流量来做事情；你需要真实的生产数据和真实的生产流量才能尽可能的有效。

## 什么不是生产中的测试？

在我们深入生产测试之前，让我们先弄清楚生产测试不是什么。当我们考虑什么存在于生产环境中以及不良生产测试实践的影响时，澄清这一点尤其重要。

生产中的测试不是不断地进行部署和回滚。而且，它不是对你发布的内容漫不经心。当在生产中进行测试时，您没有使用您的实时生产数据来确保事情正常运行。这仍然是软件测试和 QA 在测试环境、阶段环境和任何其他在生产环境之前测试代码的地方的目的。

在您的*实际*生产环境中，生产测试就是学习、迭代，并在代码已经通过标准部署过程之后，用尽可能最好、最准确的数据帮助您做出决策。通过为生产流量和真实用户提供服务，您可以收集用户数据，测试软件变化，并获得监控信号，您可以使用这些信号来了解您所交付的是否是您试图实现的。

## 为什么在生产中使用特性标志进行测试

[*Source*](https://thenewstack.io/serverless-testing-in-production/)

[特征标志](https://harness.io/products/feature-flags/)对生产中的有效测试至关重要。我们这样说是因为特性标志允许您根据任何标准立即打开和关闭东西，而不需要复杂的回滚或重新部署。为了确保我们击败死马，是的，这都是在生产环境中。让我们来看看生产系统中特性标志支持哪些必需的功能，这些功能使它们变得如此重要:

*   Kill switch 功能:无需回滚或重新部署即可立即打开和关闭。
*   用户细分:确切地决定谁可以访问特性，允许您运行特定的生产测试或获取特定的生产数据。
*   流量细分:选择将哪些生产流量导向特定的体验或变更，从而允许您进行负载测试和性能测试。
*   渐进式交付:用一小组生产数据(用户、流量等)进行测试。)并将变更逐步推广到更大的群组，直到您的生产环境中的 100%的用户都收到变更。

如果你不熟悉功能标志，我们有一个关于如何开始使用功能标志的很棒的博客，以及另一个关于你可能没有想到的 [5 个功能标志用例的博客](https://harness.io/blog/feature-flag-use-cases/)。

如果没有特性标志，您将被限制在[蓝绿色部署、金丝雀](https://harness.io/blog/blue-green-canary-deployment-strategies/)以及其他非常有价值但速度较慢(也更贵！)生产测试的形式。特性标志将生产测试的成本降低到几乎为零。它们使生产中的测试变得简单且易于协调。

下面是您可能想要运行的生产测试的一些示例。*通常，这些测试与有形的业务成果相关，如客户满意度或收益:*

*   在这一客户问题的三种可能解决方案中，哪一种最适合客户？
*   我有两种方法来实现这个算法。在测试环境中，它们几乎是一样的，但是当大量数据通过我的一百万用户进入时，哪一个性能更好呢？
*   我希望通过对来自用户的真实数据进行测试，来验证这种新的 UX 是否会像我预期的那样影响用户留存率和应用停留时间。
*   我希望这个简化的购买过程能够减少我的电子商务页面上废弃的购物车数量。我想对两组用户进行测试。
*   我正在推出一组新的长期运营标志，我们可以在生产系统的定期维护或停机期间翻转这些标志。针对我的整个用户群，它的行为方式是否符合我的预期？

*Feature flags greatly speed up and add valuable data to the testing cycle.*

## 如何避免生产中的测试风险

根据定义，生产中的测试可以——也应该——覆盖很多领域。您可以测试负载、行为、弹性等等。因此，没有放之四海而皆准的答案。这完全取决于你想做什么。

生产中的测试，当通过使用特性标志正确地完成时，本质上已经是一种降低风险的方法。在生产环境中对实时数据进行测试的概念很可怕，而使用特性标志是最有效的风险缓解策略！如果你实施了一个好的特征标记解决方案，那么你的风险因素就不再是技术及其能力或限制，而是组织过程。

当第一次在生产中考虑特性标志和测试时，有一些事情要记住，这将帮助您降低长期风险:

*   功能标志为您提供了其他方式所没有的选项。不要想“我在做什么可以使用特性标志？”你可以想“我正在做一个改变，让我把它放在一面旗子后面*，以防万一。*“有选择权总是好的，成本接近于零。
*   事先同意你想学什么，你在测试中的目标是什么。谁负责测试，你将如何从中学习？
*   在开始测试之前确定:谁是产品受众，测试何时终止，以及根据结果做什么。

## 在生产中使用线束特征标志进行测试

[利用特性标志](https://harness.io/products/feature-flags/)是一个完整的特性标志管理工具，允许用户通过代码和 UI 创建和管理标志。Harness 使用灵活的目标模型，允许您以任何方式应用您的标志——针对用户、地区、集群、特定计费级别的帐户或您能想到的任何其他对象。利用这一点，可以同时从多种角度进行测试。

除了装配测试的能力之外，还有一个自动化层也可以被插装。如果您在生产中运行标准化的测试，或者您确切地知道当特定行为发生时您希望发生什么，这将特别有帮助。例如，你可以运行一个新 UX 的三个不同版本，根据哪个版本使用户在应用上停留的时间最长，你想自动将该功能推广到整个用户群，并删除另外两个。交付、验证和基于触发器的部署都可以使用 Harness 自动化。

## 结论

随着现代连续交付和特性标志的传播，生产中的测试已经从软件工程师的玩笑变成了现实。

功能标志特别有助于提高速度、有价值的反馈和响应能力，同时降低风险和成本。这一点非常重要，因为最好的测试是那些最符合现实的测试。而且，现实意味着生产。

虽然一开始很难使用特性标志进行生产测试，但是我们可以从一些问题开始。随着您的团队变得更加舒适，迭代和扩展就变得轻而易举了。

你读过我们关于特征标志的电子书吗？这是免费的，不需要电子邮件地址！如果你想了解更多，这是一个很好的资源。今天就下载[基础:功能标志 101](https://harness.io/learn/ebooks/ebook-feature-flags-101/) ！我们也很乐意向您推荐我们关于[最佳功能标志工具](https://harness.io/blog/feature-flags/feature-flag-management-tools/)的文章，这样您就可以找到适合自己的解决方案。