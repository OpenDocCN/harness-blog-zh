# 测试智力:动作要快，不要弄坏东西|马具

> 原文：<https://www.harness.io/blog/test-intelligence>

测试智能是我们 CI 模块中的一项功能，它在运行时选择需要运行的测试。不是运行所有的测试，这可能需要几个小时，系统选择测试的一个子集并跳过其余的。

本文由尤里·席耐尔和希瓦库玛·宁格帕合作撰写。

在当前的时代，每个人都想快速行动——尤其是开发人员。关于开发人员的效率以及如何帮助他们更快地前进，已经有了多项研究，最常见的结论是测试是软件交付过程的最大瓶颈，因为开发人员从不在质量上妥协。他们希望确保被合并的新代码按预期工作，而已经工作的旧代码仍然工作。

意识到以上情况后，我们问自己以下问题:我们如何解决这个问题？我们怎样才能帮助开发人员在不影响测试质量和覆盖率的情况下快速前进呢？

解决办法是测试智力。测试智能是我们 CI 模块中的一项功能，它在运行时选择需要运行的测试。不是运行所有的测试，这可能需要几个小时，系统选择测试的一个子集并跳过其余的。它还提供了选择测试及其原因的可见性。这不需要对源代码、构建或测试过程进行任何更改，因为我们可以动态地检测字节码。

## 测试智力:我们如何做？

最初，我们决定关注单元测试。尽管其他类型的测试(功能、API、UI 测试等。)可能更耗时，因此节省更多，不是所有的开发团队都采用连续测试(将测试作为 CI/CD 管道的一部分运行)。但是因为每个人都运行单元测试，所以我们从单元测试开始。稍后将支持其他类型的测试。

我们围绕一个叫做“测试图”的模型来构建我们的解决方案这是一个在类方法和覆盖它们的测试方法之间建立关联的模型。通过使用智能检测，我们确保模型总是最新的，并且当开发人员将代码合并到主分支时，我们总是同步模型。

当开发人员打开一个拉请求并运行单元测试时，我们使用测试图来理解基于以下度量应该执行哪些测试:

变更的代码:通过查询 git，我们确切地知道在特定的构建中哪些代码发生了变更，并且我们使用这些数据来选择所有与这些变更相关(直接或间接)的测试。这些测试成为所选测试子集的一部分。假设更改是频繁的和递增的，测试列表不应该太长，因为它跳过了不需要的测试，因为代码中没有进行任何更改。

*   变更的测试:我们使用的另一个度量标准是特定的测试是否已经变更。当在测试中识别出这样的变更时，即使覆盖测试的代码没有变更，也会被挑选出来。这样做是为了确保代码按预期运行。
*   新测试:一旦我们确定了一个新的测试，我们会自动选择它。它有助于我们确保它成功运行，并有助于发现测试和新/现有代码之间的相关性。这也使我们的测试图保持最新。

在每个测试周期之后，用户可以完全了解选择了哪些测试以及选择的原因(基于上面的指标)，并且可以看到应用程序的测试图。

## 很酷的故事！但这真的有用吗？

为了确保这种方法有效，我们在我们最大的后端仓库之一“门户”上测试了它。

在我们使用测试智能之前，我们的单元测试周期相当长。我们在每个 PR 上运行了大约 16，300 个测试，通常需要大约 5 个小时才能完成。我们能够并行运行测试(一次 5 个任务)，这有助于我们将测试时间减少到大约 60 分钟。很大的改进，但仍然-相当长的时间来等待你的公关合并，对不对？

在使用测试智能后，我们看到了甚至我们都没有预料到的惊人改进。上图显示了使用测试智能的平均周期时间*和使用测试智能的周期时间*之间的时间节省(在评估阶段，我们执行每个 PR 构建两次——使用和不使用测试智能，以进行基准测试)。使用测试智能，我们能够获得 20-60%的节省，这是开发人员的时间！**

值得注意的是，目前我们采取的是非常保守的方法。每当我们不确定 PR 中的变化时，我们就运行所有的测试。我们正在不断改进我们的选择模式，这将有助于增加储蓄。

在 Harness CI UI 中，这是测试智能显示内容的一个示例。在右边，您可以看到基于前面提到的指标的测试选择的分解:

Harness 还提供了测试图的完整可视化，因此用户可以看到为什么选择了一个特定的测试。

通过点击一个特定的测试(紫色的节点)，用户可以看到这个测试覆盖的所有类和方法，这些类和方法在这个构建中被改变了(蓝色的节点)，这导致了那个测试的选择:

## 但是等等，还有呢！

为了进一步测试测试智能的成功，我们希望看到公共开源项目带来的节约。我们能够为这些项目的每个公关周期节省大量成本，这进一步验证了我们的方法。以下是我们发现的结果:

Cost savings of Harness Continuous Integration Test Intelligence with common open-source projects

## 下一步是什么

我们目前正致力于扩展 Test Intelligence 支持的语言，在这篇博文中，它只支持 Java。此外，我们正在设计和研究许多东西——测试排序(减少第一次失败的时间),片状测试检测和缓解，支持本地构建，等等！我们很想听听您对测试和 CI/CD 瓶颈的看法。请随时发送电子邮件给我们，我们可以进一步讨论。

如果您有兴趣尝试测试智能，它可以作为我们 CI 企业免费试用的一部分- [注册](https://harness.io/platform/continuous-integration/)并尝试一下！