<html>
<head>
<title>Verifying CI/CD Pipelines with Prometheus | Harness</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用 Prometheus | Harness 验证 CI/CD 管道</h1>
<blockquote>原文：<a href="https://www.harness.io/blog/verifying-ci-cd-pipelines-prometheus#0001-01-01">https://www.harness.io/blog/verifying-ci-cd-pipelines-prometheus#0001-01-01</a></blockquote><div><p>线束集成现在允许客户使用 Prometheus 数据自动验证部署管道。</p><div fs-richtext-element="rich-text" class="blog-rtf w-richtext"><p>过去一年中，客户要求最多的监控集成是:AppDynamics、New Relic、Dynatrace 和 Datadog。第五个最受欢迎的是开源软件项目普罗米修斯。</p><p>与应用程序性能监控(APM)软件不同，该软件针对不同的应用程序堆栈有自己的本地运行时代理，Prometheus 是一种非常“自制”的监控方法。</p><p>使用 Prometheus，您可以编写自己的工具，创建自己的指标，并在自己的定制时间序列数据库中管理所有这些。一切皆有可能。</p><h2>为什么要自动化 Canary 部署和部署运行状况检查？</h2><p>如果您对<a href="https://harness.io/products/continuous-delivery/" target="_blank">连续交付</a>很认真，您会希望您的部署管道在 30 分钟内执行并完成。</p><p>为什么？实际上有几个原因:</p><ul role="list"><li>部署工作/时间严重限制了部署频率</li><li>如果您的部署需要几个小时才能完成，则不能按小时部署</li><li>快速失败总比缓慢失败好，记住部署是实验。</li><li>您花在部署上的时间越多，花在开发上的时间就越少</li></ul><p>举个例子，我们的早期客户之一，<a href="https://www.build.com" target="_blank">Build.com</a>，过去每周部署 3 次生产。每次部署后，5-6 名团队领导将登录到 New Relic 和 Sumo Logic，并手动验证 60 分钟，确保一切正常。这相当于每个部署仅花费 5-6 个工程小时进行验证。借助 Harness，Build.com 自动化验证，每次部署只需一名工程师和 15 分钟。</p><h2>机器学习在普罗米修斯监测数据中的应用</h2><p>Harness 帮助客户在几分钟内构建部署管道。它还通过将机器学习与现有的监控工具(在本例中为 Prometheus)相结合，帮助客户自动验证部署。</p><p>一旦 Harness 在目标环境中部署了新的应用程序或服务，它将立即连接到 Prometheus 服务器，并建立一个它正在观察的模型。然后，它会将该模型与以前的部署模型进行比较，以便识别新的异常或倒退，如果需要，会自动回滚到以前的工作版本。在 Harness，我们称之为<a href="https://harness.io/platform/continuous-delivery/continuous-verification/" target="_blank">连续验证</a>。</p><h2>为持续验证设置 Prometheus</h2><p>您需要做的第一件事是<strong>设置&gt;连接器&gt;添加新的验证提供者</strong>:</p><figure class="w-richtext-figure-type- "/><p><br/> <br/>接下来，从下拉菜单中选择<strong>普罗米修斯</strong>，输入你的普罗米修斯服务器 URL，以及一个显示名称:</p><figure class="w-richtext-figure-type- "/><h2>将普罗米修斯验证添加到您的部署工作流程中</h2><p>在 Harness 中创建或打开一个已有的部署工作流，点击<strong>添加验证</strong>，选择<strong>普罗米修斯</strong> : <br/></p><figure class="w-richtext-figure-type- "/><p><br/>验证可以应用于任何类型的部署工作流，例如金丝雀、蓝绿色、滚动等等。</p><h2>定义您的指标</h2><p>由于 Prometheus 是一个定制的时间序列指标数据库，您需要多花一点时间来声明您希望在部署验证中监控哪些指标。这与 APM 监控工具有些不同，在 APM 监控工具中，指标是预定义的，可以在 Harness 中自动配置。</p><p>一个指标需要 4 个参数:</p><ul role="list"><li>事务名称-与指标相关的服务或请求上下文。例如登录</li><li>指标名称——在 Prometheus 中定义的指标的实际名称</li><li>度量类型-度量的类型(响应时间、错误、吞吐量和值)</li><li>URL -检索度量值所需的 API 查询(必须包括开始时间、结束时间和主机名的占位符)。</li></ul><figure class="w-richtext-figure-type- "/><p><br/>定义所有指标后，您可以选择是否需要以前的分析或金丝雀分析来建立基线。您还可以指定验证的持续时间(默认为 15 分钟)。</p><h2>让普罗米修斯验证你的部署</h2><p>通过集成和配置 Prometheus，您现在可以自动验证您的所有部署。</p><p>以下面的例子为例，它展示了一个已被 Jenkins 和 Prometheus 成功验证的典型部署。</p><p>您可以在右侧看到，所有普罗米修斯指标都已经通过了 Harness 机器学习算法的验证。绿色表示未发现异常或倒退，部署在其正常范围内运行。</p><figure class="w-richtext-figure-type- "/><p><br/> <br/>报名参加<a href="https://app.harness.io/auth/#/signup" target="_blank">免费试用</a>，今天就可以开始使用 Harness 和 Prometheus。</p><p>干杯，<br/>史蒂夫。<br/>@伯顿说</p></div></div>    
</body>
</html>