# 扼杀者模式:如何在容器革命期间处理遗留代码

> 原文：<https://www.harness.io/blog/strangler-pattern-legacy-code-container>

如何使用扼杀者模式处理遗留代码？

当我们说“技术债务”时，你首先想到的是什么？是不是过时的系统中的代码积累导致了几十年来几十甚至几百个开发人员的改变？它是一个遵循复杂逻辑的糟糕方法和难以遵循的生产问题补丁的代码库吗？其实两者都有。

无论是庞大的企业还是目光炯炯的人工智能-机器学习-区块链初创公司，每个公司都必然会积累技术债务。总会有我们能够(并且可能应该)做的任务来提高软件质量。任何时候我们选择不做它们，无论是为了节省时间或金钱，还是因为我们必须部署某些东西，我们都会增加我们的技术债务。

不知不觉中，你可能会发现自己正准备将一个庞大、复杂的整体应用程序过渡到微服务，并意识到你不知道从哪里开始，而且公司里没有人知道软件的基础代码是如何工作的。

这时候扼杀者模式可能会派上用场。

## 什么是扼杀者模式？

2004 年去澳大利亚旅行时，马丁·福勒目睹了一棵奇特的树，并对如何更新过时的应用程序有了新的认识。

“这个地区(澳大利亚)的自然奇观之一是巨大的扼杀者藤蔓。它们在无花果树的上部枝条中播种，然后逐渐向下生长，直到扎根于土壤中。许多年后，它们会长成奇异而美丽的形状，同时勒死并杀死作为它们宿主的树。”

类似于新鲜的和新的藤蔓代替树的原始基部的方式，新的代码被写在过时系统的边缘，以这样的方式旧的系统最终被“扼杀”并被新的系统取代。

遗留代码更难维护，是时候了解我们如何才能从以前的自己给我们挖的坑里挖出来了。替换不正常工作的代码是一项困难的、有时甚至是危险的任务，它可能会导致应用程序的行为发生变化，甚至更糟，完全崩溃。我们需要用新的来代替旧的，但是我们需要用聪明的方法来做。

好消息是，这是可能的，通过一个渐进的过程，我们重写旧代码，并行运行新代码，测试环境并确保一切正常工作。

## 微服务来拯救？

通过微服务，应用程序的不同部分被分离和封装，每个部分都有自己的逻辑、数据、结构等，并执行指定的功能。

这个“时髦词”已经存在一段时间了，公司正在采用和适应随之而来的新元素。这并不奇怪，考虑到它给我们的工作流带来了很多好处，并构建了包括缩短开发时间和增加灵活性在内的方法。

与整体架构不同，微服务使我们更容易理解、开发和测试主要产品的单个元素，并有助于使每个部分对架构侵蚀更具弹性。

微服务允许我们重新设计和重写代码库中的关键元素，与当前使用的旧方法和代码并行。反过来，更容易控制从旧到新的逐步过渡，确保应用程序仍按预期启动和运行。

微服务给我们的工作流程带来了一些重要的好处。第一，它防止我们的整体结构变得更加难以管理。第二个好处是，它帮助开发和运营团队更快地推进应用程序或产品中的某些元素，而不依赖于其他团队或领域来完成或部署他们的更改。

微服务还可以改进构建-测试-部署-监控周期。它们允许团队更快地完成应用程序中各个元素的循环，而不必等待测试或部署其他功能。可以迭代的更快。

然而，在微服务架构中并不都是阳光和彩虹，当切换到这种方法时会有一些负面影响。当转向微服务架构时，我们需要记住的最重要的元素之一是:**分布式系统带来了分布式…一切**

在过渡到微服务期间和之后，我们可能会面临很多问题。最大的挑战之一是监控。我们现在有了一个依赖于“容器化”服务的完整应用程序。每个服务都可以使用自己的语言和技术，运行在不同的机器上，或者有不同的版本控制，当问题出现时，由我们的团队来监控和识别。

幸运的是，APMs 仍然会告诉我们性能下降的时间和位置，日志仍然会告诉我们我们预见到的问题。除此之外的一切都变得更加复杂。我们不仅需要了解这个问题发生在哪个机器、容器或服务器上，还需要能够了解代码到达那里的路径以及其他服务可能是如何涉及的。

虽然这听起来像是对微服务的抨击，但这并不意味着我们不应该采取行动。这只是意味着我们需要意识到这些挑战，并且在为我们的环境设置监控时，我们需要考虑我们将需要的新功能。

## 最后的想法

行业向微服务的转移正在进行中，但是拥有大量技术债务或大量遗留代码库的团队可能会发现自己不确定从哪里或如何开始。采用 Strangler 模式作为设计框架可以在产品化期间提供帮助，并且随着软件的发展和进步，继续帮助保持应用程序的正常运行和优化。

无论您是在处理遗留代码，还是开始“扼杀”旧系统的过程，或者运行新的容器化应用程序，您都需要了解系统的质量和可靠性。当出现问题时，您需要理解系统是通过什么途径到达那里的，以及为什么。