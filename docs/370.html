<html>
<head>
<title>Find and Fix Vulnerabilities in Your Pipeline With Snyk and Harness | Harness</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用Snyk和Harness | Harness查找并修复管道中的漏洞</h1>
<blockquote>原文：<a href="https://www.harness.io/blog/snyk-harness-vulnerabilities#0001-01-01">https://www.harness.io/blog/snyk-harness-vulnerabilities#0001-01-01</a></blockquote><div><p>创建您的Snyk和线束帐户并开始！跟随我们的逐步教程。</p><div fs-richtext-element="rich-text" class="blog-rtf w-richtext"><p>当DevOps在10多年前出现时，主要焦点是弥合开发和运营团队之间的差距。这是通过在设计、构建、测试和部署应用程序的过程中引入自动化来实现的。</p><p>随着开发团队继续更快更频繁地交付产品，安全团队发现很难跟上。通常，它们会成为交付渠道中的瓶颈。由于这个原因，在DevOps过程中尽早引入安全性并接受DevSecOps文化变得越来越重要。</p><p>将Snyk以开发人员为中心的安全平台集成到Harness的统一交付管道工作流中，确保安全性和合规性测试是每个版本的一部分。这允许您防止具有易受攻击的依赖项和代码的应用程序进入生产环境。使用像Snyk和Harness这样的现代工具，您可以通过CI/CD管道找到、修复和补救，并减轻业务风险，而不会影响您快速发布软件的能力。</p><h2>Snyk入门</h2><p>Snyk是一个开发者安全平台，它使团队能够轻松地发现、优先处理和修复代码、依赖项、容器和作为代码的<a href="https://harness.io/blog/infrastructure-as-code/" target="_blank">基础设施中的安全漏洞。它直接集成到开发工具、工作流和自动化管道中。</a></p><p>在业界领先的应用程序和安全智能的支持下，Snyk将安全专业知识放入任何开发人员的工具包中。</p><p>开始使用Snyk非常简单，只需访问<a href="http://snyk.io/signup" target="_blank"> snyk.io </a>并注册一个免费帐户。</p><h2>线束入门</h2><p>Harness是业界第一个使用AI来简化您的DevOps流程的软件交付平台——CI、CD、功能标志、云成本管理等等。</p><p>Harness使您能够使用可重用的模板在几分钟内构建复杂的部署，从而节省时间和压力。使用Harness，您可以在几分钟内建立管道。</p><p>开始使用Harness非常简单，只需前往<a href="https://app.harness.io/auth/#/signup" target="_blank"> harness.io </a>并设置一个免费试用帐户。</p><h2>防止漏洞通过构建和部署过程</h2><p>演示Snyk和Harness组合功能的最佳方式是通过一个演练，欢迎您自己设置和运行。在本例中，我们使用Snyk来演示如何通过将自动化Snyk测试添加到线束工作流中来防止漏洞通过构建和部署过程。</p><p>我们使用下面的GitHub库:<a href="https://github.com/mansong1/springbootemployee-api" target="_blank">https://github.com/mansong1/springbootemployee-api</a></p><p>如果你想继续下去，你将需要以下:</p><ol role="list"><li><a href="http://snyk.io/signup" target="_blank"> <strong> Snyk账号</strong> </a></li><li><a href="https://app.harness.io/auth/#/signup" target="_blank"> <strong>驾驭账号</strong> </a></li></ol><p>完成以下步骤后，本教程最有意义:</p><p>如果您已经完成/复习了上述内容，那么您已经学会了如何设置一个线束CI工作流。</p><h2>在线运行Snyk测试的七个步骤</h2><h3>步骤1:创建Snyk API令牌机密</h3><p>您需要一个Snyk API令牌来执行Snyk CLI测试。对于企业客户，可以通过Snyk App设置<a href="https://docs.snyk.io/features/integrations/managing-integrations/service-accounts" target="_blank">服务账号</a>并创建令牌。对于非企业Snyk帐户，包括我们的免费Snyk层，您可以使用主<a href="https://docs.snyk.io/features/snyk-cli/install-the-snyk-cli/authenticate-the-cli-with-your-account" target="_blank">用户令牌</a>。</p><p>接下来，按照这些步骤，在Harness中创建一个secret来存储Snyk API令牌。</p><h3>步骤2:创建新的管道</h3><ol role="list"><li>首先，点击<strong> +Project </strong>，在Harness中创建一个新项目</li></ol><figure class="w-richtext-figure-type- "/><ol start="2" role="list"><li>一旦你创建了你的项目，转到<strong>持续集成</strong>模块来创建一个新的管道。</li></ol><figure class="w-richtext-figure-type- "/><h3>步骤3:添加代码库</h3><p>如果这是管道中的第一个CI阶段，请在CI阶段设置中启用克隆基本代码。如果您有一个包含CI阶段的现有管道，请单击“代码库”。参见<a href="https://ngdocs.harness.io/article/ota4xj59le-run-a-script-in-a-ci-stage" target="_blank">编辑代码库配置</a>。</p><h3>步骤4:定义构建场基础结构</h3><p>在CI Stage基础结构中，定义代码库的构建场。</p><p>参见<a href="https://ngdocs.harness.io/article/ia5dwx5ya8-set-up-a-kubernetes-cluster-build-infrastructure" target="_blank"> Kubernetes集群构建基础设施设置</a>。</p><h3>步骤5:配置运行Snyk测试</h3><p>在CI执行中，单击添加步骤，然后单击运行。</p><figure class="w-richtext-figure-type- "/><p>运行步骤在容器映像上执行一个或多个命令。</p><p>Snyk提供了多个容器图像，这些图像包装了Snyk CLI，并带有针对不同语言的相关工具。在这个例子中，我们使用的是Maven版本，因为在这个示例应用程序中使用的就是它。</p><p>有关配置运行步骤的步骤设置，请参见<a href="https://ngdocs.harness.io/article/1i1ttvftm4-run-step-settings" target="_blank">运行步骤设置</a>并添加您的Snyk API令牌。</p><figure class="w-richtext-figure-type- "/><p>现在，您可以在运行步骤配置的命令部分引用该环境变量。</p><figure class="w-richtext-figure-type- "/><h3>步骤6:运行管道</h3><p>现在，您可以运行您的管道了。</p><ol role="list"><li>单击保存并发布。</li><li>单击运行。将出现管道输入设置。</li><li>在CI代码库中，单击Git分支。</li><li>在Git分支中，输入代码库所在分支的名称，例如master。</li></ol><figure class="w-richtext-figure-type- "/><ol start="5" role="list"><li>单击运行管道。</li></ol><h3>步骤7:查看管道执行</h3><p>当工作流运行时，Snyk <strong>测试</strong>步骤失败，因为项目包含易受攻击的依赖项。我们也可以点击<strong>控制台视图</strong>切换来查看完整的报告。</p><p>注意:为了更好地控制您的测试，您可以将severity-threshold标志传递给Snyk test命令，其中包含一个受支持的选项(低|中|高|关键)。使用此标志，将只报告所提供级别或更高级别的漏洞</p><figure class="w-richtext-figure-type- "/><p>整个管道可作为<strong> YAML </strong>也。</p><p>在构建中，单击更多选项(<strong> ︙ </strong>)并选择编辑管道。</p><p>点击<strong> YAML </strong>。</p><figure class="w-richtext-figure-type- "/><p>你可以看到整个管道作为YAML(见下面截图)。您可以编辑管道中的任何内容并再次运行它。</p><p>管道:<br/>阶段:<br/> -阶段:<br/>类型:CI <br/>规格:<br/>基础设施:<br/>类型:kubernetesidirect<br/>规格:<br/> connectorRef: org。GKE <br/>名称空间:线束构建<br/>执行:<br/>步骤:<br/> -步骤:<br/>类型:运行<br/>规格:<br/>连接器引用:组织。docker hub<br/>image:SNYK/SNYK-CLI:1 . 745 . 0-maven-3 . 5 . 4<br/>命令:|- <br/> snyk配置集api=$SNYK_TOKEN <br/> snyk测试<br/>privileged:true<br/>env variables:<br/>SNYK _ TOKEN:&lt;+secrets . getvalue(" org。SNYK_TOKEN") &gt; <br/>资源:<br/>限制:<br/>内存:1Gi <br/> cpu: "1.0" <br/>名称:SNYK _ Test<br/>clone codebase:true<br/>名称:CI <br/>标识符:CI <br/>属性:<br/>CI:<br/>code base:<br/>repoName:spring boot employee-API<br/>connector:org。github<br/>build:&lt;+input&gt;<br/>project identifier:Snyk<br/>or identifier:default<br/>name:Snyk Test<br/>identifier:Snyk _ Test<br/>描述:测试本地项目漏洞。</p><h2>CI/CD工作流程</h2><p>除了扫描应用程序的依赖关系，漏洞还会根据所用容器的选择而潜入。除此之外，云资源的错误配置也是用来访问云数据和服务的最常见的云漏洞。</p><p>在本例中，我们将在Kubernetes上构建和部署我们的应用程序，然后使用Snyk对其进行监控。</p><p>要构建和推动一个容器，只需遵循这些<a href="https://ngdocs.harness.io/article/8l31vtr4hi-build-and-upload-an-artifact" target="_blank">步骤</a>。添加Snyk容器扫描步骤类似于上面的Snyk测试步骤。</p><p>要将容器部署到我们的Kubernetes集群，请参见这里的<a href="https://ngdocs.harness.io/article/knunou9j30-kubernetes-cd-quickstart" target="_blank"/>。在我们的CD管道中，我们将在此之前执行Kubernetes清单的Snyk测试。添加Snyk IaC测试步骤是通过<a href="https://ngdocs.harness.io/article/k5lu0u6i1i-using-shell-scripts" target="_blank"> Shell脚本</a>步骤完成的。</p><figure class="w-richtext-figure-type- "/><p>在Snyk IaC步骤中执行的脚本如下:</p><p>RM-RF springboot employee-API | | true<br/><br/>git克隆https://github.com/mansong1/springbootemployee-api<br/>CD springboot employee-API<br/><br/>SNYK _ TOKEN =&lt;+secrets . getvalue(" org。SNYK_TOKEN") &gt; <br/> snyk配置集api=$SNYK_TOKEN <br/> snyk iac测试清单/&lt;+infra . namespace&gt;/templates/*。yaml</p><p>完整的CI/CD工作流如下所示:</p><figure class="w-richtext-figure-type- "/><figure class="w-richtext-figure-type- "/><p>和以前一样，这条管道可以看作是YAML，位于这个<a href="https://github.com/mansong1/springbootemployee-api/blob/master/harness/.harness/SpringBoot_Employee_API.yaml" target="_blank"> GitHub repo </a>中。</p><p>Snyk与Kubernetes集成，使您能够导入和测试正在运行的工作负载，并识别它们的相关映像和配置中的漏洞。导入后，Snyk会继续监控这些工作负载，随着新映像的部署和工作负载配置的变化，识别其他安全问题。</p><p>通过我们的Harness CD工作流程进行的成功部署显示在Snyk应用程序上，如下所示:</p><figure class="w-richtext-figure-type- "/><figure class="w-richtext-figure-type- "/><h2>现在试试吧</h2><p>在选择技术平台时，重要的是选择一个将开发者的需求放在解决方案中心的平台。它还应该侧重于补救问题，而不仅仅是报告问题。采用开发人员优先方法的平台可以集成整个管道的安全性，帮助多个不同的利益相关方(如开发人员、sec和运营团队)获得一个整体视图。这有助于植入一种相互开发合作的心态，并确保消费者手中的软件更加安全。</p><p>非常感谢你加入我们的教程。别忘了今天试试<a href="https://app.snyk.io/login" target="_blank"> Snyk </a>和<a href="https://app.harness.io/auth/#/signup" target="_blank">线束</a>！</p><p><em>本文由帕斯·阿皮塞拉(Snyk)和马丁·安松(Harness)合作撰写。</em></p><p>Martin是Harness商业销售组织的解决方案工程师，致力于帮助客户加快软件生命周期的构建和交付。在Harness之前，Martin担任过各种工程职位，带来了云计算、自动化工具、DevOps实践等方面的丰富知识。在业余时间，他喜欢航海、素描和杂耍。</p><p><em> Pas Apicella是Snyk的首席解决方案工程师APJ，在Snyk平台上工作，帮助客户保护他们的云原生应用程序，并在满足业务需求的同时实现DevSecOps文化。他为OSS项目贡献了代码，并在时间允许的情况下不断地撰写关于云原生架构的博客。他毕业于墨尔本理工大学，获得了计算机科学学士学位，此后曾在Snyk、Elastic、Pivotal、VMware、Oracle和IBM等公司担任过各种职务。</em></p></div></div>    
</body>
</html>