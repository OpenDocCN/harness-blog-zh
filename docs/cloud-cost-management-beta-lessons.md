# 从 Harness 云成本管理 Beta | Harness 中获得的经验

> 原文：<https://www.harness.io/blog/cloud-cost-management-beta-lessons>

预计到 2022 年，云支出将超过 3600 亿美元，这主要是由交付速度和创新推动的。(数据来源:Gartner)。

这一创新的核心是工程决策，这些决策有时会被证明是昂贵的，会导致臃肿的云账单和低效的资源使用。正如我们从用户那里了解到的那样，平衡软件速度和操作效率可能并不容易。

我们推出了 Harness 云成本管理测试版，并在过去几周与一些客户合作，了解他们在管理云成本方面的具体问题。到目前为止，我们得到的反馈绝大多数是积极的。我们的一位用户能够在使用产品的几天内**实现超过 50 万美元的年度节省。另一个人声称，他们现在可以更积极地发布功能&预期流量，成本可见性在几小时内而不是几周内。**

这里总结了我们学到的东西，以及我们如何快速迭代以应对他们的挑战。

## **#1:降级&推动成本意识文化**

你可能听说过左移或右移。但是什么是降档呢？下移是赋予工程人员——开发人员、开发运营人员、SREs 以有用和可操作的成本洞察力的能力，这种洞察力可能传统上掌握在精通技术的财务分析师&高管手中。我们的大多数用户提到，他们团队中的大多数成员都无法使用成本管理产品。

那些有权限的业务人员缺乏导致成本变化的决策的具体背景。我们的一个测试用户提到，“知道我的开发人员手边有成本信息很有帮助。这有助于他们对自己的支出更加积极主动，同时也不会对每一个微小的变化可能会让他们付出的代价过于紧张。它有助于推动关键利益相关方之间的成本透明度，同时使个人开发人员和 DevOps 工程师能够与他们的财务同行建立信任。

我们的一个用户声称他们终于有了一个对花钱的人友好的工具，而不仅仅是数钱的人。

## **#2:挖掘成本数据或根本成本分析**

容器和容器编排器是大多数团队的流行选择。然而，由于缺乏对粒度成本数据的可见性，传统的成本分配策略极具挑战性。

云提供商仅为底层服务器实例的使用提供计费数据，但是当该服务器实例运行多个容器时，您需要额外的信息来计算运行这些容器的成本。服务 foo 和服务 bar 的容器使用了多少服务器？这些节点中有多少具有由容器要求的未分配资源？这些容器中有多少拥有已申请但闲置的资源？

我们的测试版用户指出，从帐户或服务实例开始，并能够一直深入到特定的微服务或容器，对于优化成本至关重要。在 Harness，我们称之为根成本分析。根成本分析使我们的一个测试版客户在他们的一个开发环境中为单个过度配置的 Kubernetes **集群**节省了超过 182，000，000 美元的年度成本。另一位客户解释说，他们现有的云成本管理产品通常需要 4-5 天，现在只需要 20 分钟。

## **#3:按应用、服务、集群等分配成本**

要了解任何服务的真正成本驱动因素，我们需要超越大多数原生云成本产品(如 AWS、GCP 和 Azure)提供的每日/每周/每月汇总细节。它们对于开始非常有用，但是我们的测试版用户指出，他们在试图了解一项服务、应用程序或产品的成本，以及他们的每个团队在研发或生产中花费多少来服务于他们的最终客户时遇到了困难。中小型公司使用按存储容量使用显示，让团队知道他们花费了多少，更成熟的公司使用按存储容量使用计费将成本与团队的预算和损益相关联

我们与这两类用户都有过合作，大多数用户的共同痛点是，如果不努力标记资源，就不容易隔离资源并将它们映射到应用程序或产品。您可以避免标记您的服务的需要——至少是您使用 Harness 部署的服务，因为我们了解您的应用程序/服务的构造以及它们部署到的基础设施。下图说明了如何通过利用现有的线束部署来实现这种分解。

利用线束部署的微服务成本

## **#4:保护成本利润**

为了能够了解服务客户的成本，了解您在研发(开发、QA、试运行等)和生产方面的云支出非常重要。我们看到了用户如何做到这一点的许多变体，并从他们的每一次经历中学到了很多。有些人的花费分布在 Kubernetes 的名称空间中，并清楚地知道它们是什么。一些人使用 Kubernetes 标签按照他们的最终客户、团队/所有者或者发布/版本对 pods 进行分组。另一位用户想了解他们新部署/推出的服务的成本，以及它是否超出了他们的预期。

我个人最喜欢的是我们的一位用户，他希望运行他们的工作负载几个小时，并了解每小时的成本，以模拟真实的生产工作负载。我们在几天内推出了每小时粒度功能，这有助于他们更好地了解自己的支出以及向最终客户收取的费用。我们的用户只是触及表面，有大量的机会能够利用 Harness 来了解和保护成本利润。

按小时计算的 Kubernetes 集群的成本

## **#5:精细成本管理**

大多数用户通常按照云账户、订阅、项目或服务来管理成本。有些人将每周或每月的报告发送给关键的业务主管或财务利益相关者，通常会等到月底。其他人更积极地管理预算，更积极地开会，进行公开透明的对话。

我们了解到，他们收到的警报大部分是信息性的。拥有特定微服务、命名空间、集群或环境(如生产、试运行、开发 QA 等)的团队不会将目标分解为粒度目标。例如，人们还希望根据名称空间这样的粒度来预测下一季度的支出。

Harness 提供了在所有粒度级别控制支出的能力，并将公司目标划分为由团队拥有的更小的目标，以自我管理成本。

我们的一个测试客户，一家公共部门的服务公司，**声称:“由于我们的集群托管来自许多不同业务部门的应用，我们的财务团队很难准确地将云计算成本分配到正确的损益。有了 Harness，这项任务变得微不足道，我们现在可以将成本责任转移给我们的工程团队”**

QE 治理成本

## **#6:最后，成本不是一次性的。它是连续的。**

我们在测试期间观察用户的一个关键经验是，成本不是一次性的。当在云中调配基础架构、创建测试环境但不销毁测试环境、自动扩展集群并专门为生产工作负载提供大量缓冲时，或者当对新计划进行投资时，It 需要持续监控。

我们的测试版用户遇到了所有这些场景，有些比其他人更频繁。虽然他们告诉我们，他们不希望不断地查看仪表盘，但他们确实希望在成本飙升时得到通知。除了能够访问成本数据，他们还认为整合部署工具和成本是一个巨大的优势，因为他们不必在多种工具之间切换来了解他们的管道的影响。

例如，一个部署事件，比如发布一个新版本的服务，可以从它对成本的影响的角度来看。下面是我们的客户用来监控其团队成本的一个名称空间的趋势。如您所见，成本往往会攀升，需要持续监控以保持在一定范围内。

欲了解更多信息，并请求您演示如何利用[云成本管理](https://harness.io/platform/cloud-cost-management/)。