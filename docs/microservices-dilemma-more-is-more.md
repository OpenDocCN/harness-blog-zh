# master micro services with Harness CD—专为扩展您的组织| Harness 而打造

> 原文：<https://www.harness.io/blog/microservices-dilemma-more-is-more>

在 Unix 世界中，少大于多，但是对于开发世界来说，多就是多。你的管道准备好了吗？

与云迁移、无服务器和 Kubernetes 一起，微服务已经引起了技术从业者和领导者的关注。有人可能会说，应用程序的分解已经持续了几十年，并不是计算领域的重大转变。微服务有多种定义，从纯粹的定义到类似运动的定义。在构建新的应用程序时，拥有微服务架构将是一个设计目标。对过去的应用程序进行现代化改造，可能会面临一场“微服务”旧应用程序的艰苦战斗。随着技术生态系统向前发展，允许更快速的部署、[服务发现](https://en.wikipedia.org/wiki/Service_discovery)和几乎即时可用的基础设施，微服务在今天更像是进化而非革命。由于成功部署所需的速度和独立性，微服务肯定会突破管道的极限。

## 如果你看到一个微服务，你会知道它是微服务吗？

在几个[冲刺](https://www.atlassian.com/agile/scrum/sprints)建立你的努力工作之后，你准备好向世界展示你的[宁静](https://en.wikipedia.org/wiki/Representational_state_transfer)终点。这必须是微服务吧？用任何其他的名字称呼你的端点都是卑鄙的，不跟随现代建筑潮流是可耻的。围绕微服务的严格定义可以包括:你的服务是[基于消息的，又名 MOM](https://en.wikipedia.org/wiki/Message-oriented_middleware) ，通信应该通过[消息模式](https://www.enterpriseintegrationpatterns.com/patterns/messaging/)来促进。你开始对这种消息传递需求感到困惑，但没人告诉你要有一个必须使用消息传递的微服务。如果你看了马丁·福勒的一篇解释微服务设计模式的文章，你会发现其中一些设计模式非常突出。对我来说，最大的一块是围绕[数据治理](https://martinfowler.com/articles/microservices.html#DecentralizedDataManagement)。对于微服务，数据需要独立于其他服务。如果您对服务中的数据结构进行更新不会导致对依赖服务或调用服务的结构更新，那么点击一下鼠标，不应该有重叠的[数据定义](https://en.wikipedia.org/wiki/Data_definition_language)。假设您在 sprints 中构建了一个天气应用程序，接受一个邮政编码并返回城市名称和天气。此外，有趣的事情需要记录分析的请求。您的应用程序很可能无法保证一个 [JAVA 消息服务(JMS)](https://en.wikipedia.org/wiki/Java_Message_Service) 提供者/实现所提供的事务支持。有了天气服务，我们可以有一个非常简单的模式或文档结构。记录数据的用户当然可以独立存在。当深入研究微服务时，一个流行的说法是开始构建范围更细粒度的服务，或者只完成一个单一目标。典型的[电子商务微服务示例](https://medium.com/@dearsikandarkhan/microservices-architecture-for-e-commerce-f8b49270e72f)会说你有一个购物车、库存、用户管理等服务。我们的气象服务越来越像微服务了。拉维石蕊测试将是“你能自己做这件事吗？”。在某些时候，你将不会在你的项目或组织中。有了您创建的宏伟的端点，是否可以在没有其他开发团队参与的情况下进行部署或更新？听起来天气服务是相当独立的，并为我们的终端客户提供一个粒度功能。恭喜你，你通过了微服务测试！现在让我们把所有的东西都投入到这个新的架构范例中。

## 把我从地狱中拯救出来吧，微服务！

微服务的最大魅力在于从依赖地狱中解放出来的灵活性。微服务架构的另一面是[单片架构](https://en.wikipedia.org/wiki/Monolithic_application)。顾名思义，monolith 有一个可部署的单元，具有所有需要的功能。在 JAVA 时代，想象一场大规模的[战争](https://en.wikipedia.org/wiki/WAR_(file_format))即将展开。回到一个电子商务的例子，所有的功能，如购物车和库存，都是用这个单一的 ecommerce.WAR 部署的。这可能是有风险的，而且是过度的，因为做一个看似很小的改变需要重新部署整个应用程序。由于风险暴露如此之高，整体架构团队倾向于以较慢的频率进行部署。因此需要一种更好的方法来做部署。比其他团队更快完成功能的团队不需要与部署保持同步。对于较新的应用程序，大多数人会考虑为包含较小服务的更独立的部署进行设计。创建新服务比以往任何时候都容易。随着我们计算方式的进步，例如从容器到网络/可发现性堆栈，如[服务网格](https://www.redhat.com/en/topics/microservices/what-is-a-service-mesh)和 [API 网关](https://www.nginx.com/learn/api-gateway/)平台，启动和连接服务比以往任何时候都更容易。有了微服务设计的优势，为什么您的所有应用都没有采用新的模式呢？

## 为什么我的开发者都不是微服务？

微服务的代价是，随着依赖性复杂性的降低，部署复杂性会增加。有了更小、更细粒度的服务，您将拥有更多的服务。因此，部署的数量将会增加。Martin Fowler 也因创造了扼杀者模式而闻名，在这种模式中，应用程序堆栈的新部分将最终淘汰旧部分。最终，随着服务数量的爆炸式增长，将很难保持跟踪。一个叫做[的大泥球](https://en.wikipedia.org/wiki/Big_ball_of_mud)的反模式将开始出现。有了这个大球泥，端点地狱就开始发生了，新的服务刚刚出现，没有清晰和简洁的服务设计或管理。几个挑战开始出现。由于服务的粒度如此之细，一个服务可以调用几个服务进行几个跳跃，而这只是一个整体中的一个跳跃。跨服务跟踪相当困难，特别是如果没有人想承担状态本身。分布式追踪已经取得了进展，例如[耶格](https://www.jaegertracing.io/)。应用基础设施的责任开始随着微服务而转移。完整生命周期开发人员/团队模型开始出现，因为团队开始运行他们的端点工作所需的一切。虽然回到数据库；如果您的团队或端点取得了巨大成功，该怎么办？您能想象每个服务端点有一个 [DBA](https://en.wikipedia.org/wiki/Database_administrator) 管理的 Oracle 集群吗？这些将是非常昂贵的微服务。数据库方面的专业知识可能不是你或你的团队的强项，所以应用程序基础设施方面的专业知识开始塑造架构；你知道你知道什么。部署复杂性肯定会随着微服务的增加而增加，这可能与整体架构的直觉相反。对于 monolith，人的复杂性在于让多个团队同意何时部署。随着部署数量的增加，这种复杂性转变为微服务的系统复杂性；更多服务，更多部署。回到“拉维石蕊测试”，你能在不涉及另一个团队的情况下部署吗？希望部署管道足够健壮，能够处理增加的需求和速度。软件开发团队投资于新范例，但在尝试部署时却遇到了瓶颈，这将是搬起石头砸自己的脚。一个流行的笑话是“容器蔓延是新的虚拟机蔓延”。是什么驱动了所有这些容器？你的微服务。有了微服务，您似乎有了更多的应用基础架构副本。数据库的数量似乎随着服务爆炸式增长，而不是一个数据库伴随着一个整体。在微服务领域，越多越好。

## 不要害怕带吊带的微服

您组织中的微服务之旅很可能是一个有机/自然的过程。作为软件工程师，微服务运动的目标是拥有更多分解的部分，这并不新鲜，并且已经朝着这个目标前进了一段时间。当您的端点数量开始激增时，Harness 可以提供帮助。您的管道不应该成为想要创建新的或分解的服务的团队的瓶颈。随着越来越多的团队接受微服务咒语，新服务的速度越来越快，DevOps 团队很快就会因脆弱或非健壮的管道而不堪重负。使用 Harness 创建新管道非常容易。随着服务开始在您的组织中扩展，不要让实际部署艰苦工作的冲刺成为瓶颈。拉维