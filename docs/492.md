# 降低云成本的开发人员指南|利用

> 原文：<https://www.harness.io/blog/reduce-cloud-costs>

谈到成本，云计算并不是我们所期望的全部。这篇博客文章分享了一些有用的、适用的技巧，可以帮助开发人员降低云中应用程序的成本。

云成本管理是一个热门话题，也是目前所有软件公司的当务之急。尽管有各种各样的云提供商或平台，如亚马逊网络服务(AWS)、谷歌云平台(GCP)或微软 Azure，但似乎没有一个工程团队能够很好地实际处理他们的云成本。

事实上，AWS 自己早在 2017 年就承认，大约[35%的云支出是浪费](https://awsinsider.net/articles/2017/11/20/rightscale-aws-overpay-6-billion.aspx#:~:text=The%20company%20calculated%20that%20roughly,Google%20Cloud%20Platform%20(GCP).)，而在当时，这是他们收入的 64 亿美元。Gartner 预测，2020 年[公共云市场将增长至 2579 亿美元](https://www.gartner.com/en/newsroom/press-releases/2020-07-23-gartner-forecasts-worldwide-public-cloud-revenue-to-grow-6point3-percent-in-2020)。这意味着公司预计将在公共云支出上总共浪费 908 亿美元。公共云提供商可能不会抱怨，但工程和公司预算肯定会抱怨。

现实是，云账单正在爆炸式增长，每个人都想把它们降下来。在本帖中，我们将探讨是什么导致了疯狂的云账单，探究一些切实降低云成本的方法，并探索一些有助于简化这一切的工具。

## 云成本优化的重要性

优化您的云成本的最大也是最明显的原因很简单:尽可能降低您的云成本。同样，我们也不想掏空自己的钱包，尽可能降低成本，我们希望将我们的云支出控制在可管理的水平，这样我们就有足够的钱来花。你可以看看我们关于选择正确的[云成本管理方法](https://harness.io/blog/cloud-cost-management-methods/)的帖子，看看什么可能对你有用。

想象一下，如果你有一个 100 美元的云预算，你想延长一个月，但由于不存在云成本管理实践或可见性，你在一天内就用完了。你在第一轮就破产了。同样，工程团队与云提供商有预算——或折扣承诺——他们希望持续一整年。如果因为我们不知道云账单发生了什么，导致成本失控，预算受到冲击(或大幅超支)，会发生什么情况？

有一些创业公司因为犯了一个小错误而导致大规模成本超支，直接耗尽资金的恐怖故事。了解云费用并找出如何管理和优化它们正成为一个越来越重要的问题——随着时间的推移，越来越多的公司希望他们的开发人员自己参与保持云成本优化。如今，管理云成本的任务通常落在没有合适背景的外部团队身上，因此尽管他们可以找到成本节约方法，但他们并不了解成本的原因。

*Devs understand the cost, but they're not always responsible for optimizing it.*

## 造成高云成本的最大因素是什么？

### 贡献者#1:未使用的资源

所有环境都容易出现未使用的资源。这些资源包括未连接的存储卷和过时的快照(每月按千兆字节(GB)收费)、空闲负载平衡器以及未使用但正在运行的实例(每小时收费)。

您可能非常熟悉创建新的云资源实例有多容易，以及忘记它们的存在有多容易，因为您关注的是开发速度。如果您使用 AWS，您可能会犯这样的错误(我也是):为一个小的测试应用程序创建一些 EC2 实例，然后让它们运行，即使您不再使用它们。当然，这意味着您仍然在为这些未使用的 EC2 实例付费，并且它将在以后到达钱包。与此同时，您甚至可能增加新的计算实例，这将增加成本！哎呀。

#### 建议

开发人员应该小心维护他们的沙盒环境，以确保启动的计算实例在不再需要时被清理或关闭。

### 贡献者#2:计算资源

在容器环境中，开发人员和管理员可以使用 Kubernetes 来管理和分配计算资源给他们的 Kubernetes 资源，包括 pods、节点和名称空间。为一个应用程序在一个生态系统中可以使用的 CPU(以内核为单位)和内存(以字节为单位)数量指定资源限制是一种相当常见的做法。然而，对于公共云成本而言，这可能会导致闲置成本，即应用程序被过度分配，并且没有使用所有保留的资源。同样，空集群、环境和工作区也会增加未分配的成本。

#### 建议

开发人员应该使用工具来监控他们的应用程序的性能。收集有关计算机、内存、网络和存储消耗的信息可以帮助您优化云中的资源利用和分配。与您的云管理员分享这些发现可以让您减少闲置和未分配的成本，或者更好的是，您甚至可以自己处理它们。

### 贡献者 3:存储服务的隐性成本

很容易理解存储是有成本的(每 GB/月)，但是许多开发人员忘记了对存储文件的 I/O(输入/输出)操作也是要花钱的。服务提供商按请求/API 调用收费。在不同区域、虚拟专用云(VPC)之间或云外传输数据时，数据传输也按 GB 收费。

我们中的许多人习惯于在本地环境中，在开发和测试时自由地对文件使用读/写操作，因此可以理解我们可能以同样的方式对待对 AWS S3 存储桶的读/写。但这就是我们必须小心的地方，因为在云中工作时，每一个读写都要花钱。

#### 建议

开发人员在设计数据传输作业或数据密集型应用程序时，应仔细考虑存储的隐性成本。一种选择是保留对本地文件的 I/O，直到您确信它们针对云进行了优化，或者它们满足架构要求以最大限度地减少这些操作。

## 降低云成本的 3 种方式

让我们看看即使作为开发人员，也可以降低云成本的一些方法。如果你是一名负责保持低成本的工程师，那么这是适合你的。

### 合理调整云资源

合理调整是“减少闲置成本”，或者更简单地说，“不要使用比你需要的更大的实例。”显然，这在实践中很难一次就做对，因为在你做好之前，你不知道你到底需要什么，也不知道应用程序的用法是什么样的！

在构建后的场景中，您可以获得合适的资源，现在您已经知道自己实际需要什么了。一个简单的例子是，您可能在构建时提供了一个 AWS EC2 大型实例，但您最终并没有使用大部分计算实例，因此您发现您实际上可以使用 EC2 Med 实例。在下图中，您将看到，即使您在 EC2 实例成本上节省了 5 美元/小时，全年也能节省 43，800 美元的成本。

### 减少未分配的资源

通常，您会遇到这样的情况，不是单个实例本身被过度配置，而是一组您可以更好地使用的资源被过度配置。与合理调整一样，提前做这件事很难，但随着时间的推移，你在哪些地方没有使用资源，在哪些地方可以更好地使用资源，这一点会变得更加明显。

使用一个简单的非集群示例，假设您在三个 AWS EC2 实例中有 40%的稳定使用率。如果您不需要这些 EC2 实例中的所有额外容量，您能否将计算从这三个实例中的一个转移到另一个？这将使您在一个实例中达到 80%的使用率，在第二个实例中达到 40%,而第三个实例您可以关闭，因为您不再需要它了。如果每个实例的成本为 5 美元/小时，那么一年下来您将节省 43，800 美元。当然，如果您将该容量放在手边，这是行不通的，因为预计生产中会出现使用高峰。

在许多情况下，您将使用容器，并且您将过度供应您正在使用的节点。下图展示了与上面的非集群示例相同的概念，但是它将如何在您的集群工作负载中工作，可能是在 Kubernetes 或 AWS ECS 中。使用相同的工作负载转移方法，我们可以有效地删除其中一个节点，并为您节省每小时 5 美元或每年 43，800 美元的成本。

### 批量折扣

知道您在未来一段时间内需要使用的云实例的最小数量吗？您肯定希望兑现所有云提供商乐意提供的批量折扣，以换取给定时间段内的最低承诺。

您可能听说过按需、预留和容量等术语，因为它们与云资源的成本有关。即使你没有，他们基本上只是定价层。

*   **按需**成本最高，因为您要求云提供商在您需要时为您提供计算实例。这和那天需要包工头出来你家维修是一个概念，会让你多花钱。
*   **保留**比按需便宜，因为你说，“我需要这台电脑更长一段时间，我愿意提前付费，为我保留这台电脑。”就像你提前预定承包商一样，你会发现以折扣的形式节省了一些成本。
*   **批量**购买给你最好的折扣，因为你在说，“如果你给我折扣，我保证在这段时间内给你 X 美元。”因为你预先付费，给云提供商收入保证，他们愿意给你最大的折扣。这几乎就像雇佣你的承包商；因为你保证无论如何都要付钱给他们，所以在需要的时候，你会在服务上得到休息。

## 降低云成本的工具

降低你的云成本看起来很棒，上面的方法在你的头脑中可能真的很有效。但是它们仍然需要你自己花时间去做，你总是可以用合适的工具让它变得更容易。

### 现代云成本管理工具(Harness)

允许您在发生时查看确切使用情况的工具就像查看日志文件一样，可以准确地发现实时或任意时间戳发生了什么。这将是处于困境中的开发人员确切了解他们在云中产生的成本及其来源的最佳方式，因此他们可以随时在底层优化云成本。

Harness 有一款名为[云成本管理](https://harness.io/platform/cloud-cost-management/)的产品可以做到这一点。

### 传统云成本管理工具(云健康、云能力)

这些工具适用于评估时间点或周期性的成本节约机会，而不是针对每种资源进行优化的机会。通常，团队会每隔几周或几个月查看这些工具，看看他们可以在哪里省钱。这些方法的缺点是，它们可能无法深入了解每项成本的来源，也就是说，作为一名开发人员，它们可能无法深入了解您自己处理成本所需的细节。

你可以把 Harness 比作两个流行的工具， [Cloudability](https://harness.io/learn/developer/devops-tools/apptio-cloudability-vs-harness/) 和 [CloudHealth](https://harness.io/vmware-cloudhealthtech-vs-harness/) 。

### 原生云提供商计费工具(AWS Cost Explorer、GCP 计费、Azure 计费)

每个云提供商都提供这些工具，让您基本了解云成本的来源。这通常对拥有预算并希望在较高层次上了解成本的人最有用。它们对无所事事的开发人员来说并不那么有用，因为它们不一定能提供理解其特定用途所需的粒度，而且它们不像 Kubernetes 那样需要考虑容器化成本。

你可以把 Harness 比作 [AWS Cost Explorer](https://harness.io/learn/developer/devops-tools/aws-cost-explorer-vs-harness/) 、 [GCP 计费](https://harness.io/gcp-billing-vs-harness/)和 [Azure 计费](https://harness.io/learn/developer/devops-tools/azure-billing-vs-harness/)。

## 利用管理减少云浪费并降低云成本

随着开发人员在 CI/CD 流程中承担越来越多的优化云成本的责任，拥有能够[了解他们自己的使用情况](https://harness.io/blog/a-devs-guide-to-cloud-cost/)并在云成本成为问题之前阻止云成本的工具对他们来说非常重要。

[Harness Cloud Cost Management](https://harness.io/platform/cloud-cost-management/)是一款考虑到开发人员需求的工具，可以轻松获得他们所需的任何级别的可见性。开发者第一次可以掌控自己的云开支，做工程师最擅长的事情:优化。

您想了解更多关于现有工具的信息吗？我们制定了要考虑的顶级[云成本管理工具](https://harness.io/blog/cloud-cost-management-tools/)。